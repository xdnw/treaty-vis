var fo=Object.defineProperty;var go=(i,t,n)=>t in i?fo(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n;var at=(i,t,n)=>go(i,typeof t!="symbol"?t+"":t,n);import{g as mo,N as po,j as Q,r as U,s as yo,m as Ve,u as xr,q as vo,b as bo,c as Er,e as wo,f as xo,h as Eo,i as Io}from"./index-C8exn9hN.js";function hi(i){return i.length>=10?i.slice(0,10):i}function Ao(i,t){if(i.length===0)return null;if(!t)return i[i.length-1]??null;const n=hi(t);let e=0,r=i.length-1,o=-1;for(;e<=r;){const s=Math.floor((e+r)/2);i[s]<=n?(o=s,e=s+1):r=s-1}return o>=0?i[o]??null:i[0]??null}function So(i,t,n){if(t.length===0)return{day:null,row:null,usedFallback:!1};const e=n?hi(n):t[t.length-1];if(e in i)return{day:e,row:i[e],usedFallback:!1};const r=Ao(t,e);if(!r)return{day:null,row:null,usedFallback:!1};const o=i[r];if(o)return{day:r,row:o,usedFallback:r!==e};const s=t.indexOf(r);if(s<0)return{day:null,row:null,usedFallback:!1};for(let a=s-1;a>=0;a-=1){const c=t[a],d=i[c];if(d)return{day:c,row:d,usedFallback:!0}}for(let a=s+1;a<t.length;a+=1){const c=t[a],d=i[c];if(d)return{day:c,row:d,usedFallback:!0}}return{day:null,row:null,usedFallback:!1}}var Kt={exports:{}},Ir;function _o(){if(Ir)return Kt.exports;Ir=1;var i=typeof Reflect=="object"?Reflect:null,t=i&&typeof i.apply=="function"?i.apply:function(I,x,w){return Function.prototype.apply.call(I,x,w)},n;i&&typeof i.ownKeys=="function"?n=i.ownKeys:Object.getOwnPropertySymbols?n=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:n=function(I){return Object.getOwnPropertyNames(I)};function e(y){console&&console.warn&&console.warn(y)}var r=Number.isNaN||function(I){return I!==I};function o(){o.init.call(this)}Kt.exports=o,Kt.exports.once=v,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(y){if(typeof y!="number"||y<0||r(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");s=y}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||r(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function c(y){return y._maxListeners===void 0?o.defaultMaxListeners:y._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(I){for(var x=[],w=1;w<arguments.length;w++)x.push(arguments[w]);var S=I==="error",A=this._events;if(A!==void 0)S=S&&A.error===void 0;else if(!S)return!1;if(S){var _;if(x.length>0&&(_=x[0]),_ instanceof Error)throw _;var T=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw T.context=_,T}var C=A[I];if(C===void 0)return!1;if(typeof C=="function")t(C,this,x);else for(var G=C.length,R=g(C,G),w=0;w<G;++w)t(R[w],this,x);return!0};function d(y,I,x,w){var S,A,_;if(a(x),A=y._events,A===void 0?(A=y._events=Object.create(null),y._eventsCount=0):(A.newListener!==void 0&&(y.emit("newListener",I,x.listener?x.listener:x),A=y._events),_=A[I]),_===void 0)_=A[I]=x,++y._eventsCount;else if(typeof _=="function"?_=A[I]=w?[x,_]:[_,x]:w?_.unshift(x):_.push(x),S=c(y),S>0&&_.length>S&&!_.warned){_.warned=!0;var T=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");T.name="MaxListenersExceededWarning",T.emitter=y,T.type=I,T.count=_.length,e(T)}return y}o.prototype.addListener=function(I,x){return d(this,I,x,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(I,x){return d(this,I,x,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(y,I,x){var w={fired:!1,wrapFn:void 0,target:y,type:I,listener:x},S=u.bind(w);return S.listener=x,w.wrapFn=S,S}o.prototype.once=function(I,x){return a(x),this.on(I,h(this,I,x)),this},o.prototype.prependOnceListener=function(I,x){return a(x),this.prependListener(I,h(this,I,x)),this},o.prototype.removeListener=function(I,x){var w,S,A,_,T;if(a(x),S=this._events,S===void 0)return this;if(w=S[I],w===void 0)return this;if(w===x||w.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete S[I],S.removeListener&&this.emit("removeListener",I,w.listener||x));else if(typeof w!="function"){for(A=-1,_=w.length-1;_>=0;_--)if(w[_]===x||w[_].listener===x){T=w[_].listener,A=_;break}if(A<0)return this;A===0?w.shift():m(w,A),w.length===1&&(S[I]=w[0]),S.removeListener!==void 0&&this.emit("removeListener",I,T||x)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(I){var x,w,S;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[I]),this;if(arguments.length===0){var A=Object.keys(w),_;for(S=0;S<A.length;++S)_=A[S],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=w[I],typeof x=="function")this.removeListener(I,x);else if(x!==void 0)for(S=x.length-1;S>=0;S--)this.removeListener(I,x[S]);return this};function l(y,I,x){var w=y._events;if(w===void 0)return[];var S=w[I];return S===void 0?[]:typeof S=="function"?x?[S.listener||S]:[S]:x?p(S):g(S,S.length)}o.prototype.listeners=function(I){return l(this,I,!0)},o.prototype.rawListeners=function(I){return l(this,I,!1)},o.listenerCount=function(y,I){return typeof y.listenerCount=="function"?y.listenerCount(I):f.call(y,I)},o.prototype.listenerCount=f;function f(y){var I=this._events;if(I!==void 0){var x=I[y];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(y,I){for(var x=new Array(I),w=0;w<I;++w)x[w]=y[w];return x}function m(y,I){for(;I+1<y.length;I++)y[I]=y[I+1];y.pop()}function p(y){for(var I=new Array(y.length),x=0;x<I.length;++x)I[x]=y[x].listener||y[x];return I}function v(y,I){return new Promise(function(x,w){function S(_){y.removeListener(I,A),w(_)}function A(){typeof y.removeListener=="function"&&y.removeListener("error",S),x([].slice.call(arguments))}E(y,I,A,{once:!0}),I!=="error"&&b(y,S,{once:!0})})}function b(y,I,x){typeof y.on=="function"&&E(y,"error",I,x)}function E(y,I,x,w){if(typeof y.on=="function")w.once?y.once(I,x):y.on(I,x);else if(typeof y.addEventListener=="function")y.addEventListener(I,function S(A){w.once&&y.removeEventListener(I,S),x(A)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}return Kt.exports}var li=_o();function To(){const i=arguments[0];for(let t=1,n=arguments.length;t<n;t++)if(arguments[t])for(const e in arguments[t])i[e]=arguments[t][e];return i}let Se=To;typeof Object.assign=="function"&&(Se=Object.assign);function Ue(i,t,n,e){const r=i._nodes.get(t);let o=null;return r&&(e==="mixed"?o=r.out&&r.out[n]||r.undirected&&r.undirected[n]:e==="directed"?o=r.out&&r.out[n]:o=r.undirected&&r.undirected[n]),o}function Ce(i){return typeof i=="object"&&i!==null}function fi(i){let t;for(t in i)return!1;return!0}function $e(i,t,n){Object.defineProperty(i,t,{enumerable:!1,configurable:!1,writable:!0,value:n})}function He(i,t,n){const e={enumerable:!0,configurable:!0};typeof n=="function"?e.get=n:(e.value=n,e.writable=!1),Object.defineProperty(i,t,e)}function Ar(i){return!(!Ce(i)||i.attributes&&!Array.isArray(i.attributes))}function Co(){let i=Math.floor(Math.random()*256)&255;return()=>i++}function tt(){const i=arguments;let t=null,n=-1;return{[Symbol.iterator](){return this},next(){let e=null;do{if(t===null){if(n++,n>=i.length)return{done:!0};t=i[n][Symbol.iterator]()}if(e=t.next(),e.done){t=null;continue}break}while(!0);return e}}}function At(){return{[Symbol.iterator](){return this},next(){return{done:!0}}}}class qn extends Error{constructor(t){super(),this.name="GraphError",this.message=t}}class W extends qn{constructor(t){super(t),this.name="InvalidArgumentsGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,W.prototype.constructor)}}class O extends qn{constructor(t){super(t),this.name="NotFoundGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,O.prototype.constructor)}}class ne extends qn{constructor(t){super(t),this.name="UsageGraphError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,ne.prototype.constructor)}}function gi(i,t){this.key=i,this.attributes=t,this.clear()}gi.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.undirectedDegree=0,this.undirectedLoops=0,this.directedLoops=0,this.in={},this.out={},this.undirected={}};function mi(i,t){this.key=i,this.attributes=t,this.clear()}mi.prototype.clear=function(){this.inDegree=0,this.outDegree=0,this.directedLoops=0,this.in={},this.out={}};function pi(i,t){this.key=i,this.attributes=t,this.clear()}pi.prototype.clear=function(){this.undirectedDegree=0,this.undirectedLoops=0,this.undirected={}};function St(i,t,n,e,r){this.key=t,this.attributes=r,this.undirected=i,this.source=n,this.target=e}St.prototype.attach=function(){let i="out",t="in";this.undirected&&(i=t="undirected");const n=this.source.key,e=this.target.key;this.source[i][e]=this,!(this.undirected&&n===e)&&(this.target[t][n]=this)};St.prototype.attachMulti=function(){let i="out",t="in";const n=this.source.key,e=this.target.key;this.undirected&&(i=t="undirected");const r=this.source[i],o=r[e];if(typeof o>"u"){r[e]=this,this.undirected&&n===e||(this.target[t][n]=this);return}o.previous=this,this.next=o,r[e]=this,this.target[t][n]=this};St.prototype.detach=function(){const i=this.source.key,t=this.target.key;let n="out",e="in";this.undirected&&(n=e="undirected"),delete this.source[n][t],delete this.target[e][i]};St.prototype.detachMulti=function(){const i=this.source.key,t=this.target.key;let n="out",e="in";this.undirected&&(n=e="undirected"),this.previous===void 0?this.next===void 0?(delete this.source[n][t],delete this.target[e][i]):(this.next.previous=void 0,this.source[n][t]=this.next,this.target[e][i]=this.next):(this.previous.next=this.next,this.next!==void 0&&(this.next.previous=this.previous))};const yi=0,vi=1,Ro=2,bi=3;function nt(i,t,n,e,r,o,s){let a,c,d,u;if(e=""+e,n===yi){if(a=i._nodes.get(e),!a)throw new O(`Graph.${t}: could not find the "${e}" node in the graph.`);d=r,u=o}else if(n===bi){if(r=""+r,c=i._edges.get(r),!c)throw new O(`Graph.${t}: could not find the "${r}" edge in the graph.`);const h=c.source.key,l=c.target.key;if(e===h)a=c.target;else if(e===l)a=c.source;else throw new O(`Graph.${t}: the "${e}" node is not attached to the "${r}" edge (${h}, ${l}).`);d=o,u=s}else{if(c=i._edges.get(e),!c)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`);n===vi?a=c.source:a=c.target,d=r,u=o}return[a,d,u]}function ko(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=nt(this,t,n,e,r,o);return s.attributes[a]}}function No(i,t,n){i.prototype[t]=function(e,r){const[o]=nt(this,t,n,e,r);return o.attributes}}function Lo(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=nt(this,t,n,e,r,o);return s.attributes.hasOwnProperty(a)}}function Mo(i,t,n){i.prototype[t]=function(e,r,o,s){const[a,c,d]=nt(this,t,n,e,r,o,s);return a.attributes[c]=d,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:c}),this}}function Do(i,t,n){i.prototype[t]=function(e,r,o,s){const[a,c,d]=nt(this,t,n,e,r,o,s);if(typeof d!="function")throw new W(`Graph.${t}: updater should be a function.`);const u=a.attributes,h=d(u[c]);return u[c]=h,this.emit("nodeAttributesUpdated",{key:a.key,type:"set",attributes:a.attributes,name:c}),this}}function Fo(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=nt(this,t,n,e,r,o);return delete s.attributes[a],this.emit("nodeAttributesUpdated",{key:s.key,type:"remove",attributes:s.attributes,name:a}),this}}function Go(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=nt(this,t,n,e,r,o);if(!Ce(a))throw new W(`Graph.${t}: provided attributes are not a plain object.`);return s.attributes=a,this.emit("nodeAttributesUpdated",{key:s.key,type:"replace",attributes:s.attributes}),this}}function Po(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=nt(this,t,n,e,r,o);if(!Ce(a))throw new W(`Graph.${t}: provided attributes are not a plain object.`);return Se(s.attributes,a),this.emit("nodeAttributesUpdated",{key:s.key,type:"merge",attributes:s.attributes,data:a}),this}}function Oo(i,t,n){i.prototype[t]=function(e,r,o){const[s,a]=nt(this,t,n,e,r,o);if(typeof a!="function")throw new W(`Graph.${t}: provided updater is not a function.`);return s.attributes=a(s.attributes),this.emit("nodeAttributesUpdated",{key:s.key,type:"update",attributes:s.attributes}),this}}const $o=[{name:i=>`get${i}Attribute`,attacher:ko},{name:i=>`get${i}Attributes`,attacher:No},{name:i=>`has${i}Attribute`,attacher:Lo},{name:i=>`set${i}Attribute`,attacher:Mo},{name:i=>`update${i}Attribute`,attacher:Do},{name:i=>`remove${i}Attribute`,attacher:Fo},{name:i=>`replace${i}Attributes`,attacher:Go},{name:i=>`merge${i}Attributes`,attacher:Po},{name:i=>`update${i}Attributes`,attacher:Oo}];function Uo(i){$o.forEach(function({name:t,attacher:n}){n(i,t("Node"),yi),n(i,t("Source"),vi),n(i,t("Target"),Ro),n(i,t("Opposite"),bi)})}function zo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=Ue(this,s,a,n),!o)throw new O(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return o.attributes[r]}}function Bo(i,t,n){i.prototype[t]=function(e){let r;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>1){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const o=""+e,s=""+arguments[1];if(r=Ue(this,o,s,n),!r)throw new O(`Graph.${t}: could not find an edge for the given path ("${o}" - "${s}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,r=this._edges.get(e),!r)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return r.attributes}}function jo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=Ue(this,s,a,n),!o)throw new O(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return o.attributes.hasOwnProperty(r)}}function Yo(i,t,n){i.prototype[t]=function(e,r,o){let s;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,c=""+r;if(r=arguments[2],o=arguments[3],s=Ue(this,a,c,n),!s)throw new O(`Graph.${t}: could not find an edge for the given path ("${a}" - "${c}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,s=this._edges.get(e),!s)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return s.attributes[r]=o,this.emit("edgeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:r}),this}}function Ho(i,t,n){i.prototype[t]=function(e,r,o){let s;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>3){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const a=""+e,c=""+r;if(r=arguments[2],o=arguments[3],s=Ue(this,a,c,n),!s)throw new O(`Graph.${t}: could not find an edge for the given path ("${a}" - "${c}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,s=this._edges.get(e),!s)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(typeof o!="function")throw new W(`Graph.${t}: updater should be a function.`);return s.attributes[r]=o(s.attributes[r]),this.emit("edgeAttributesUpdated",{key:s.key,type:"set",attributes:s.attributes,name:r}),this}}function Wo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=Ue(this,s,a,n),!o)throw new O(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}return delete o.attributes[r],this.emit("edgeAttributesUpdated",{key:o.key,type:"remove",attributes:o.attributes,name:r}),this}}function qo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=Ue(this,s,a,n),!o)throw new O(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(!Ce(r))throw new W(`Graph.${t}: provided attributes are not a plain object.`);return o.attributes=r,this.emit("edgeAttributesUpdated",{key:o.key,type:"replace",attributes:o.attributes}),this}}function Xo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=Ue(this,s,a,n),!o)throw new O(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(!Ce(r))throw new W(`Graph.${t}: provided attributes are not a plain object.`);return Se(o.attributes,r),this.emit("edgeAttributesUpdated",{key:o.key,type:"merge",attributes:o.attributes,data:r}),this}}function Vo(i,t,n){i.prototype[t]=function(e,r){let o;if(this.type!=="mixed"&&n!=="mixed"&&n!==this.type)throw new ne(`Graph.${t}: cannot find this type of edges in your ${this.type} graph.`);if(arguments.length>2){if(this.multi)throw new ne(`Graph.${t}: cannot use a {source,target} combo when asking about an edge's attributes in a MultiGraph since we cannot infer the one you want information about.`);const s=""+e,a=""+r;if(r=arguments[2],o=Ue(this,s,a,n),!o)throw new O(`Graph.${t}: could not find an edge for the given path ("${s}" - "${a}").`)}else{if(n!=="mixed")throw new ne(`Graph.${t}: calling this method with only a key (vs. a source and target) does not make sense since an edge with this key could have the other type.`);if(e=""+e,o=this._edges.get(e),!o)throw new O(`Graph.${t}: could not find the "${e}" edge in the graph.`)}if(typeof r!="function")throw new W(`Graph.${t}: provided updater is not a function.`);return o.attributes=r(o.attributes),this.emit("edgeAttributesUpdated",{key:o.key,type:"update",attributes:o.attributes}),this}}const Ko=[{name:i=>`get${i}Attribute`,attacher:zo},{name:i=>`get${i}Attributes`,attacher:Bo},{name:i=>`has${i}Attribute`,attacher:jo},{name:i=>`set${i}Attribute`,attacher:Yo},{name:i=>`update${i}Attribute`,attacher:Ho},{name:i=>`remove${i}Attribute`,attacher:Wo},{name:i=>`replace${i}Attributes`,attacher:qo},{name:i=>`merge${i}Attributes`,attacher:Xo},{name:i=>`update${i}Attributes`,attacher:Vo}];function Zo(i){Ko.forEach(function({name:t,attacher:n}){n(i,t("Edge"),"mixed"),n(i,t("DirectedEdge"),"directed"),n(i,t("UndirectedEdge"),"undirected")})}const Jo=[{name:"edges",type:"mixed"},{name:"inEdges",type:"directed",direction:"in"},{name:"outEdges",type:"directed",direction:"out"},{name:"inboundEdges",type:"mixed",direction:"in"},{name:"outboundEdges",type:"mixed",direction:"out"},{name:"directedEdges",type:"directed"},{name:"undirectedEdges",type:"undirected"}];function Qo(i,t,n,e){let r=!1;for(const o in t){if(o===e)continue;const s=t[o];if(r=n(s.key,s.attributes,s.source.key,s.target.key,s.source.attributes,s.target.attributes,s.undirected),i&&r)return s.key}}function es(i,t,n,e){let r,o,s,a=!1;for(const c in t)if(c!==e){r=t[c];do{if(o=r.source,s=r.target,a=n(r.key,r.attributes,o.key,s.key,o.attributes,s.attributes,r.undirected),i&&a)return r.key;r=r.next}while(r!==void 0)}}function xn(i,t){const n=Object.keys(i),e=n.length;let r,o=0;return{[Symbol.iterator](){return this},next(){do if(r)r=r.next;else{if(o>=e)return{done:!0};const s=n[o++];if(s===t){r=void 0;continue}r=i[s]}while(!r);return{done:!1,value:{edge:r.key,attributes:r.attributes,source:r.source.key,target:r.target.key,sourceAttributes:r.source.attributes,targetAttributes:r.target.attributes,undirected:r.undirected}}}}}function ts(i,t,n,e){const r=t[n];if(!r)return;const o=r.source,s=r.target;if(e(r.key,r.attributes,o.key,s.key,o.attributes,s.attributes,r.undirected)&&i)return r.key}function ns(i,t,n,e){let r=t[n];if(!r)return;let o=!1;do{if(o=e(r.key,r.attributes,r.source.key,r.target.key,r.source.attributes,r.target.attributes,r.undirected),i&&o)return r.key;r=r.next}while(r!==void 0)}function En(i,t){let n=i[t];if(n.next!==void 0)return{[Symbol.iterator](){return this},next(){if(!n)return{done:!0};const r={edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected};return n=n.next,{done:!1,value:r}}};let e=!1;return{[Symbol.iterator](){return this},next(){return e===!0?{done:!0}:(e=!0,{done:!1,value:{edge:n.key,attributes:n.attributes,source:n.source.key,target:n.target.key,sourceAttributes:n.source.attributes,targetAttributes:n.target.attributes,undirected:n.undirected}})}}}function rs(i,t){if(i.size===0)return[];if(t==="mixed"||t===i.type)return Array.from(i._edges.keys());const n=t==="undirected"?i.undirectedSize:i.directedSize,e=new Array(n),r=t==="undirected",o=i._edges.values();let s=0,a,c;for(;a=o.next(),a.done!==!0;)c=a.value,c.undirected===r&&(e[s++]=c.key);return e}function wi(i,t,n,e){if(t.size===0)return;const r=n!=="mixed"&&n!==t.type,o=n==="undirected";let s,a,c=!1;const d=t._edges.values();for(;s=d.next(),s.done!==!0;){if(a=s.value,r&&a.undirected!==o)continue;const{key:u,attributes:h,source:l,target:f}=a;if(c=e(u,h,l.key,f.key,l.attributes,f.attributes,a.undirected),i&&c)return u}}function is(i,t){if(i.size===0)return At();const n=t!=="mixed"&&t!==i.type,e=t==="undirected",r=i._edges.values();return{[Symbol.iterator](){return this},next(){let o,s;for(;;){if(o=r.next(),o.done)return o;if(s=o.value,!(n&&s.undirected!==e))break}return{value:{edge:s.key,attributes:s.attributes,source:s.source.key,target:s.target.key,sourceAttributes:s.source.attributes,targetAttributes:s.target.attributes,undirected:s.undirected},done:!1}}}}function Xn(i,t,n,e,r,o){const s=t?es:Qo;let a;if(n!=="undirected"&&(e!=="out"&&(a=s(i,r.in,o),i&&a)||e!=="in"&&(a=s(i,r.out,o,e?void 0:r.key),i&&a))||n!=="directed"&&(a=s(i,r.undirected,o),i&&a))return a}function os(i,t,n,e){const r=[];return Xn(!1,i,t,n,e,function(o){r.push(o)}),r}function ss(i,t,n){let e=At();return i!=="undirected"&&(t!=="out"&&typeof n.in<"u"&&(e=tt(e,xn(n.in))),t!=="in"&&typeof n.out<"u"&&(e=tt(e,xn(n.out,t?void 0:n.key)))),i!=="directed"&&typeof n.undirected<"u"&&(e=tt(e,xn(n.undirected))),e}function Vn(i,t,n,e,r,o,s){const a=n?ns:ts;let c;if(t!=="undirected"&&(typeof r.in<"u"&&e!=="out"&&(c=a(i,r.in,o,s),i&&c)||typeof r.out<"u"&&e!=="in"&&(e||r.key!==o)&&(c=a(i,r.out,o,s),i&&c))||t!=="directed"&&typeof r.undirected<"u"&&(c=a(i,r.undirected,o,s),i&&c))return c}function as(i,t,n,e,r){const o=[];return Vn(!1,i,t,n,e,r,function(s){o.push(s)}),o}function cs(i,t,n,e){let r=At();return i!=="undirected"&&(typeof n.in<"u"&&t!=="out"&&e in n.in&&(r=tt(r,En(n.in,e))),typeof n.out<"u"&&t!=="in"&&e in n.out&&(t||n.key!==e)&&(r=tt(r,En(n.out,e)))),i!=="directed"&&typeof n.undirected<"u"&&e in n.undirected&&(r=tt(r,En(n.undirected,e))),r}function ds(i,t){const{name:n,type:e,direction:r}=t;i.prototype[n]=function(o,s){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return[];if(!arguments.length)return rs(this,e);if(arguments.length===1){o=""+o;const a=this._nodes.get(o);if(typeof a>"u")throw new O(`Graph.${n}: could not find the "${o}" node in the graph.`);return os(this.multi,e==="mixed"?this.type:e,r,a)}if(arguments.length===2){o=""+o,s=""+s;const a=this._nodes.get(o);if(!a)throw new O(`Graph.${n}:  could not find the "${o}" source node in the graph.`);if(!this._nodes.has(s))throw new O(`Graph.${n}:  could not find the "${s}" target node in the graph.`);return as(e,this.multi,r,a,s)}throw new W(`Graph.${n}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function us(i,t){const{name:n,type:e,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[o]=function(d,u,h){if(!(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)){if(arguments.length===1)return h=d,wi(!1,this,e,h);if(arguments.length===2){d=""+d,h=u;const l=this._nodes.get(d);if(typeof l>"u")throw new O(`Graph.${o}: could not find the "${d}" node in the graph.`);return Xn(!1,this.multi,e==="mixed"?this.type:e,r,l,h)}if(arguments.length===3){d=""+d,u=""+u;const l=this._nodes.get(d);if(!l)throw new O(`Graph.${o}:  could not find the "${d}" source node in the graph.`);if(!this._nodes.has(u))throw new O(`Graph.${o}:  could not find the "${u}" target node in the graph.`);return Vn(!1,e,this.multi,r,l,u,h)}throw new W(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)}};const s="map"+n[0].toUpperCase()+n.slice(1);i.prototype[s]=function(){const d=Array.prototype.slice.call(arguments),u=d.pop();let h;if(d.length===0){let l=0;e!=="directed"&&(l+=this.undirectedSize),e!=="undirected"&&(l+=this.directedSize),h=new Array(l);let f=0;d.push((g,m,p,v,b,E,y)=>{h[f++]=u(g,m,p,v,b,E,y)})}else h=[],d.push((l,f,g,m,p,v,b)=>{h.push(u(l,f,g,m,p,v,b))});return this[o].apply(this,d),h};const a="filter"+n[0].toUpperCase()+n.slice(1);i.prototype[a]=function(){const d=Array.prototype.slice.call(arguments),u=d.pop(),h=[];return d.push((l,f,g,m,p,v,b)=>{u(l,f,g,m,p,v,b)&&h.push(l)}),this[o].apply(this,d),h};const c="reduce"+n[0].toUpperCase()+n.slice(1);i.prototype[c]=function(){let d=Array.prototype.slice.call(arguments);if(d.length<2||d.length>4)throw new W(`Graph.${c}: invalid number of arguments (expecting 2, 3 or 4 and got ${d.length}).`);if(typeof d[d.length-1]=="function"&&typeof d[d.length-2]!="function")throw new W(`Graph.${c}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let u,h;d.length===2?(u=d[0],h=d[1],d=[]):d.length===3?(u=d[1],h=d[2],d=[d[0]]):d.length===4&&(u=d[2],h=d[3],d=[d[0],d[1]]);let l=h;return d.push((f,g,m,p,v,b,E)=>{l=u(l,f,g,m,p,v,b,E)}),this[o].apply(this,d),l}}function hs(i,t){const{name:n,type:e,direction:r}=t,o="find"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[o]=function(c,d,u){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return!1;if(arguments.length===1)return u=c,wi(!0,this,e,u);if(arguments.length===2){c=""+c,u=d;const h=this._nodes.get(c);if(typeof h>"u")throw new O(`Graph.${o}: could not find the "${c}" node in the graph.`);return Xn(!0,this.multi,e==="mixed"?this.type:e,r,h,u)}if(arguments.length===3){c=""+c,d=""+d;const h=this._nodes.get(c);if(!h)throw new O(`Graph.${o}:  could not find the "${c}" source node in the graph.`);if(!this._nodes.has(d))throw new O(`Graph.${o}:  could not find the "${d}" target node in the graph.`);return Vn(!0,e,this.multi,r,h,d,u)}throw new W(`Graph.${o}: too many arguments (expecting 1, 2 or 3 and got ${arguments.length}).`)};const s="some"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[s]=function(){const c=Array.prototype.slice.call(arguments),d=c.pop();return c.push((h,l,f,g,m,p,v)=>d(h,l,f,g,m,p,v)),!!this[o].apply(this,c)};const a="every"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[a]=function(){const c=Array.prototype.slice.call(arguments),d=c.pop();return c.push((h,l,f,g,m,p,v)=>!d(h,l,f,g,m,p,v)),!this[o].apply(this,c)}}function ls(i,t){const{name:n,type:e,direction:r}=t,o=n.slice(0,-1)+"Entries";i.prototype[o]=function(s,a){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return At();if(!arguments.length)return is(this,e);if(arguments.length===1){s=""+s;const c=this._nodes.get(s);if(!c)throw new O(`Graph.${o}: could not find the "${s}" node in the graph.`);return ss(e,r,c)}if(arguments.length===2){s=""+s,a=""+a;const c=this._nodes.get(s);if(!c)throw new O(`Graph.${o}:  could not find the "${s}" source node in the graph.`);if(!this._nodes.has(a))throw new O(`Graph.${o}:  could not find the "${a}" target node in the graph.`);return cs(e,r,c,a)}throw new W(`Graph.${o}: too many arguments (expecting 0, 1 or 2 and got ${arguments.length}).`)}}function fs(i){Jo.forEach(t=>{ds(i,t),us(i,t),hs(i,t),ls(i,t)})}const gs=[{name:"neighbors",type:"mixed"},{name:"inNeighbors",type:"directed",direction:"in"},{name:"outNeighbors",type:"directed",direction:"out"},{name:"inboundNeighbors",type:"mixed",direction:"in"},{name:"outboundNeighbors",type:"mixed",direction:"out"},{name:"directedNeighbors",type:"directed"},{name:"undirectedNeighbors",type:"undirected"}];function cn(){this.A=null,this.B=null}cn.prototype.wrap=function(i){this.A===null?this.A=i:this.B===null&&(this.B=i)};cn.prototype.has=function(i){return this.A!==null&&i in this.A||this.B!==null&&i in this.B};function Mt(i,t,n,e,r){for(const o in e){const s=e[o],a=s.source,c=s.target,d=a===n?c:a;if(t&&t.has(d.key))continue;const u=r(d.key,d.attributes);if(i&&u)return d.key}}function Kn(i,t,n,e,r){if(t!=="mixed"){if(t==="undirected")return Mt(i,null,e,e.undirected,r);if(typeof n=="string")return Mt(i,null,e,e[n],r)}const o=new cn;let s;if(t!=="undirected"){if(n!=="out"){if(s=Mt(i,null,e,e.in,r),i&&s)return s;o.wrap(e.in)}if(n!=="in"){if(s=Mt(i,o,e,e.out,r),i&&s)return s;o.wrap(e.out)}}if(t!=="directed"&&(s=Mt(i,o,e,e.undirected,r),i&&s))return s}function ms(i,t,n){if(i!=="mixed"){if(i==="undirected")return Object.keys(n.undirected);if(typeof t=="string")return Object.keys(n[t])}const e=[];return Kn(!1,i,t,n,function(r){e.push(r)}),e}function Dt(i,t,n){const e=Object.keys(n),r=e.length;let o=0;return{[Symbol.iterator](){return this},next(){let s=null;do{if(o>=r)return i&&i.wrap(n),{done:!0};const a=n[e[o++]],c=a.source,d=a.target;if(s=c===t?d:c,i&&i.has(s.key)){s=null;continue}}while(s===null);return{done:!1,value:{neighbor:s.key,attributes:s.attributes}}}}}function ps(i,t,n){if(i!=="mixed"){if(i==="undirected")return Dt(null,n,n.undirected);if(typeof t=="string")return Dt(null,n,n[t])}let e=At();const r=new cn;return i!=="undirected"&&(t!=="out"&&(e=tt(e,Dt(r,n,n.in))),t!=="in"&&(e=tt(e,Dt(r,n,n.out)))),i!=="directed"&&(e=tt(e,Dt(r,n,n.undirected))),e}function ys(i,t){const{name:n,type:e,direction:r}=t;i.prototype[n]=function(o){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return[];o=""+o;const s=this._nodes.get(o);if(typeof s>"u")throw new O(`Graph.${n}: could not find the "${o}" node in the graph.`);return ms(e==="mixed"?this.type:e,r,s)}}function vs(i,t){const{name:n,type:e,direction:r}=t,o="forEach"+n[0].toUpperCase()+n.slice(1,-1);i.prototype[o]=function(d,u){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return;d=""+d;const h=this._nodes.get(d);if(typeof h>"u")throw new O(`Graph.${o}: could not find the "${d}" node in the graph.`);Kn(!1,e==="mixed"?this.type:e,r,h,u)};const s="map"+n[0].toUpperCase()+n.slice(1);i.prototype[s]=function(d,u){const h=[];return this[o](d,(l,f)=>{h.push(u(l,f))}),h};const a="filter"+n[0].toUpperCase()+n.slice(1);i.prototype[a]=function(d,u){const h=[];return this[o](d,(l,f)=>{u(l,f)&&h.push(l)}),h};const c="reduce"+n[0].toUpperCase()+n.slice(1);i.prototype[c]=function(d,u,h){if(arguments.length<3)throw new W(`Graph.${c}: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.`);let l=h;return this[o](d,(f,g)=>{l=u(l,f,g)}),l}}function bs(i,t){const{name:n,type:e,direction:r}=t,o=n[0].toUpperCase()+n.slice(1,-1),s="find"+o;i.prototype[s]=function(d,u){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return;d=""+d;const h=this._nodes.get(d);if(typeof h>"u")throw new O(`Graph.${s}: could not find the "${d}" node in the graph.`);return Kn(!0,e==="mixed"?this.type:e,r,h,u)};const a="some"+o;i.prototype[a]=function(d,u){return!!this[s](d,u)};const c="every"+o;i.prototype[c]=function(d,u){return!this[s](d,(l,f)=>!u(l,f))}}function ws(i,t){const{name:n,type:e,direction:r}=t,o=n.slice(0,-1)+"Entries";i.prototype[o]=function(s){if(e!=="mixed"&&this.type!=="mixed"&&e!==this.type)return At();s=""+s;const a=this._nodes.get(s);if(typeof a>"u")throw new O(`Graph.${o}: could not find the "${s}" node in the graph.`);return ps(e==="mixed"?this.type:e,r,a)}}function xs(i){gs.forEach(t=>{ys(i,t),vs(i,t),bs(i,t),ws(i,t)})}function Zt(i,t,n,e,r){const o=e._nodes.values(),s=e.type;let a,c,d,u,h,l;for(;a=o.next(),a.done!==!0;){let f=!1;if(c=a.value,s!=="undirected"){u=c.out;for(d in u){h=u[d];do l=h.target,f=!0,r(c.key,l.key,c.attributes,l.attributes,h.key,h.attributes,h.undirected),h=h.next;while(h)}}if(s!=="directed"){u=c.undirected;for(d in u)if(!(t&&c.key>d)){h=u[d];do l=h.target,l.key!==d&&(l=h.source),f=!0,r(c.key,l.key,c.attributes,l.attributes,h.key,h.attributes,h.undirected),h=h.next;while(h)}}n&&!f&&r(c.key,null,c.attributes,null,null,null,null)}}function Es(i,t){const n={key:i};return fi(t.attributes)||(n.attributes=Se({},t.attributes)),n}function Is(i,t,n){const e={key:t,source:n.source.key,target:n.target.key};return fi(n.attributes)||(e.attributes=Se({},n.attributes)),i==="mixed"&&n.undirected&&(e.undirected=!0),e}function As(i){if(!Ce(i))throw new W('Graph.import: invalid serialized node. A serialized node should be a plain object with at least a "key" property.');if(!("key"in i))throw new W("Graph.import: serialized node is missing its key.");if("attributes"in i&&(!Ce(i.attributes)||i.attributes===null))throw new W("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.")}function Ss(i){if(!Ce(i))throw new W('Graph.import: invalid serialized edge. A serialized edge should be a plain object with at least a "source" & "target" property.');if(!("source"in i))throw new W("Graph.import: serialized edge is missing its source.");if(!("target"in i))throw new W("Graph.import: serialized edge is missing its target.");if("attributes"in i&&(!Ce(i.attributes)||i.attributes===null))throw new W("Graph.import: invalid attributes. Attributes should be a plain object, null or omitted.");if("undirected"in i&&typeof i.undirected!="boolean")throw new W("Graph.import: invalid undirectedness information. Undirected should be boolean or omitted.")}const _s=Co(),Ts=new Set(["directed","undirected","mixed"]),Sr=new Set(["domain","_events","_eventsCount","_maxListeners"]),Cs=[{name:i=>`${i}Edge`,generateKey:!0},{name:i=>`${i}DirectedEdge`,generateKey:!0,type:"directed"},{name:i=>`${i}UndirectedEdge`,generateKey:!0,type:"undirected"},{name:i=>`${i}EdgeWithKey`},{name:i=>`${i}DirectedEdgeWithKey`,type:"directed"},{name:i=>`${i}UndirectedEdgeWithKey`,type:"undirected"}],Rs={allowSelfLoops:!0,multi:!1,type:"mixed"};function ks(i,t,n){if(n&&!Ce(n))throw new W(`Graph.addNode: invalid attributes. Expecting an object but got "${n}"`);if(t=""+t,n=n||{},i._nodes.has(t))throw new ne(`Graph.addNode: the "${t}" node already exist in the graph.`);const e=new i.NodeDataClass(t,n);return i._nodes.set(t,e),i.emit("nodeAdded",{key:t,attributes:n}),e}function _r(i,t,n){const e=new i.NodeDataClass(t,n);return i._nodes.set(t,e),i.emit("nodeAdded",{key:t,attributes:n}),e}function xi(i,t,n,e,r,o,s,a){if(!e&&i.type==="undirected")throw new ne(`Graph.${t}: you cannot add a directed edge to an undirected graph. Use the #.addEdge or #.addUndirectedEdge instead.`);if(e&&i.type==="directed")throw new ne(`Graph.${t}: you cannot add an undirected edge to a directed graph. Use the #.addEdge or #.addDirectedEdge instead.`);if(a&&!Ce(a))throw new W(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`);if(o=""+o,s=""+s,a=a||{},!i.allowSelfLoops&&o===s)throw new ne(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);const c=i._nodes.get(o),d=i._nodes.get(s);if(!c)throw new O(`Graph.${t}: source node "${o}" not found.`);if(!d)throw new O(`Graph.${t}: target node "${s}" not found.`);const u={key:null,undirected:e,source:o,target:s,attributes:a};if(n)r=i._edgeKeyGenerator();else if(r=""+r,i._edges.has(r))throw new ne(`Graph.${t}: the "${r}" edge already exists in the graph.`);if(!i.multi&&(e?typeof c.undirected[s]<"u":typeof c.out[s]<"u"))throw new ne(`Graph.${t}: an edge linking "${o}" to "${s}" already exists. If you really want to add multiple edges linking those nodes, you should create a multi graph by using the 'multi' option.`);const h=new St(e,r,c,d,a);i._edges.set(r,h);const l=o===s;return e?(c.undirectedDegree++,d.undirectedDegree++,l&&(c.undirectedLoops++,i._undirectedSelfLoopCount++)):(c.outDegree++,d.inDegree++,l&&(c.directedLoops++,i._directedSelfLoopCount++)),i.multi?h.attachMulti():h.attach(),e?i._undirectedSize++:i._directedSize++,u.key=r,i.emit("edgeAdded",u),r}function Ns(i,t,n,e,r,o,s,a,c){if(!e&&i.type==="undirected")throw new ne(`Graph.${t}: you cannot merge/update a directed edge to an undirected graph. Use the #.mergeEdge/#.updateEdge or #.addUndirectedEdge instead.`);if(e&&i.type==="directed")throw new ne(`Graph.${t}: you cannot merge/update an undirected edge to a directed graph. Use the #.mergeEdge/#.updateEdge or #.addDirectedEdge instead.`);if(a){if(c){if(typeof a!="function")throw new W(`Graph.${t}: invalid updater function. Expecting a function but got "${a}"`)}else if(!Ce(a))throw new W(`Graph.${t}: invalid attributes. Expecting an object but got "${a}"`)}o=""+o,s=""+s;let d;if(c&&(d=a,a=void 0),!i.allowSelfLoops&&o===s)throw new ne(`Graph.${t}: source & target are the same ("${o}"), thus creating a loop explicitly forbidden by this graph 'allowSelfLoops' option set to false.`);let u=i._nodes.get(o),h=i._nodes.get(s),l,f;if(!n&&(l=i._edges.get(r),l)){if((l.source.key!==o||l.target.key!==s)&&(!e||l.source.key!==s||l.target.key!==o))throw new ne(`Graph.${t}: inconsistency detected when attempting to merge the "${r}" edge with "${o}" source & "${s}" target vs. ("${l.source.key}", "${l.target.key}").`);f=l}if(!f&&!i.multi&&u&&(f=e?u.undirected[s]:u.out[s]),f){const b=[f.key,!1,!1,!1];if(c?!d:!a)return b;if(c){const E=f.attributes;f.attributes=d(E),i.emit("edgeAttributesUpdated",{type:"replace",key:f.key,attributes:f.attributes})}else Se(f.attributes,a),i.emit("edgeAttributesUpdated",{type:"merge",key:f.key,attributes:f.attributes,data:a});return b}a=a||{},c&&d&&(a=d(a));const g={key:null,undirected:e,source:o,target:s,attributes:a};if(n)r=i._edgeKeyGenerator();else if(r=""+r,i._edges.has(r))throw new ne(`Graph.${t}: the "${r}" edge already exists in the graph.`);let m=!1,p=!1;u||(u=_r(i,o,{}),m=!0,o===s&&(h=u,p=!0)),h||(h=_r(i,s,{}),p=!0),l=new St(e,r,u,h,a),i._edges.set(r,l);const v=o===s;return e?(u.undirectedDegree++,h.undirectedDegree++,v&&(u.undirectedLoops++,i._undirectedSelfLoopCount++)):(u.outDegree++,h.inDegree++,v&&(u.directedLoops++,i._directedSelfLoopCount++)),i.multi?l.attachMulti():l.attach(),e?i._undirectedSize++:i._directedSize++,g.key=r,i.emit("edgeAdded",g),[r,!0,m,p]}function wt(i,t){i._edges.delete(t.key);const{source:n,target:e,attributes:r}=t,o=t.undirected,s=n===e;o?(n.undirectedDegree--,e.undirectedDegree--,s&&(n.undirectedLoops--,i._undirectedSelfLoopCount--)):(n.outDegree--,e.inDegree--,s&&(n.directedLoops--,i._directedSelfLoopCount--)),i.multi?t.detachMulti():t.detach(),o?i._undirectedSize--:i._directedSize--,i.emit("edgeDropped",{key:t.key,attributes:r,source:n.key,target:e.key,undirected:o})}class ge extends li.EventEmitter{constructor(t){if(super(),t=Se({},Rs,t),typeof t.multi!="boolean")throw new W(`Graph.constructor: invalid 'multi' option. Expecting a boolean but got "${t.multi}".`);if(!Ts.has(t.type))throw new W(`Graph.constructor: invalid 'type' option. Should be one of "mixed", "directed" or "undirected" but got "${t.type}".`);if(typeof t.allowSelfLoops!="boolean")throw new W(`Graph.constructor: invalid 'allowSelfLoops' option. Expecting a boolean but got "${t.allowSelfLoops}".`);const n=t.type==="mixed"?gi:t.type==="directed"?mi:pi;$e(this,"NodeDataClass",n);const e="geid_"+_s()+"_";let r=0;const o=()=>{let s;do s=e+r++;while(this._edges.has(s));return s};$e(this,"_attributes",{}),$e(this,"_nodes",new Map),$e(this,"_edges",new Map),$e(this,"_directedSize",0),$e(this,"_undirectedSize",0),$e(this,"_directedSelfLoopCount",0),$e(this,"_undirectedSelfLoopCount",0),$e(this,"_edgeKeyGenerator",o),$e(this,"_options",t),Sr.forEach(s=>$e(this,s,this[s])),He(this,"order",()=>this._nodes.size),He(this,"size",()=>this._edges.size),He(this,"directedSize",()=>this._directedSize),He(this,"undirectedSize",()=>this._undirectedSize),He(this,"selfLoopCount",()=>this._directedSelfLoopCount+this._undirectedSelfLoopCount),He(this,"directedSelfLoopCount",()=>this._directedSelfLoopCount),He(this,"undirectedSelfLoopCount",()=>this._undirectedSelfLoopCount),He(this,"multi",this._options.multi),He(this,"type",this._options.type),He(this,"allowSelfLoops",this._options.allowSelfLoops),He(this,"implementation",()=>"graphology")}_resetInstanceCounters(){this._directedSize=0,this._undirectedSize=0,this._directedSelfLoopCount=0,this._undirectedSelfLoopCount=0}hasNode(t){return this._nodes.has(""+t)}hasDirectedEdge(t,n){if(this.type==="undirected")return!1;if(arguments.length===1){const e=""+t,r=this._edges.get(e);return!!r&&!r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const e=this._nodes.get(t);return e?e.out.hasOwnProperty(n):!1}throw new W(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasUndirectedEdge(t,n){if(this.type==="directed")return!1;if(arguments.length===1){const e=""+t,r=this._edges.get(e);return!!r&&r.undirected}else if(arguments.length===2){t=""+t,n=""+n;const e=this._nodes.get(t);return e?e.undirected.hasOwnProperty(n):!1}throw new W(`Graph.hasDirectedEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}hasEdge(t,n){if(arguments.length===1){const e=""+t;return this._edges.has(e)}else if(arguments.length===2){t=""+t,n=""+n;const e=this._nodes.get(t);return e?typeof e.out<"u"&&e.out.hasOwnProperty(n)||typeof e.undirected<"u"&&e.undirected.hasOwnProperty(n):!1}throw new W(`Graph.hasEdge: invalid arity (${arguments.length}, instead of 1 or 2). You can either ask for an edge id or for the existence of an edge between a source & a target.`)}directedEdge(t,n){if(this.type==="undirected")return;if(t=""+t,n=""+n,this.multi)throw new ne("Graph.directedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.directedEdges instead.");const e=this._nodes.get(t);if(!e)throw new O(`Graph.directedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new O(`Graph.directedEdge: could not find the "${n}" target node in the graph.`);const r=e.out&&e.out[n]||void 0;if(r)return r.key}undirectedEdge(t,n){if(this.type==="directed")return;if(t=""+t,n=""+n,this.multi)throw new ne("Graph.undirectedEdge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.undirectedEdges instead.");const e=this._nodes.get(t);if(!e)throw new O(`Graph.undirectedEdge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new O(`Graph.undirectedEdge: could not find the "${n}" target node in the graph.`);const r=e.undirected&&e.undirected[n]||void 0;if(r)return r.key}edge(t,n){if(this.multi)throw new ne("Graph.edge: this method is irrelevant with multigraphs since there might be multiple edges between source & target. See #.edges instead.");t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.edge: could not find the "${t}" source node in the graph.`);if(!this._nodes.has(n))throw new O(`Graph.edge: could not find the "${n}" target node in the graph.`);const r=e.out&&e.out[n]||e.undirected&&e.undirected[n]||void 0;if(r)return r.key}areDirectedNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areDirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in e.in||n in e.out}areOutNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areOutNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in e.out}areInNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areInNeighbors: could not find the "${t}" node in the graph.`);return this.type==="undirected"?!1:n in e.in}areUndirectedNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areUndirectedNeighbors: could not find the "${t}" node in the graph.`);return this.type==="directed"?!1:n in e.undirected}areNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&(n in e.in||n in e.out)||this.type!=="directed"&&n in e.undirected}areInboundNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areInboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in e.in||this.type!=="directed"&&n in e.undirected}areOutboundNeighbors(t,n){t=""+t,n=""+n;const e=this._nodes.get(t);if(!e)throw new O(`Graph.areOutboundNeighbors: could not find the "${t}" node in the graph.`);return this.type!=="undirected"&&n in e.out||this.type!=="directed"&&n in e.undirected}inDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.inDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree}outDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.outDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree}directedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.directedDegree: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree}undirectedDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.undirectedDegree: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree}inboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.inboundDegree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=n.undirectedDegree),this.type!=="undirected"&&(e+=n.inDegree),e}outboundDegree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.outboundDegree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=n.undirectedDegree),this.type!=="undirected"&&(e+=n.outDegree),e}degree(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.degree: could not find the "${t}" node in the graph.`);let e=0;return this.type!=="directed"&&(e+=n.undirectedDegree),this.type!=="undirected"&&(e+=n.inDegree+n.outDegree),e}inDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.inDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree-n.directedLoops}outDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.outDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.outDegree-n.directedLoops}directedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.directedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="undirected"?0:n.inDegree+n.outDegree-n.directedLoops*2}undirectedDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.undirectedDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);return this.type==="directed"?0:n.undirectedDegree-n.undirectedLoops*2}inboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.inboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,r=0;return this.type!=="directed"&&(e+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(e+=n.inDegree,r+=n.directedLoops),e-r}outboundDegreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.outboundDegreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,r=0;return this.type!=="directed"&&(e+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(e+=n.outDegree,r+=n.directedLoops),e-r}degreeWithoutSelfLoops(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.degreeWithoutSelfLoops: could not find the "${t}" node in the graph.`);let e=0,r=0;return this.type!=="directed"&&(e+=n.undirectedDegree,r+=n.undirectedLoops*2),this.type!=="undirected"&&(e+=n.inDegree+n.outDegree,r+=n.directedLoops*2),e-r}source(t){t=""+t;const n=this._edges.get(t);if(!n)throw new O(`Graph.source: could not find the "${t}" edge in the graph.`);return n.source.key}target(t){t=""+t;const n=this._edges.get(t);if(!n)throw new O(`Graph.target: could not find the "${t}" edge in the graph.`);return n.target.key}extremities(t){t=""+t;const n=this._edges.get(t);if(!n)throw new O(`Graph.extremities: could not find the "${t}" edge in the graph.`);return[n.source.key,n.target.key]}opposite(t,n){t=""+t,n=""+n;const e=this._edges.get(n);if(!e)throw new O(`Graph.opposite: could not find the "${n}" edge in the graph.`);const r=e.source.key,o=e.target.key;if(t===r)return o;if(t===o)return r;throw new O(`Graph.opposite: the "${t}" node is not attached to the "${n}" edge (${r}, ${o}).`)}hasExtremity(t,n){t=""+t,n=""+n;const e=this._edges.get(t);if(!e)throw new O(`Graph.hasExtremity: could not find the "${t}" edge in the graph.`);return e.source.key===n||e.target.key===n}isUndirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new O(`Graph.isUndirected: could not find the "${t}" edge in the graph.`);return n.undirected}isDirected(t){t=""+t;const n=this._edges.get(t);if(!n)throw new O(`Graph.isDirected: could not find the "${t}" edge in the graph.`);return!n.undirected}isSelfLoop(t){t=""+t;const n=this._edges.get(t);if(!n)throw new O(`Graph.isSelfLoop: could not find the "${t}" edge in the graph.`);return n.source===n.target}addNode(t,n){return ks(this,t,n).key}mergeNode(t,n){if(n&&!Ce(n))throw new W(`Graph.mergeNode: invalid attributes. Expecting an object but got "${n}"`);t=""+t,n=n||{};let e=this._nodes.get(t);return e?(n&&(Se(e.attributes,n),this.emit("nodeAttributesUpdated",{type:"merge",key:t,attributes:e.attributes,data:n})),[t,!1]):(e=new this.NodeDataClass(t,n),this._nodes.set(t,e),this.emit("nodeAdded",{key:t,attributes:n}),[t,!0])}updateNode(t,n){if(n&&typeof n!="function")throw new W(`Graph.updateNode: invalid updater function. Expecting a function but got "${n}"`);t=""+t;let e=this._nodes.get(t);if(e){if(n){const o=e.attributes;e.attributes=n(o),this.emit("nodeAttributesUpdated",{type:"replace",key:t,attributes:e.attributes})}return[t,!1]}const r=n?n({}):{};return e=new this.NodeDataClass(t,r),this._nodes.set(t,e),this.emit("nodeAdded",{key:t,attributes:r}),[t,!0]}dropNode(t){t=""+t;const n=this._nodes.get(t);if(!n)throw new O(`Graph.dropNode: could not find the "${t}" node in the graph.`);let e;if(this.type!=="undirected"){for(const r in n.out){e=n.out[r];do wt(this,e),e=e.next;while(e)}for(const r in n.in){e=n.in[r];do wt(this,e),e=e.next;while(e)}}if(this.type!=="directed")for(const r in n.undirected){e=n.undirected[r];do wt(this,e),e=e.next;while(e)}this._nodes.delete(t),this.emit("nodeDropped",{key:t,attributes:n.attributes})}dropEdge(t){let n;if(arguments.length>1){const e=""+arguments[0],r=""+arguments[1];if(n=Ue(this,e,r,this.type),!n)throw new O(`Graph.dropEdge: could not find the "${e}" -> "${r}" edge in the graph.`)}else if(t=""+t,n=this._edges.get(t),!n)throw new O(`Graph.dropEdge: could not find the "${t}" edge in the graph.`);return wt(this,n),this}dropDirectedEdge(t,n){if(arguments.length<2)throw new ne("Graph.dropDirectedEdge: it does not make sense to try and drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ne("Graph.dropDirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");t=""+t,n=""+n;const e=Ue(this,t,n,"directed");if(!e)throw new O(`Graph.dropDirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return wt(this,e),this}dropUndirectedEdge(t,n){if(arguments.length<2)throw new ne("Graph.dropUndirectedEdge: it does not make sense to drop a directed edge by key. What if the edge with this key is undirected? Use #.dropEdge for this purpose instead.");if(this.multi)throw new ne("Graph.dropUndirectedEdge: cannot use a {source,target} combo when dropping an edge in a MultiGraph since we cannot infer the one you want to delete as there could be multiple ones.");const e=Ue(this,t,n,"undirected");if(!e)throw new O(`Graph.dropUndirectedEdge: could not find a "${t}" -> "${n}" edge in the graph.`);return wt(this,e),this}clear(){this._edges.clear(),this._nodes.clear(),this._resetInstanceCounters(),this.emit("cleared")}clearEdges(){const t=this._nodes.values();let n;for(;n=t.next(),n.done!==!0;)n.value.clear();this._edges.clear(),this._resetInstanceCounters(),this.emit("edgesCleared")}getAttribute(t){return this._attributes[t]}getAttributes(){return this._attributes}hasAttribute(t){return this._attributes.hasOwnProperty(t)}setAttribute(t,n){return this._attributes[t]=n,this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}updateAttribute(t,n){if(typeof n!="function")throw new W("Graph.updateAttribute: updater should be a function.");const e=this._attributes[t];return this._attributes[t]=n(e),this.emit("attributesUpdated",{type:"set",attributes:this._attributes,name:t}),this}removeAttribute(t){return delete this._attributes[t],this.emit("attributesUpdated",{type:"remove",attributes:this._attributes,name:t}),this}replaceAttributes(t){if(!Ce(t))throw new W("Graph.replaceAttributes: provided attributes are not a plain object.");return this._attributes=t,this.emit("attributesUpdated",{type:"replace",attributes:this._attributes}),this}mergeAttributes(t){if(!Ce(t))throw new W("Graph.mergeAttributes: provided attributes are not a plain object.");return Se(this._attributes,t),this.emit("attributesUpdated",{type:"merge",attributes:this._attributes,data:t}),this}updateAttributes(t){if(typeof t!="function")throw new W("Graph.updateAttributes: provided updater is not a function.");return this._attributes=t(this._attributes),this.emit("attributesUpdated",{type:"update",attributes:this._attributes}),this}updateEachNodeAttributes(t,n){if(typeof t!="function")throw new W("Graph.updateEachNodeAttributes: expecting an updater function.");if(n&&!Ar(n))throw new W("Graph.updateEachNodeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const e=this._nodes.values();let r,o;for(;r=e.next(),r.done!==!0;)o=r.value,o.attributes=t(o.key,o.attributes);this.emit("eachNodeAttributesUpdated",{hints:n||null})}updateEachEdgeAttributes(t,n){if(typeof t!="function")throw new W("Graph.updateEachEdgeAttributes: expecting an updater function.");if(n&&!Ar(n))throw new W("Graph.updateEachEdgeAttributes: invalid hints. Expecting an object having the following shape: {attributes?: [string]}");const e=this._edges.values();let r,o,s,a;for(;r=e.next(),r.done!==!0;)o=r.value,s=o.source,a=o.target,o.attributes=t(o.key,o.attributes,s.key,a.key,s.attributes,a.attributes,o.undirected);this.emit("eachEdgeAttributesUpdated",{hints:n||null})}forEachAdjacencyEntry(t){if(typeof t!="function")throw new W("Graph.forEachAdjacencyEntry: expecting a callback.");Zt(!1,!1,!1,this,t)}forEachAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new W("Graph.forEachAdjacencyEntryWithOrphans: expecting a callback.");Zt(!1,!1,!0,this,t)}forEachAssymetricAdjacencyEntry(t){if(typeof t!="function")throw new W("Graph.forEachAssymetricAdjacencyEntry: expecting a callback.");Zt(!1,!0,!1,this,t)}forEachAssymetricAdjacencyEntryWithOrphans(t){if(typeof t!="function")throw new W("Graph.forEachAssymetricAdjacencyEntryWithOrphans: expecting a callback.");Zt(!1,!0,!0,this,t)}nodes(){return Array.from(this._nodes.keys())}forEachNode(t){if(typeof t!="function")throw new W("Graph.forEachNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)r=e.value,t(r.key,r.attributes)}findNode(t){if(typeof t!="function")throw new W("Graph.findNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)if(r=e.value,t(r.key,r.attributes))return r.key}mapNodes(t){if(typeof t!="function")throw new W("Graph.mapNode: expecting a callback.");const n=this._nodes.values();let e,r;const o=new Array(this.order);let s=0;for(;e=n.next(),e.done!==!0;)r=e.value,o[s++]=t(r.key,r.attributes);return o}someNode(t){if(typeof t!="function")throw new W("Graph.someNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)if(r=e.value,t(r.key,r.attributes))return!0;return!1}everyNode(t){if(typeof t!="function")throw new W("Graph.everyNode: expecting a callback.");const n=this._nodes.values();let e,r;for(;e=n.next(),e.done!==!0;)if(r=e.value,!t(r.key,r.attributes))return!1;return!0}filterNodes(t){if(typeof t!="function")throw new W("Graph.filterNodes: expecting a callback.");const n=this._nodes.values();let e,r;const o=[];for(;e=n.next(),e.done!==!0;)r=e.value,t(r.key,r.attributes)&&o.push(r.key);return o}reduceNodes(t,n){if(typeof t!="function")throw new W("Graph.reduceNodes: expecting a callback.");if(arguments.length<2)throw new W("Graph.reduceNodes: missing initial value. You must provide it because the callback takes more than one argument and we cannot infer the initial value from the first iteration, as you could with a simple array.");let e=n;const r=this._nodes.values();let o,s;for(;o=r.next(),o.done!==!0;)s=o.value,e=t(e,s.key,s.attributes);return e}nodeEntries(){const t=this._nodes.values();return{[Symbol.iterator](){return this},next(){const n=t.next();if(n.done)return n;const e=n.value;return{value:{node:e.key,attributes:e.attributes},done:!1}}}}export(){const t=new Array(this._nodes.size);let n=0;this._nodes.forEach((r,o)=>{t[n++]=Es(o,r)});const e=new Array(this._edges.size);return n=0,this._edges.forEach((r,o)=>{e[n++]=Is(this.type,o,r)}),{options:{type:this.type,multi:this.multi,allowSelfLoops:this.allowSelfLoops},attributes:this.getAttributes(),nodes:t,edges:e}}import(t,n=!1){if(t instanceof ge)return t.forEachNode((c,d)=>{n?this.mergeNode(c,d):this.addNode(c,d)}),t.forEachEdge((c,d,u,h,l,f,g)=>{n?g?this.mergeUndirectedEdgeWithKey(c,u,h,d):this.mergeDirectedEdgeWithKey(c,u,h,d):g?this.addUndirectedEdgeWithKey(c,u,h,d):this.addDirectedEdgeWithKey(c,u,h,d)}),this;if(!Ce(t))throw new W("Graph.import: invalid argument. Expecting a serialized graph or, alternatively, a Graph instance.");if(t.attributes){if(!Ce(t.attributes))throw new W("Graph.import: invalid attributes. Expecting a plain object.");n?this.mergeAttributes(t.attributes):this.replaceAttributes(t.attributes)}let e,r,o,s,a;if(t.nodes){if(o=t.nodes,!Array.isArray(o))throw new W("Graph.import: invalid nodes. Expecting an array.");for(e=0,r=o.length;e<r;e++){s=o[e],As(s);const{key:c,attributes:d}=s;n?this.mergeNode(c,d):this.addNode(c,d)}}if(t.edges){let c=!1;if(this.type==="undirected"&&(c=!0),o=t.edges,!Array.isArray(o))throw new W("Graph.import: invalid edges. Expecting an array.");for(e=0,r=o.length;e<r;e++){a=o[e],Ss(a);const{source:d,target:u,attributes:h,undirected:l=c}=a;let f;"key"in a?(f=n?l?this.mergeUndirectedEdgeWithKey:this.mergeDirectedEdgeWithKey:l?this.addUndirectedEdgeWithKey:this.addDirectedEdgeWithKey,f.call(this,a.key,d,u,h)):(f=n?l?this.mergeUndirectedEdge:this.mergeDirectedEdge:l?this.addUndirectedEdge:this.addDirectedEdge,f.call(this,d,u,h))}}return this}nullCopy(t){const n=new ge(Se({},this._options,t));return n.replaceAttributes(Se({},this.getAttributes())),n}emptyCopy(t){const n=this.nullCopy(t);return this._nodes.forEach((e,r)=>{const o=Se({},e.attributes);e=new n.NodeDataClass(r,o),n._nodes.set(r,e)}),n}copy(t){if(t=t||{},typeof t.type=="string"&&t.type!==this.type&&t.type!=="mixed")throw new ne(`Graph.copy: cannot create an incompatible copy from "${this.type}" type to "${t.type}" because this would mean losing information about the current graph.`);if(typeof t.multi=="boolean"&&t.multi!==this.multi&&t.multi!==!0)throw new ne("Graph.copy: cannot create an incompatible copy by downgrading a multi graph to a simple one because this would mean losing information about the current graph.");if(typeof t.allowSelfLoops=="boolean"&&t.allowSelfLoops!==this.allowSelfLoops&&t.allowSelfLoops!==!0)throw new ne("Graph.copy: cannot create an incompatible copy from a graph allowing self loops to one that does not because this would mean losing information about the current graph.");const n=this.emptyCopy(t),e=this._edges.values();let r,o;for(;r=e.next(),r.done!==!0;)o=r.value,xi(n,"copy",!1,o.undirected,o.key,o.source.key,o.target.key,Se({},o.attributes));return n}toJSON(){return this.export()}toString(){return"[object Graph]"}inspect(){const t={};this._nodes.forEach((o,s)=>{t[s]=o.attributes});const n={},e={};this._edges.forEach((o,s)=>{const a=o.undirected?"--":"->";let c="",d=o.source.key,u=o.target.key,h;o.undirected&&d>u&&(h=d,d=u,u=h);const l=`(${d})${a}(${u})`;s.startsWith("geid_")?this.multi&&(typeof e[l]>"u"?e[l]=0:e[l]++,c+=`${e[l]}. `):c+=`[${s}]: `,c+=l,n[c]=o.attributes});const r={};for(const o in this)this.hasOwnProperty(o)&&!Sr.has(o)&&typeof this[o]!="function"&&typeof o!="symbol"&&(r[o]=this[o]);return r.attributes=this._attributes,r.nodes=t,r.edges=n,$e(r,"constructor",this.constructor),r}}typeof Symbol<"u"&&(ge.prototype[Symbol.for("nodejs.util.inspect.custom")]=ge.prototype.inspect);Cs.forEach(i=>{["add","merge","update"].forEach(t=>{const n=i.name(t),e=t==="add"?xi:Ns;i.generateKey?ge.prototype[n]=function(r,o,s){return e(this,n,!0,(i.type||this.type)==="undirected",null,r,o,s,t==="update")}:ge.prototype[n]=function(r,o,s,a){return e(this,n,!1,(i.type||this.type)==="undirected",r,o,s,a,t==="update")}})});Uo(ge);Zo(ge);fs(ge);xs(ge);class Ei extends ge{constructor(t){const n=Se({type:"directed"},t);if("multi"in n&&n.multi!==!1)throw new W("DirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="directed")throw new W('DirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Ii extends ge{constructor(t){const n=Se({type:"undirected"},t);if("multi"in n&&n.multi!==!1)throw new W("UndirectedGraph.from: inconsistent indication that the graph should be multi in given options!");if(n.type!=="undirected")throw new W('UndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class Ai extends ge{constructor(t){const n=Se({multi:!0},t);if("multi"in n&&n.multi!==!0)throw new W("MultiGraph.from: inconsistent indication that the graph should be simple in given options!");super(n)}}class Si extends ge{constructor(t){const n=Se({type:"directed",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new W("MultiDirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="directed")throw new W('MultiDirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}class _i extends ge{constructor(t){const n=Se({type:"undirected",multi:!0},t);if("multi"in n&&n.multi!==!0)throw new W("MultiUndirectedGraph.from: inconsistent indication that the graph should be simple in given options!");if(n.type!=="undirected")throw new W('MultiUndirectedGraph.from: inconsistent "'+n.type+'" type in given options!');super(n)}}function _t(i){i.from=function(t,n){const e=Se({},t.options,n),r=new i(e);return r.import(t),r}}_t(ge);_t(Ei);_t(Ii);_t(Ai);_t(Si);_t(_i);ge.Graph=ge;ge.DirectedGraph=Ei;ge.UndirectedGraph=Ii;ge.MultiGraph=Ai;ge.MultiDirectedGraph=Si;ge.MultiUndirectedGraph=_i;ge.InvalidArgumentsGraphError=W;ge.NotFoundGraphError=O;ge.UsageGraphError=ne;function Ls(i,t){if(typeof i!="object"||!i)return i;var n=i[Symbol.toPrimitive];if(n!==void 0){var e=n.call(i,t);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function jt(i){var t=Ls(i,"string");return typeof t=="symbol"?t:t+""}function Ne(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function Tr(i,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,jt(e.key),e)}}function Le(i,t,n){return t&&Tr(i.prototype,t),n&&Tr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i}function Et(i){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Et(i)}function Ti(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ti=function(){return!!i})()}function Ms(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Ds(i,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ms(i)}function ze(i,t,n){return t=Et(t),Ds(i,Ti()?Reflect.construct(t,n||[],Et(i).constructor):t.apply(i,n))}function Fn(i,t){return Fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},Fn(i,t)}function Be(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(t&&t.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),t&&Fn(i,t)}function Fs(i){if(Array.isArray(i))return i}function Gs(i,t){var n=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(n!=null){var e,r,o,s,a=[],c=!0,d=!1;try{if(o=(n=n.call(i)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(e=o.call(n)).done)&&(a.push(e.value),a.length!==t);c=!0);}catch(u){d=!0,r=u}finally{try{if(!c&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(d)throw r}}return a}}function Gn(i,t){(t==null||t>i.length)&&(t=i.length);for(var n=0,e=Array(t);n<t;n++)e[n]=i[n];return e}function Ci(i,t){if(i){if(typeof i=="string")return Gn(i,t);var n={}.toString.call(i).slice(8,-1);return n==="Object"&&i.constructor&&(n=i.constructor.name),n==="Map"||n==="Set"?Array.from(i):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gn(i,t):void 0}}function Ps(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function It(i,t){return Fs(i)||Gs(i,t)||Ci(i,t)||Ps()}var In={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},Ri=new Int8Array(4),An=new Int32Array(Ri.buffer,0,1),Os=new Float32Array(Ri.buffer,0,1),$s=/^\s*rgba?\s*\(/,Us=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function zs(i){var t=0,n=0,e=0,r=1;if(i[0]==="#")i.length===4?(t=parseInt(i.charAt(1)+i.charAt(1),16),n=parseInt(i.charAt(2)+i.charAt(2),16),e=parseInt(i.charAt(3)+i.charAt(3),16)):(t=parseInt(i.charAt(1)+i.charAt(2),16),n=parseInt(i.charAt(3)+i.charAt(4),16),e=parseInt(i.charAt(5)+i.charAt(6),16)),i.length===9&&(r=parseInt(i.charAt(7)+i.charAt(8),16)/255);else if($s.test(i)){var o=i.match(Us);o&&(t=+o[1],n=+o[2],e=+o[3],o[4]&&(r=+o[4]))}return{r:t,g:n,b:e,a:r}}var xt={};for(var Jt in In)xt[Jt]=Ht(In[Jt]),xt[In[Jt]]=xt[Jt];function ki(i,t,n,e,r){return An[0]=e<<24|n<<16|t<<8|i,An[0]=An[0]&4278190079,Os[0]}function Ht(i){if(i=i.toLowerCase(),typeof xt[i]<"u")return xt[i];var t=zs(i),n=t.r,e=t.g,r=t.b,o=t.a;o=o*255|0;var s=ki(n,e,r,o);return xt[i]=s,s}var Sn={};function Ni(i){if(typeof Sn[i]<"u")return Sn[i];var t=(i&16711680)>>>16,n=(i&65280)>>>8,e=i&255,r=255,o=ki(t,n,e,r);return Sn[i]=o,o}function Cr(i,t,n,e){return n+(t<<8)+(i<<16)}function Rr(i,t,n,e,r,o){var s=Math.floor(n/o*r),a=Math.floor(i.drawingBufferHeight/o-e/o*r),c=new Uint8Array(4);i.bindFramebuffer(i.FRAMEBUFFER,t),i.readPixels(s,a,1,1,i.RGBA,i.UNSIGNED_BYTE,c);var d=It(c,4),u=d[0],h=d[1],l=d[2],f=d[3];return[u,h,l,f]}function M(i,t,n){return(t=jt(t))in i?Object.defineProperty(i,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[t]=n,i}function kr(i,t){var n=Object.keys(i);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(i);t&&(e=e.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),n.push.apply(n,e)}return n}function K(i){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kr(Object(n),!0).forEach(function(e){M(i,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):kr(Object(n)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(n,e))})}return i}function Bs(i,t){for(;!{}.hasOwnProperty.call(i,t)&&(i=Et(i))!==null;);return i}function Pn(){return Pn=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(i,t,n){var e=Bs(i,t);if(e){var r=Object.getOwnPropertyDescriptor(e,t);return r.get?r.get.call(arguments.length<3?i:n):r.value}},Pn.apply(null,arguments)}function Li(i,t,n,e){var r=Pn(Et(i.prototype),t,n);return typeof r=="function"?function(o){return r.apply(n,o)}:r}function js(i){return i.normalized?1:i.size}function _n(i){var t=0;return i.forEach(function(n){return t+=js(n)}),t}function Mi(i,t,n){var e=i==="VERTEX"?t.VERTEX_SHADER:t.FRAGMENT_SHADER,r=t.createShader(e);if(r===null)throw new Error("loadShader: error while creating the shader");t.shaderSource(r,n),t.compileShader(r);var o=t.getShaderParameter(r,t.COMPILE_STATUS);if(!o){var s=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`loadShader: error while compiling the shader:
`.concat(s,`
`).concat(n))}return r}function Ys(i,t){return Mi("VERTEX",i,t)}function Hs(i,t){return Mi("FRAGMENT",i,t)}function Ws(i,t){var n=i.createProgram();if(n===null)throw new Error("loadProgram: error while creating the program.");var e,r;for(e=0,r=t.length;e<r;e++)i.attachShader(n,t[e]);i.linkProgram(n);var o=i.getProgramParameter(n,i.LINK_STATUS);if(!o)throw i.deleteProgram(n),new Error("loadProgram: error while linking the program.");return n}function Nr(i){var t=i.gl,n=i.buffer,e=i.program,r=i.vertexShader,o=i.fragmentShader;t.deleteShader(r),t.deleteShader(o),t.deleteProgram(e),t.deleteBuffer(n)}var Lr=`#define PICKING_MODE
`,qs=M(M(M(M(M(M(M(M({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),Di=(function(){function i(t,n,e){Ne(this,i),M(this,"array",new Float32Array),M(this,"constantArray",new Float32Array),M(this,"capacity",0),M(this,"verticesCount",0);var r=this.getDefinition();if(this.VERTICES=r.VERTICES,this.VERTEX_SHADER_SOURCE=r.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=r.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=r.UNIFORMS,this.ATTRIBUTES=r.ATTRIBUTES,this.METHOD=r.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in r?r.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in r?r.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in r,this.ATTRIBUTES_ITEMS_COUNT=_n(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=e,this.normalProgram=this.getProgramInfo("normal",t,r.VERTEX_SHADER_SOURCE,r.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=n?this.getProgramInfo("pick",t,Lr+r.VERTEX_SHADER_SOURCE,Lr+r.FRAGMENT_SHADER_SOURCE,n):null,this.isInstanced){var o=_n(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*o);for(var s=0;s<this.CONSTANT_DATA.length;s++){var a=this.CONSTANT_DATA[s];if(a.length!==o)throw new Error("Program: error while getting constant data (one vector has ".concat(a.length," items instead of ").concat(o,")"));for(var c=0;c<a.length;c++)this.constantArray[s*o+c]=a[c]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return Le(i,[{key:"kill",value:function(){Nr(this.normalProgram),this.pickProgram&&(Nr(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(n,e,r,o,s){var a=this.getDefinition(),c=e.createBuffer();if(c===null)throw new Error("Program: error while creating the WebGL buffer.");var d=Ys(e,r),u=Hs(e,o),h=Ws(e,[d,u]),l={};a.UNIFORMS.forEach(function(m){var p=e.getUniformLocation(h,m);p&&(l[m]=p)});var f={};a.ATTRIBUTES.forEach(function(m){f[m.name]=e.getAttribLocation(h,m.name)});var g;if("CONSTANT_ATTRIBUTES"in a&&(a.CONSTANT_ATTRIBUTES.forEach(function(m){f[m.name]=e.getAttribLocation(h,m.name)}),g=e.createBuffer(),g===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:n,program:h,gl:e,frameBuffer:s,buffer:c,constantBuffer:g||{},uniformLocations:l,attributeLocations:f,isPicking:n==="pick",vertexShader:d,fragmentShader:u}}},{key:"bindProgram",value:function(n){var e=this,r=0,o=n.gl,s=n.buffer;this.isInstanced?(o.bindBuffer(o.ARRAY_BUFFER,n.constantBuffer),r=0,this.CONSTANT_ATTRIBUTES.forEach(function(a){return r+=e.bindAttribute(a,n,r,!1)}),o.bufferData(o.ARRAY_BUFFER,this.constantArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,n.buffer),r=0,this.ATTRIBUTES.forEach(function(a){return r+=e.bindAttribute(a,n,r,!0)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)):(o.bindBuffer(o.ARRAY_BUFFER,s),r=0,this.ATTRIBUTES.forEach(function(a){return r+=e.bindAttribute(a,n,r)}),o.bufferData(o.ARRAY_BUFFER,this.array,o.DYNAMIC_DRAW)),o.bindBuffer(o.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(n){var e=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(r){return e.unbindAttribute(r,n,!1)}),this.ATTRIBUTES.forEach(function(r){return e.unbindAttribute(r,n,!0)})):this.ATTRIBUTES.forEach(function(r){return e.unbindAttribute(r,n)})}},{key:"bindAttribute",value:function(n,e,r,o){var s=qs[n.type];if(typeof s!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(n.type,'"'));var a=e.attributeLocations[n.name],c=e.gl;if(a!==-1){c.enableVertexAttribArray(a);var d=this.isInstanced?(o?this.ATTRIBUTES_ITEMS_COUNT:_n(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(c.vertexAttribPointer(a,n.size,n.type,n.normalized||!1,d,r),this.isInstanced&&o)if(c instanceof WebGL2RenderingContext)c.vertexAttribDivisor(a,1);else{var u=c.getExtension("ANGLE_instanced_arrays");u&&u.vertexAttribDivisorANGLE(a,1)}}return n.size*s}},{key:"unbindAttribute",value:function(n,e,r){var o=e.attributeLocations[n.name],s=e.gl;if(o!==-1&&(s.disableVertexAttribArray(o),this.isInstanced&&r))if(s instanceof WebGL2RenderingContext)s.vertexAttribDivisor(o,0);else{var a=s.getExtension("ANGLE_instanced_arrays");a&&a.vertexAttribDivisorANGLE(o,0)}}},{key:"reallocate",value:function(n){n!==this.capacity&&(this.capacity=n,this.verticesCount=this.VERTICES*n,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(n,e){var r=e.gl,o=e.program;r.enable(r.BLEND),r.useProgram(o),this.setUniforms(n,e),this.drawWebGL(this.METHOD,e)}},{key:"render",value:function(n){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,n.width*n.pixelRatio/n.downSizingRatio,n.height*n.pixelRatio/n.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(K(K({},n),{},{pixelRatio:n.pixelRatio/n.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,n.width*n.pixelRatio,n.height*n.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(n,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(n,e){var r=e.gl,o=e.frameBuffer;if(r.bindFramebuffer(r.FRAMEBUFFER,o),!this.isInstanced)r.drawArrays(n,0,this.verticesCount);else if(r instanceof WebGL2RenderingContext)r.drawArraysInstanced(n,0,this.VERTICES,this.capacity);else{var s=r.getExtension("ANGLE_instanced_arrays");s&&s.drawArraysInstancedANGLE(n,0,this.VERTICES,this.capacity)}}}])})(),Xs=(function(i){function t(){return Ne(this,t),ze(this,t,arguments)}return Be(t,i),Le(t,[{key:"kill",value:function(){Li(t,"kill",this)([])}},{key:"process",value:function(e,r,o){var s=r*this.STRIDE;if(o.hidden){for(var a=s+this.STRIDE;s<a;s++)this.array[s]=0;return}return this.processVisibleItem(Ni(e),s,o)}}])})(Di),Zn=(function(i){function t(){var n;Ne(this,t);for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return n=ze(this,t,[].concat(r)),M(n,"drawLabel",void 0),n}return Be(t,i),Le(t,[{key:"kill",value:function(){Li(t,"kill",this)([])}},{key:"process",value:function(e,r,o,s,a){var c=r*this.STRIDE;if(a.hidden||o.hidden||s.hidden){for(var d=c+this.STRIDE;c<d;c++)this.array[c]=0;return}return this.processVisibleItem(Ni(e),c,o,s,a)}}])})(Di);function Vs(i,t){return(function(){function n(e,r,o){Ne(this,n),M(this,"drawLabel",t),this.programs=i.map(function(s){return new s(e,r,o)})}return Le(n,[{key:"reallocate",value:function(r){this.programs.forEach(function(o){return o.reallocate(r)})}},{key:"process",value:function(r,o,s,a,c){this.programs.forEach(function(d){return d.process(r,o,s,a,c)})}},{key:"render",value:function(r){this.programs.forEach(function(o){return o.render(r)})}},{key:"kill",value:function(){this.programs.forEach(function(r){return r.kill()})}}])})()}function Ks(i,t,n,e,r){var o=r.edgeLabelSize,s=r.edgeLabelFont,a=r.edgeLabelWeight,c=r.edgeLabelColor.attribute?t[r.edgeLabelColor.attribute]||r.edgeLabelColor.color||"#000":r.edgeLabelColor.color,d=t.label;if(d){i.fillStyle=c,i.font="".concat(a," ").concat(o,"px ").concat(s);var u=n.size,h=e.size,l=n.x,f=n.y,g=e.x,m=e.y,p=(l+g)/2,v=(f+m)/2,b=g-l,E=m-f,y=Math.sqrt(b*b+E*E);if(!(y<u+h)){l+=b*u/y,f+=E*u/y,g-=b*h/y,m-=E*h/y,p=(l+g)/2,v=(f+m)/2,b=g-l,E=m-f,y=Math.sqrt(b*b+E*E);var I=i.measureText(d).width;if(I>y){var x="";for(d=d+x,I=i.measureText(d).width;I>y&&d.length>1;)d=d.slice(0,-2)+x,I=i.measureText(d).width;if(d.length<4)return}var w;b>0?E>0?w=Math.acos(b/y):w=Math.asin(E/y):E>0?w=Math.acos(b/y)+Math.PI:w=Math.asin(b/y)+Math.PI/2,i.save(),i.translate(p,v),i.rotate(w),i.fillText(d,-I/2,t.size/2+o),i.restore()}}}function Fi(i,t,n){if(t.label){var e=n.labelSize,r=n.labelFont,o=n.labelWeight,s=n.labelColor.attribute?t[n.labelColor.attribute]||n.labelColor.color||"#000":n.labelColor.color;i.fillStyle=s,i.font="".concat(o," ").concat(e,"px ").concat(r),i.fillText(t.label,t.x+t.size+3,t.y+e/3)}}function Zs(i,t,n){var e=n.labelSize,r=n.labelFont,o=n.labelWeight;i.font="".concat(o," ").concat(e,"px ").concat(r),i.fillStyle="#FFF",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=8,i.shadowColor="#000";var s=2;if(typeof t.label=="string"){var a=i.measureText(t.label).width,c=Math.round(a+5),d=Math.round(e+2*s),u=Math.max(t.size,e/2)+s,h=Math.asin(d/2/u),l=Math.sqrt(Math.abs(Math.pow(u,2)-Math.pow(d/2,2)));i.beginPath(),i.moveTo(t.x+l,t.y+d/2),i.lineTo(t.x+u+c,t.y+d/2),i.lineTo(t.x+u+c,t.y-d/2),i.lineTo(t.x+l,t.y-d/2),i.arc(t.x,t.y,u,h,-h),i.closePath(),i.fill()}else i.beginPath(),i.arc(t.x,t.y,t.size+s,0,Math.PI*2),i.closePath(),i.fill();i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,Fi(i,t,n)}var Js=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Qs=Js,ea=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ta=ea,Gi=WebGLRenderingContext,Mr=Gi.UNSIGNED_BYTE,Tn=Gi.FLOAT,na=["u_sizeRatio","u_correctionRatio","u_matrix"],dn=(function(i){function t(){return Ne(this,t),ze(this,t,arguments)}return Be(t,i),Le(t,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:ta,FRAGMENT_SHADER_SOURCE:Qs,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:na,ATTRIBUTES:[{name:"a_position",size:2,type:Tn},{name:"a_size",size:1,type:Tn},{name:"a_color",size:4,type:Mr,normalized:!0},{name:"a_id",size:4,type:Mr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:Tn}],CONSTANT_DATA:[[t.ANGLE_1],[t.ANGLE_2],[t.ANGLE_3]]}}},{key:"processVisibleItem",value:function(e,r,o){var s=this.array,a=Ht(o.color);s[r++]=o.x,s[r++]=o.y,s[r++]=o.size,s[r++]=a,s[r++]=e}},{key:"setUniforms",value:function(e,r){var o=r.gl,s=r.uniformLocations,a=s.u_sizeRatio,c=s.u_correctionRatio,d=s.u_matrix;o.uniform1f(c,e.correctionRatio),o.uniform1f(a,e.sizeRatio),o.uniformMatrix3fv(d,!1,e.matrix)}}])})(Xs);M(dn,"ANGLE_1",0);M(dn,"ANGLE_2",2*Math.PI/3);M(dn,"ANGLE_3",4*Math.PI/3);var ra=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,ia=ra,oa=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,sa=oa,Pi=WebGLRenderingContext,Dr=Pi.UNSIGNED_BYTE,Qt=Pi.FLOAT,aa=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Oi={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function $i(i){var t=K(K({},Oi),{});return(function(n){function e(){return Ne(this,e),ze(this,e,arguments)}return Be(e,n),Le(e,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:sa,FRAGMENT_SHADER_SOURCE:ia,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:aa,ATTRIBUTES:[{name:"a_position",size:2,type:Qt},{name:"a_normal",size:2,type:Qt},{name:"a_radius",size:1,type:Qt},{name:"a_color",size:4,type:Dr,normalized:!0},{name:"a_id",size:4,type:Dr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:Qt}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(o,s,a,c,d){if(t.extremity==="source"){var u=[c,a];a=u[0],c=u[1]}var h=d.size||1,l=c.size||1,f=a.x,g=a.y,m=c.x,p=c.y,v=Ht(d.color),b=m-f,E=p-g,y=b*b+E*E,I=0,x=0;y&&(y=1/Math.sqrt(y),I=-E*y*h,x=b*y*h);var w=this.array;w[s++]=m,w[s++]=p,w[s++]=-I,w[s++]=-x,w[s++]=l,w[s++]=v,w[s++]=o}},{key:"setUniforms",value:function(o,s){var a=s.gl,c=s.uniformLocations,d=c.u_matrix,u=c.u_sizeRatio,h=c.u_correctionRatio,l=c.u_minEdgeThickness,f=c.u_lengthToThicknessRatio,g=c.u_widenessToThicknessRatio;a.uniformMatrix3fv(d,!1,o.matrix),a.uniform1f(u,o.sizeRatio),a.uniform1f(h,o.correctionRatio),a.uniform1f(l,o.minEdgeThickness),a.uniform1f(f,t.lengthToThicknessRatio),a.uniform1f(g,t.widenessToThicknessRatio)}}])})(Zn)}$i();var ca=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,Ui=ca,da=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ua=da,zi=WebGLRenderingContext,Fr=zi.UNSIGNED_BYTE,gt=zi.FLOAT,ha=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],la={lengthToThicknessRatio:Oi.lengthToThicknessRatio};function Bi(i){var t=K(K({},la),{});return(function(n){function e(){return Ne(this,e),ze(this,e,arguments)}return Be(e,n),Le(e,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ua,FRAGMENT_SHADER_SOURCE:Ui,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:ha,ATTRIBUTES:[{name:"a_positionStart",size:2,type:gt},{name:"a_positionEnd",size:2,type:gt},{name:"a_normal",size:2,type:gt},{name:"a_color",size:4,type:Fr,normalized:!0},{name:"a_id",size:4,type:Fr,normalized:!0},{name:"a_radius",size:1,type:gt}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:gt},{name:"a_normalCoef",size:1,type:gt},{name:"a_radiusCoef",size:1,type:gt}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(o,s,a,c,d){var u=d.size||1,h=a.x,l=a.y,f=c.x,g=c.y,m=Ht(d.color),p=f-h,v=g-l,b=c.size||1,E=p*p+v*v,y=0,I=0;E&&(E=1/Math.sqrt(E),y=-v*E*u,I=p*E*u);var x=this.array;x[s++]=h,x[s++]=l,x[s++]=f,x[s++]=g,x[s++]=y,x[s++]=I,x[s++]=m,x[s++]=o,x[s++]=b}},{key:"setUniforms",value:function(o,s){var a=s.gl,c=s.uniformLocations,d=c.u_matrix,u=c.u_zoomRatio,h=c.u_feather,l=c.u_pixelRatio,f=c.u_correctionRatio,g=c.u_sizeRatio,m=c.u_minEdgeThickness,p=c.u_lengthToThicknessRatio;a.uniformMatrix3fv(d,!1,o.matrix),a.uniform1f(u,o.zoomRatio),a.uniform1f(g,o.sizeRatio),a.uniform1f(f,o.correctionRatio),a.uniform1f(l,o.pixelRatio),a.uniform1f(h,o.antiAliasingFeather),a.uniform1f(m,o.minEdgeThickness),a.uniform1f(p,t.lengthToThicknessRatio)}}])})(Zn)}Bi();function fa(i){return Vs([Bi(),$i()])}var ga=fa(),ma=ga,pa=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,ya=pa,ji=WebGLRenderingContext,Gr=ji.UNSIGNED_BYTE,Ft=ji.FLOAT,va=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],ba=(function(i){function t(){return Ne(this,t),ze(this,t,arguments)}return Be(t,i),Le(t,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ya,FRAGMENT_SHADER_SOURCE:Ui,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:va,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Ft},{name:"a_positionEnd",size:2,type:Ft},{name:"a_normal",size:2,type:Ft},{name:"a_color",size:4,type:Gr,normalized:!0},{name:"a_id",size:4,type:Gr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Ft},{name:"a_normalCoef",size:1,type:Ft}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(e,r,o,s,a){var c=a.size||1,d=o.x,u=o.y,h=s.x,l=s.y,f=Ht(a.color),g=h-d,m=l-u,p=g*g+m*m,v=0,b=0;p&&(p=1/Math.sqrt(p),v=-m*p*c,b=g*p*c);var E=this.array;E[r++]=d,E[r++]=u,E[r++]=h,E[r++]=l,E[r++]=v,E[r++]=b,E[r++]=f,E[r++]=e}},{key:"setUniforms",value:function(e,r){var o=r.gl,s=r.uniformLocations,a=s.u_matrix,c=s.u_zoomRatio,d=s.u_feather,u=s.u_pixelRatio,h=s.u_correctionRatio,l=s.u_sizeRatio,f=s.u_minEdgeThickness;o.uniformMatrix3fv(a,!1,e.matrix),o.uniform1f(c,e.zoomRatio),o.uniform1f(l,e.sizeRatio),o.uniform1f(h,e.correctionRatio),o.uniform1f(u,e.pixelRatio),o.uniform1f(d,e.antiAliasingFeather),o.uniform1f(f,e.minEdgeThickness)}}])})(Zn),Jn=(function(i){function t(){var n;return Ne(this,t),n=ze(this,t),n.rawEmitter=n,n}return Be(t,i),Le(t)})(li.EventEmitter),Cn,Pr;function wa(){return Pr||(Pr=1,Cn=function(t){return t!==null&&typeof t=="object"&&typeof t.addUndirectedEdgeWithKey=="function"&&typeof t.dropNode=="function"&&typeof t.multi=="boolean"}),Cn}var xa=wa();const Ea=mo(xa);var Ia=function(t){return t},Aa=function(t){return t*t},Sa=function(t){return t*(2-t)},_a=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Ta=function(t){return t*t*t},Ca=function(t){return--t*t*t+1},Ra=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},ka={linear:Ia,quadraticIn:Aa,quadraticOut:Sa,quadraticInOut:_a,cubicIn:Ta,cubicOut:Ca,cubicInOut:Ra},Na={easing:"quadraticInOut",duration:150};function We(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function en(i,t,n){return i[0]=t,i[4]=typeof n=="number"?n:t,i}function Or(i,t){var n=Math.sin(t),e=Math.cos(t);return i[0]=e,i[1]=n,i[3]=-n,i[4]=e,i}function $r(i,t,n){return i[6]=t,i[7]=n,i}function ct(i,t){var n=i[0],e=i[1],r=i[2],o=i[3],s=i[4],a=i[5],c=i[6],d=i[7],u=i[8],h=t[0],l=t[1],f=t[2],g=t[3],m=t[4],p=t[5],v=t[6],b=t[7],E=t[8];return i[0]=h*n+l*o+f*c,i[1]=h*e+l*s+f*d,i[2]=h*r+l*a+f*u,i[3]=g*n+m*o+p*c,i[4]=g*e+m*s+p*d,i[5]=g*r+m*a+p*u,i[6]=v*n+b*o+E*c,i[7]=v*e+b*s+E*d,i[8]=v*r+b*a+E*u,i}function On(i,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,e=i[0],r=i[1],o=i[3],s=i[4],a=i[6],c=i[7],d=t.x,u=t.y;return{x:d*e+u*o+a*n,y:d*r+u*s+c*n}}function La(i,t){var n=i.height/i.width,e=t.height/t.width;return n<1&&e>1||n>1&&e<1?1:Math.min(Math.max(e,1/e),Math.max(1/n,n))}function Gt(i,t,n,e,r){var o=i.angle,s=i.ratio,a=i.x,c=i.y,d=t.width,u=t.height,h=We(),l=Math.min(d,u)-2*e,f=La(t,n);return r?(ct(h,$r(We(),a,c)),ct(h,en(We(),s)),ct(h,Or(We(),o)),ct(h,en(We(),d/l/2/f,u/l/2/f))):(ct(h,en(We(),2*(l/d)*f,2*(l/u)*f)),ct(h,Or(We(),-o)),ct(h,en(We(),1/s)),ct(h,$r(We(),-a,-c))),h}function Ma(i,t,n){var e=On(i,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),r=e.x,o=e.y;return 1/Math.sqrt(Math.pow(r,2)+Math.pow(o,2))/n.width}function Da(i){if(!i.order)return{x:[0,1],y:[0,1]};var t=1/0,n=-1/0,e=1/0,r=-1/0;return i.forEachNode(function(o,s){var a=s.x,c=s.y;a<t&&(t=a),a>n&&(n=a),c<e&&(e=c),c>r&&(r=c)}),{x:[t,n],y:[e,r]}}function Fa(i){if(!Ea(i))throw new Error("Sigma: invalid graph instance.");i.forEachNode(function(t,n){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))throw new Error("Sigma: Coordinates of node ".concat(t," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function Ga(i,t,n){var e=document.createElement(i);if(t)for(var r in t)e.style[r]=t[r];if(n)for(var o in n)e.setAttribute(o,n[o]);return e}function Ur(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function zr(i,t,n){return n.sort(function(e,r){var o=t(e)||0,s=t(r)||0;return o<s?-1:o>s?1:0})}function Br(i){var t=It(i.x,2),n=t[0],e=t[1],r=It(i.y,2),o=r[0],s=r[1],a=Math.max(e-n,s-o),c=(e+n)/2,d=(s+o)/2;(a===0||Math.abs(a)===1/0||isNaN(a))&&(a=1),isNaN(c)&&(c=0),isNaN(d)&&(d=0);var u=function(l){return{x:.5+(l.x-c)/a,y:.5+(l.y-d)/a}};return u.applyTo=function(h){h.x=.5+(h.x-c)/a,h.y=.5+(h.y-d)/a},u.inverse=function(h){return{x:c+a*(h.x-.5),y:d+a*(h.y-.5)}},u.ratio=a,u}function $n(i){"@babel/helpers - typeof";return $n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$n(i)}function jr(i,t){var n=t.size;if(n!==0){var e=i.length;i.length+=n;var r=0;t.forEach(function(o){i[e+r]=o,r++})}}function Rn(i){i=i||{};for(var t=0,n=arguments.length<=1?0:arguments.length-1;t<n;t++){var e=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];e&&Object.assign(i,e)}return i}var Qn={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:Ks,defaultDrawNodeLabel:Fi,defaultDrawNodeHover:Zs,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},Pa={circle:dn},Oa={arrow:ma,line:ba};function kn(i){if(typeof i.labelDensity!="number"||i.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=i.minCameraRatio,n=i.maxCameraRatio;if(typeof t=="number"&&typeof n=="number"&&n<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function $a(i){var t=Rn({},Qn,i);return t.nodeProgramClasses=Rn({},Pa,t.nodeProgramClasses),t.edgeProgramClasses=Rn({},Oa,t.edgeProgramClasses),t}var tn=1.5,Yr=(function(i){function t(){var n;return Ne(this,t),n=ze(this,t),M(n,"x",.5),M(n,"y",.5),M(n,"angle",0),M(n,"ratio",1),M(n,"minRatio",null),M(n,"maxRatio",null),M(n,"enabledZooming",!0),M(n,"enabledPanning",!0),M(n,"enabledRotation",!0),M(n,"clean",null),M(n,"nextFrame",null),M(n,"previousState",null),M(n,"enabled",!0),n.previousState=n.getState(),n}return Be(t,i),Le(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(e){return this.x===e.x&&this.y===e.y&&this.ratio===e.ratio&&this.angle===e.angle}},{key:"getPreviousState",value:function(){var e=this.previousState;return e?{x:e.x,y:e.y,angle:e.angle,ratio:e.ratio}:null}},{key:"getBoundedRatio",value:function(e){var r=e;return typeof this.minRatio=="number"&&(r=Math.max(r,this.minRatio)),typeof this.maxRatio=="number"&&(r=Math.min(r,this.maxRatio)),r}},{key:"validateState",value:function(e){var r={};return this.enabledPanning&&typeof e.x=="number"&&(r.x=e.x),this.enabledPanning&&typeof e.y=="number"&&(r.y=e.y),this.enabledZooming&&typeof e.ratio=="number"&&(r.ratio=this.getBoundedRatio(e.ratio)),this.enabledRotation&&typeof e.angle=="number"&&(r.angle=e.angle),this.clean?this.clean(K(K({},this.getState()),r)):r}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(e){if(!this.enabled)return this;this.previousState=this.getState();var r=this.validateState(e);return typeof r.x=="number"&&(this.x=r.x),typeof r.y=="number"&&(this.y=r.y),typeof r.ratio=="number"&&(this.ratio=r.ratio),typeof r.angle=="number"&&(this.angle=r.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(e){return this.setState(e(this.getState())),this}},{key:"animate",value:function(e){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;if(!s)return new Promise(function(f){return r.animate(e,o,f)});if(this.enabled){var a=K(K({},Na),o),c=this.validateState(e),d=typeof a.easing=="function"?a.easing:ka[a.easing],u=Date.now(),h=this.getState(),l=function(){var g=(Date.now()-u)/a.duration;if(g>=1){r.nextFrame=null,r.setState(c),r.animationCallback&&(r.animationCallback.call(null),r.animationCallback=void 0);return}var m=d(g),p={};typeof c.x=="number"&&(p.x=h.x+(c.x-h.x)*m),typeof c.y=="number"&&(p.y=h.y+(c.y-h.y)*m),r.enabledRotation&&typeof c.angle=="number"&&(p.angle=h.angle+(c.angle-h.angle)*m),typeof c.ratio=="number"&&(p.ratio=h.ratio+(c.ratio-h.ratio)*m),r.setState(p),r.nextFrame=requestAnimationFrame(l)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(l)):l(),this.animationCallback=s}}},{key:"animatedZoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio/e}):this.animate({ratio:this.ratio/(e.factor||tn)},e):this.animate({ratio:this.ratio/tn})}},{key:"animatedUnzoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio*e}):this.animate({ratio:this.ratio*(e.factor||tn)},e):this.animate({ratio:this.ratio*tn})}},{key:"animatedReset",value:function(e){return this.animate({x:.5,y:.5,ratio:1,angle:0},e)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(e){var r=new t;return r.setState(e)}}])})(Jn);function qe(i,t){var n=t.getBoundingClientRect();return{x:i.clientX-n.left,y:i.clientY-n.top}}function Qe(i,t){var n=K(K({},qe(i,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0},original:i});return n}function Pt(i){var t="x"in i?i:K(K({},i.touches[0]||i.previousTouches[0]),{},{original:i.original,sigmaDefaultPrevented:i.sigmaDefaultPrevented,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function Ua(i,t){return K(K({},Qe(i,t)),{},{delta:Yi(i)})}var za=2;function on(i){for(var t=[],n=0,e=Math.min(i.length,za);n<e;n++)t.push(i[n]);return t}function Ot(i,t,n){var e={touches:on(i.touches).map(function(r){return qe(r,n)}),previousTouches:t.map(function(r){return qe(r,n)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0},original:i};return e}function Yi(i){if(typeof i.deltaY<"u")return i.deltaY*-3/360;if(typeof i.detail<"u")return i.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Hi=(function(i){function t(n,e){var r;return Ne(this,t),r=ze(this,t),r.container=n,r.renderer=e,r}return Be(t,i),Le(t)})(Jn),Ba=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],ja=Ba.reduce(function(i,t){return K(K({},i),{},M({},t,Qn[t]))},{}),Ya=(function(i){function t(n,e){var r;return Ne(this,t),r=ze(this,t,[n,e]),M(r,"enabled",!0),M(r,"draggedEvents",0),M(r,"downStartTime",null),M(r,"lastMouseX",null),M(r,"lastMouseY",null),M(r,"isMouseDown",!1),M(r,"isMoving",!1),M(r,"movingTimeout",null),M(r,"startCameraState",null),M(r,"clicks",0),M(r,"doubleClickTimeout",null),M(r,"currentWheelDirection",0),M(r,"settings",ja),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),n.addEventListener("click",r.handleClick,{capture:!1}),n.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),n.addEventListener("mousedown",r.handleDown,{capture:!1}),n.addEventListener("wheel",r.handleWheel,{capture:!1}),n.addEventListener("mouseleave",r.handleLeave,{capture:!1}),n.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return Be(t,i),Le(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("click",this.handleClick),e.removeEventListener("contextmenu",this.handleRightClick),e.removeEventListener("mousedown",this.handleDown),e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mouseleave",this.handleLeave),e.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(e){var r=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(e);setTimeout(function(){r.clicks=0,r.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Qe(e,this.container))}}},{key:"handleRightClick",value:function(e){this.enabled&&this.emit("rightClick",Qe(e,this.container))}},{key:"handleDoubleClick",value:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var r=Qe(e,this.container);if(this.emit("doubleClick",r),!r.sigmaDefaultPrevented){var o=this.renderer.getCamera(),s=o.getBoundedRatio(o.getState().ratio/this.settings.doubleClickZoomingRatio);o.animate(this.renderer.getViewportZoomedState(qe(e,this.container),s),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(e){if(this.enabled){if(e.button===0){this.startCameraState=this.renderer.getCamera().getState();var r=qe(e,this.container),o=r.x,s=r.y;this.lastMouseX=o,this.lastMouseY=s,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Qe(e,this.container))}}},{key:"handleUp",value:function(e){var r=this;if(!(!this.enabled||!this.isMouseDown)){var o=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var s=qe(e,this.container),a=s.x,c=s.y,d=o.getState(),u=o.getPreviousState()||{x:0,y:0};this.isMoving?o.animate({x:d.x+this.settings.inertiaRatio*(d.x-u.x),y:d.y+this.settings.inertiaRatio*(d.y-u.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==a||this.lastMouseY!==c)&&o.setState({x:d.x,y:d.y}),this.isMoving=!1,setTimeout(function(){var h=r.draggedEvents>0;r.draggedEvents=0,h&&r.renderer.getSetting("hideEdgesOnMove")&&r.renderer.refresh()},0),this.emit("mouseup",Qe(e,this.container))}}},{key:"handleMove",value:function(e){var r=this;if(this.enabled){var o=Qe(e,this.container);if(this.emit("mousemovebody",o),(e.target===this.container||e.composedPath()[0]===this.container)&&this.emit("mousemove",o),!o.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.movingTimeout=null,r.isMoving=!1},this.settings.dragTimeout);var s=this.renderer.getCamera(),a=qe(e,this.container),c=a.x,d=a.y,u=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),h=this.renderer.viewportToFramedGraph({x:c,y:d}),l=u.x-h.x,f=u.y-h.y,g=s.getState(),m=g.x+l,p=g.y+f;s.setState({x:m,y:p}),this.lastMouseX=c,this.lastMouseY=d,e.preventDefault(),e.stopPropagation()}}}},{key:"handleLeave",value:function(e){this.emit("mouseleave",Qe(e,this.container))}},{key:"handleEnter",value:function(e){this.emit("mouseenter",Qe(e,this.container))}},{key:"handleWheel",value:function(e){var r=this,o=this.renderer.getCamera();if(!(!this.enabled||!o.enabledZooming)){var s=Yi(e);if(s){var a=Ua(e,this.container);if(this.emit("wheel",a),a.sigmaDefaultPrevented){e.preventDefault(),e.stopPropagation();return}var c=o.getState().ratio,d=s>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,u=o.getBoundedRatio(c*d),h=s>0?1:-1,l=Date.now();c!==u&&(e.preventDefault(),e.stopPropagation(),!(this.currentWheelDirection===h&&this.lastWheelTriggerTime&&l-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(o.animate(this.renderer.getViewportZoomedState(qe(e,this.container),u),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){r.currentWheelDirection=0}),this.currentWheelDirection=h,this.lastWheelTriggerTime=l))}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(Hi),Ha=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Wa=Ha.reduce(function(i,t){return K(K({},i),{},M({},t,Qn[t]))},{}),qa=(function(i){function t(n,e){var r;return Ne(this,t),r=ze(this,t,[n,e]),M(r,"enabled",!0),M(r,"isMoving",!1),M(r,"hasMoved",!1),M(r,"touchMode",0),M(r,"startTouchesPositions",[]),M(r,"lastTouches",[]),M(r,"lastTap",null),M(r,"settings",Wa),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),n.addEventListener("touchstart",r.handleStart,{capture:!1}),n.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return Be(t,i),Le(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("touchstart",this.handleStart),e.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(e){var r=this;if(this.enabled){e.preventDefault();var o=on(e.touches);if(this.touchMode=o.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=o.map(function(f){return qe(f,r.container)}),this.touchMode===2){var s=It(this.startTouchesPositions,2),a=s[0],c=a.x,d=a.y,u=s[1],h=u.x,l=u.y;this.startTouchesAngle=Math.atan2(l-d,h-c),this.startTouchesDistance=Math.sqrt(Math.pow(h-c,2)+Math.pow(l-d,2))}this.emit("touchdown",Ot(e,this.lastTouches,this.container)),this.lastTouches=o,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(e){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(e.cancelable&&e.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(e.touches.length===1){this.handleStart(e),e.preventDefault();break}case 1:if(this.isMoving){var r=this.renderer.getCamera(),o=r.getState(),s=r.getPreviousState()||{x:0,y:0};r.animate({x:o.x+this.settings.inertiaRatio*(o.x-s.x),y:o.y+this.settings.inertiaRatio*(o.y-s.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",Ot(e,this.lastTouches,this.container)),!e.touches.length){var a=qe(this.lastTouches[0],this.container),c=this.startTouchesPositions[0],d=Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2);if(!e.touches.length&&d<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var u=Ot(e,this.lastTouches,this.container);if(this.emit("doubletap",u),this.lastTap=null,!u.sigmaDefaultPrevented){var h=this.renderer.getCamera(),l=h.getBoundedRatio(h.getState().ratio/this.settings.doubleClickZoomingRatio);h.animate(this.renderer.getViewportZoomedState(a,l),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var f=Ot(e,this.lastTouches,this.container);this.emit("tap",f),this.lastTap={time:Date.now(),position:f.touches[0]||f.previousTouches[0]}}}this.lastTouches=on(e.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(e){var r=this;if(!(!this.enabled||!this.startTouchesPositions.length)){e.preventDefault();var o=on(e.touches),s=o.map(function(ee){return qe(ee,r.container)}),a=this.lastTouches;this.lastTouches=o,this.lastTouchesPositions=s;var c=Ot(e,a,this.container);if(this.emit("touchmove",c),!c.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=s.some(function(ee,oe){var P=r.startTouchesPositions[oe];return P&&(ee.x!==P.x||ee.y!==P.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){r.isMoving=!1},this.settings.dragTimeout);var d=this.renderer.getCamera(),u=this.startCameraState,h=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var l=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),f=l.x,g=l.y,m=this.renderer.viewportToFramedGraph(s[0]),p=m.x,v=m.y;d.setState({x:u.x+f-p,y:u.y+g-v});break}case 2:{var b={x:.5,y:.5,angle:0,ratio:1},E=s[0],y=E.x,I=E.y,x=s[1],w=x.x,S=x.y,A=Math.atan2(S-I,w-y)-this.startTouchesAngle,_=Math.hypot(S-I,w-y)/this.startTouchesDistance,T=d.getBoundedRatio(u.ratio/_);b.ratio=T,b.angle=u.angle+A;var C=this.getDimensions(),G=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:u}),R=Math.min(C.width,C.height)-2*h,k=R/C.width,$=R/C.height,H=T/R,V=y-R/2/k,Z=I-R/2/$,X=[V*Math.cos(-b.angle)-Z*Math.sin(-b.angle),Z*Math.cos(-b.angle)+V*Math.sin(-b.angle)];V=X[0],Z=X[1],b.x=G.x-V*H,b.y=G.y+Z*H,d.setState(b);break}}}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(Hi);function Xa(i){if(Array.isArray(i))return Gn(i)}function Va(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function Ka(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hr(i){return Xa(i)||Va(i)||Ci(i)||Ka()}function Za(i,t){if(i==null)return{};var n={};for(var e in i)if({}.hasOwnProperty.call(i,e)){if(t.indexOf(e)!==-1)continue;n[e]=i[e]}return n}function Nn(i,t){if(i==null)return{};var n,e,r=Za(i,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(e=0;e<o.length;e++)n=o[e],t.indexOf(n)===-1&&{}.propertyIsEnumerable.call(i,n)&&(r[n]=i[n])}return r}var Wr=(function(){function i(t,n){Ne(this,i),this.key=t,this.size=n}return Le(i,null,[{key:"compare",value:function(n,e){return n.size>e.size?-1:n.size<e.size||n.key>e.key?1:-1}}])})(),qr=(function(){function i(){Ne(this,i),M(this,"width",0),M(this,"height",0),M(this,"cellSize",0),M(this,"columns",0),M(this,"rows",0),M(this,"cells",{})}return Le(i,[{key:"resizeAndClear",value:function(n,e){this.width=n.width,this.height=n.height,this.cellSize=e,this.columns=Math.ceil(n.width/e),this.rows=Math.ceil(n.height/e),this.cells={}}},{key:"getIndex",value:function(n){var e=Math.floor(n.x/this.cellSize),r=Math.floor(n.y/this.cellSize);return r*this.columns+e}},{key:"add",value:function(n,e,r){var o=new Wr(n,e),s=this.getIndex(r),a=this.cells[s];a||(a=[],this.cells[s]=a),a.push(o)}},{key:"organize",value:function(){for(var n in this.cells){var e=this.cells[n];e.sort(Wr.compare)}}},{key:"getLabelsToDisplay",value:function(n,e){var r=this.cellSize*this.cellSize,o=r/n/n,s=o*e/r,a=Math.ceil(s),c=[];for(var d in this.cells)for(var u=this.cells[d],h=0;h<Math.min(a,u.length);h++)c.push(u[h].key);return c}}])})();function Ja(i){var t=i.graph,n=i.hoveredNode,e=i.highlightedNodes,r=i.displayedNodeLabels,o=[];return t.forEachEdge(function(s,a,c,d){(c===n||d===n||e.has(c)||e.has(d)||r.has(c)&&r.has(d))&&o.push(s)}),o}var Xr=150,Vr=50,et=Object.prototype.hasOwnProperty;function Qa(i,t,n){if(!et.call(n,"x")||!et.call(n,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return n.color||(n.color=i.defaultNodeColor),!n.label&&n.label!==""&&(n.label=null),n.label!==void 0&&n.label!==null?n.label=""+n.label:n.label=null,n.size||(n.size=2),et.call(n,"hidden")||(n.hidden=!1),et.call(n,"highlighted")||(n.highlighted=!1),et.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=i.defaultNodeType),n.zIndex||(n.zIndex=0),n}function ec(i,t,n){return n.color||(n.color=i.defaultEdgeColor),n.label||(n.label=""),n.size||(n.size=.5),et.call(n,"hidden")||(n.hidden=!1),et.call(n,"forceLabel")||(n.forceLabel=!1),(!n.type||n.type==="")&&(n.type=i.defaultEdgeType),n.zIndex||(n.zIndex=0),n}var tc=(function(i){function t(n,e){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Ne(this,t),r=ze(this,t),M(r,"elements",{}),M(r,"canvasContexts",{}),M(r,"webGLContexts",{}),M(r,"pickingLayers",new Set),M(r,"textures",{}),M(r,"frameBuffers",{}),M(r,"activeListeners",{}),M(r,"labelGrid",new qr),M(r,"nodeDataCache",{}),M(r,"edgeDataCache",{}),M(r,"nodeProgramIndex",{}),M(r,"edgeProgramIndex",{}),M(r,"nodesWithForcedLabels",new Set),M(r,"edgesWithForcedLabels",new Set),M(r,"nodeExtent",{x:[0,1],y:[0,1]}),M(r,"nodeZExtent",[1/0,-1/0]),M(r,"edgeZExtent",[1/0,-1/0]),M(r,"matrix",We()),M(r,"invMatrix",We()),M(r,"correctionRatio",1),M(r,"customBBox",null),M(r,"normalizationFunction",Br({x:[0,1],y:[0,1]})),M(r,"graphToViewportRatio",1),M(r,"itemIDsIndex",{}),M(r,"nodeIndices",{}),M(r,"edgeIndices",{}),M(r,"width",0),M(r,"height",0),M(r,"pixelRatio",Ur()),M(r,"pickingDownSizingRatio",2*r.pixelRatio),M(r,"displayedNodeLabels",new Set),M(r,"displayedEdgeLabels",new Set),M(r,"highlightedNodes",new Set),M(r,"hoveredNode",null),M(r,"hoveredEdge",null),M(r,"renderFrame",null),M(r,"renderHighlightedNodesFrame",null),M(r,"needToProcess",!1),M(r,"checkEdgesEventsFrame",null),M(r,"nodePrograms",{}),M(r,"nodeHoverPrograms",{}),M(r,"edgePrograms",{}),r.settings=$a(o),kn(r.settings),Fa(n),!(e instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");r.graph=n,r.container=e,r.createWebGLContext("edges",{picking:o.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize();for(var s in r.settings.nodeProgramClasses)r.registerNodeProgram(s,r.settings.nodeProgramClasses[s],r.settings.nodeHoverProgramClasses[s]);for(var a in r.settings.edgeProgramClasses)r.registerEdgeProgram(a,r.settings.edgeProgramClasses[a]);return r.camera=new Yr,r.bindCameraHandlers(),r.mouseCaptor=new Ya(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new qa(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return Be(t,i),Le(t,[{key:"registerNodeProgram",value:function(e,r,o){return this.nodePrograms[e]&&this.nodePrograms[e].kill(),this.nodeHoverPrograms[e]&&this.nodeHoverPrograms[e].kill(),this.nodePrograms[e]=new r(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[e]=new(o||r)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(e,r){return this.edgePrograms[e]&&this.edgePrograms[e].kill(),this.edgePrograms[e]=new r(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(e){if(this.nodePrograms[e]){var r=this.nodePrograms,o=r[e],s=Nn(r,[e].map(jt));o.kill(),this.nodePrograms=s}if(this.nodeHoverPrograms[e]){var a=this.nodeHoverPrograms,c=a[e],d=Nn(a,[e].map(jt));c.kill(),this.nodePrograms=d}return this}},{key:"unregisterEdgeProgram",value:function(e){if(this.edgePrograms[e]){var r=this.edgePrograms,o=r[e],s=Nn(r,[e].map(jt));o.kill(),this.edgePrograms=s}return this}},{key:"resetWebGLTexture",value:function(e){var r=this.webGLContexts[e],o=this.frameBuffers[e],s=this.textures[e];s&&r.deleteTexture(s);var a=r.createTexture();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),this.textures[e]=a,this}},{key:"bindCameraHandlers",value:function(){var e=this;return this.activeListeners.camera=function(){e.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(e){var r=e.x,o=e.y,s=Rr(this.webGLContexts.nodes,this.frameBuffers.nodes,r,o,this.pixelRatio,this.pickingDownSizingRatio),a=Cr.apply(void 0,Hr(s)),c=this.itemIDsIndex[a];return c&&c.type==="node"?c.id:null}},{key:"bindEventHandlers",value:function(){var e=this;this.activeListeners.handleResize=function(){e.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(o){var s=Pt(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}},c=e.getNodeAtPosition(s);if(c&&e.hoveredNode!==c&&!e.nodeDataCache[c].hidden){e.hoveredNode&&e.emit("leaveNode",K(K({},a),{},{node:e.hoveredNode})),e.hoveredNode=c,e.emit("enterNode",K(K({},a),{},{node:c})),e.scheduleHighlightedNodesRender();return}if(e.hoveredNode&&e.getNodeAtPosition(s)!==e.hoveredNode){var d=e.hoveredNode;e.hoveredNode=null,e.emit("leaveNode",K(K({},a),{},{node:d})),e.scheduleHighlightedNodesRender();return}if(e.settings.enableEdgeEvents){var u=e.hoveredNode?null:e.getEdgeAtPoint(a.event.x,a.event.y);u!==e.hoveredEdge&&(e.hoveredEdge&&e.emit("leaveEdge",K(K({},a),{},{edge:e.hoveredEdge})),u&&e.emit("enterEdge",K(K({},a),{},{edge:u})),e.hoveredEdge=u)}},this.activeListeners.handleMoveBody=function(o){var s=Pt(o);e.emit("moveBody",{event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(o){var s=Pt(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}};e.hoveredNode&&(e.emit("leaveNode",K(K({},a),{},{node:e.hoveredNode})),e.scheduleHighlightedNodesRender()),e.settings.enableEdgeEvents&&e.hoveredEdge&&(e.emit("leaveEdge",K(K({},a),{},{edge:e.hoveredEdge})),e.scheduleHighlightedNodesRender()),e.emit("leaveStage",K({},a))},this.activeListeners.handleEnter=function(o){var s=Pt(o),a={event:s,preventSigmaDefault:function(){s.preventSigmaDefault()}};e.emit("enterStage",K({},a))};var r=function(s){return function(a){var c=Pt(a),d={event:c,preventSigmaDefault:function(){c.preventSigmaDefault()}},u=e.getNodeAtPosition(c);if(u)return e.emit("".concat(s,"Node"),K(K({},d),{},{node:u}));if(e.settings.enableEdgeEvents){var h=e.getEdgeAtPoint(c.x,c.y);if(h)return e.emit("".concat(s,"Edge"),K(K({},d),{},{edge:h}))}return e.emit("".concat(s,"Stage"),d)}};return this.activeListeners.handleClick=r("click"),this.activeListeners.handleRightClick=r("rightClick"),this.activeListeners.handleDoubleClick=r("doubleClick"),this.activeListeners.handleWheel=r("wheel"),this.activeListeners.handleDown=r("down"),this.activeListeners.handleUp=r("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var e=this,r=this.graph,o=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(s){var a,c=(a=s.hints)===null||a===void 0?void 0:a.attributes;e.graph.forEachNode(function(u){return e.updateNode(u)});var d=!c||c.some(function(u){return o.has(u)});e.refresh({partialGraph:{nodes:r.nodes()},skipIndexation:!d,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(s){var a,c=(a=s.hints)===null||a===void 0?void 0:a.attributes;e.graph.forEachEdge(function(u){return e.updateEdge(u)});var d=c&&["zIndex","type"].some(function(u){return c==null?void 0:c.includes(u)});e.refresh({partialGraph:{edges:r.edges()},skipIndexation:!d,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(s){var a=s.key;e.addNode(a),e.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(s){var a=s.key;e.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(s){var a=s.key;e.removeNode(a),e.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(s){var a=s.key;e.addEdge(a),e.refresh({partialGraph:{edges:[a]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(s){var a=s.key;e.refresh({partialGraph:{edges:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(s){var a=s.key;e.removeEdge(a),e.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){e.clearEdgeState(),e.clearEdgeIndices(),e.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){e.clearEdgeState(),e.clearNodeState(),e.clearEdgeIndices(),e.clearNodeIndices(),e.refresh({schedule:!0})},r.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),r.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),r.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),r.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),r.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),r.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),r.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),r.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),r.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),r.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var e=this.graph;e.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),e.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),e.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),e.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),e.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),e.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),e.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),e.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),e.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),e.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(e,r){var o=Rr(this.webGLContexts.edges,this.frameBuffers.edges,e,r,this.pixelRatio,this.pickingDownSizingRatio),s=Cr.apply(void 0,Hr(o)),a=this.itemIDsIndex[s];return a&&a.type==="edge"?a.id:null}},{key:"process",value:function(){var e=this;this.emit("beforeProcess");var r=this.graph,o=this.settings,s=this.getDimensions();if(this.nodeExtent=Da(this.graph),!this.settings.autoRescale){var a=s.width,c=s.height,d=this.nodeExtent,u=d.x,h=d.y;this.nodeExtent={x:[(u[0]+u[1])/2-a/2,(u[0]+u[1])/2+a/2],y:[(h[0]+h[1])/2-c/2,(h[0]+h[1])/2+c/2]}}this.normalizationFunction=Br(this.customBBox||this.nodeExtent);var l=new Yr,f=Gt(l.getState(),s,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(s,o.labelGridCellSize);for(var g={},m={},p={},v={},b=1,E=r.nodes(),y=0,I=E.length;y<I;y++){var x=E[y],w=this.nodeDataCache[x],S=r.getNodeAttributes(x);w.x=S.x,w.y=S.y,this.normalizationFunction.applyTo(w),typeof w.label=="string"&&!w.hidden&&this.labelGrid.add(x,w.size,this.framedGraphToViewport(w,{matrix:f})),g[w.type]=(g[w.type]||0)+1}this.labelGrid.organize();for(var A in this.nodePrograms){if(!et.call(this.nodePrograms,A))throw new Error('Sigma: could not find a suitable program for node type "'.concat(A,'"!'));this.nodePrograms[A].reallocate(g[A]||0),g[A]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(E=zr(this.nodeZExtent,function(ce){return e.nodeDataCache[ce].zIndex},E));for(var _=0,T=E.length;_<T;_++){var C=E[_];m[C]=b,v[m[C]]={type:"node",id:C},b++;var G=this.nodeDataCache[C];this.addNodeToProgram(C,m[C],g[G.type]++)}for(var R={},k=r.edges(),$=0,H=k.length;$<H;$++){var V=k[$],Z=this.edgeDataCache[V];R[Z.type]=(R[Z.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(k=zr(this.edgeZExtent,function(ce){return e.edgeDataCache[ce].zIndex},k));for(var X in this.edgePrograms){if(!et.call(this.edgePrograms,X))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(X,'"!'));this.edgePrograms[X].reallocate(R[X]||0),R[X]=0}for(var ee=0,oe=k.length;ee<oe;ee++){var P=k[ee];p[P]=b,v[p[P]]={type:"edge",id:P},b++;var J=this.edgeDataCache[P];this.addEdgeToProgram(P,p[P],R[J.type]++)}return this.itemIDsIndex=v,this.nodeIndices=m,this.edgeIndices=p,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(e){var r=this,o=this.settings;if(this.camera.minRatio=o.minCameraRatio,this.camera.maxRatio=o.maxCameraRatio,this.camera.enabledZooming=o.enableCameraZooming,this.camera.enabledPanning=o.enableCameraPanning,this.camera.enabledRotation=o.enableCameraRotation,o.cameraPanBoundaries?this.camera.clean=function(u){return r.cleanCameraState(u,o.cameraPanBoundaries&&$n(o.cameraPanBoundaries)==="object"?o.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),e){if(e.edgeProgramClasses!==o.edgeProgramClasses){for(var s in o.edgeProgramClasses)o.edgeProgramClasses[s]!==e.edgeProgramClasses[s]&&this.registerEdgeProgram(s,o.edgeProgramClasses[s]);for(var a in e.edgeProgramClasses)o.edgeProgramClasses[a]||this.unregisterEdgeProgram(a)}if(e.nodeProgramClasses!==o.nodeProgramClasses||e.nodeHoverProgramClasses!==o.nodeHoverProgramClasses){for(var c in o.nodeProgramClasses)(o.nodeProgramClasses[c]!==e.nodeProgramClasses[c]||o.nodeHoverProgramClasses[c]!==e.nodeHoverProgramClasses[c])&&this.registerNodeProgram(c,o.nodeProgramClasses[c],o.nodeHoverProgramClasses[c]);for(var d in e.nodeProgramClasses)o.nodeProgramClasses[d]||this.unregisterNodeProgram(d)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.tolerance,s=o===void 0?0:o,a=r.boundaries,c=K({},e),d=a||this.nodeExtent,u=It(d.x,2),h=u[0],l=u[1],f=It(d.y,2),g=f[0],m=f[1],p=[this.graphToViewport({x:h,y:g},{cameraState:e}),this.graphToViewport({x:l,y:g},{cameraState:e}),this.graphToViewport({x:h,y:m},{cameraState:e}),this.graphToViewport({x:l,y:m},{cameraState:e})],v=1/0,b=-1/0,E=1/0,y=-1/0;p.forEach(function(R){var k=R.x,$=R.y;v=Math.min(v,k),b=Math.max(b,k),E=Math.min(E,$),y=Math.max(y,$)});var I=b-v,x=y-E,w=this.getDimensions(),S=w.width,A=w.height,_=0,T=0;if(I>=S?b<S-s?_=b-(S-s):v>s&&(_=v-s):b>S+s?_=b-(S+s):v<-s&&(_=v+s),x>=A?y<A-s?T=y-(A-s):E>s&&(T=E-s):y>A+s?T=y-(A+s):E<-s&&(T=E+s),_||T){var C=this.viewportToFramedGraph({x:0,y:0},{cameraState:e}),G=this.viewportToFramedGraph({x:_,y:T},{cameraState:e});_=G.x-C.x,T=G.y-C.y,c.x+=_,c.y+=T}return c}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var e=this.camera.getState(),r=this.labelGrid.getLabelsToDisplay(e.ratio,this.settings.labelDensity);jr(r,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var o=this.canvasContexts.labels,s=0,a=r.length;s<a;s++){var c=r[s],d=this.nodeDataCache[c];if(!this.displayedNodeLabels.has(c)&&!d.hidden){var u=this.framedGraphToViewport(d),h=u.x,l=u.y,f=this.scaleSize(d.size);if(!(!d.forceLabel&&f<this.settings.labelRenderedSizeThreshold)&&!(h<-Xr||h>this.width+Xr||l<-Vr||l>this.height+Vr)){this.displayedNodeLabels.add(c);var g=this.settings.defaultDrawNodeLabel,m=this.nodePrograms[d.type],p=(m==null?void 0:m.drawLabel)||g;p(o,K(K({key:c},d),{},{size:f,x:h,y:l}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var e=this.canvasContexts.edgeLabels;e.clearRect(0,0,this.width,this.height);var r=Ja({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});jr(r,this.edgesWithForcedLabels);for(var o=new Set,s=0,a=r.length;s<a;s++){var c=r[s],d=this.graph.extremities(c),u=this.nodeDataCache[d[0]],h=this.nodeDataCache[d[1]],l=this.edgeDataCache[c];if(!o.has(c)&&!(l.hidden||u.hidden||h.hidden)){var f=this.settings.defaultDrawEdgeLabel,g=this.edgePrograms[l.type],m=(g==null?void 0:g.drawLabel)||f;m(e,K(K({key:c},l),{},{size:this.scaleSize(l.size)}),K(K(K({key:d[0]},u),this.framedGraphToViewport(u)),{},{size:this.scaleSize(u.size)}),K(K(K({key:d[1]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),this.settings),o.add(c)}}return this.displayedEdgeLabels=o,this}},{key:"renderHighlightedNodes",value:function(){var e=this,r=this.canvasContexts.hovers;r.clearRect(0,0,this.width,this.height);var o=function(f){var g=e.nodeDataCache[f],m=e.framedGraphToViewport(g),p=m.x,v=m.y,b=e.scaleSize(g.size),E=e.settings.defaultDrawNodeHover,y=e.nodePrograms[g.type],I=(y==null?void 0:y.drawHover)||E;I(r,K(K({key:f},g),{},{size:b,x:p,y:v}),e.settings)},s=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&s.push(this.hoveredNode),this.highlightedNodes.forEach(function(l){l!==e.hoveredNode&&s.push(l)}),s.forEach(function(l){return o(l)});var a={};s.forEach(function(l){var f=e.nodeDataCache[l].type;a[f]=(a[f]||0)+1});for(var c in this.nodeHoverPrograms)this.nodeHoverPrograms[c].reallocate(a[c]||0),a[c]=0;s.forEach(function(l){var f=e.nodeDataCache[l];e.nodeHoverPrograms[f.type].process(0,a[f.type]++,f)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var d=this.getRenderParams();for(var u in this.nodeHoverPrograms){var h=this.nodeHoverPrograms[u];h.render(d)}}},{key:"scheduleHighlightedNodesRender",value:function(){var e=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){e.renderHighlightedNodesFrame=null,e.renderHighlightedNodes(),e.renderEdgeLabels()}))}},{key:"render",value:function(){var e=this;this.emit("beforeRender");var r=function(){return e.emit("afterRender"),e};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(p){return e.resetWebGLTexture(p)}),!this.graph.order)return r();var o=this.mouseCaptor,s=this.camera.isAnimated()||o.isMoving||o.draggedEvents||o.currentWheelDirection,a=this.camera.getState(),c=this.getDimensions(),d=this.getGraphDimensions(),u=this.getStagePadding();this.matrix=Gt(a,c,d,u),this.invMatrix=Gt(a,c,d,u,!0),this.correctionRatio=Ma(this.matrix,a,c),this.graphToViewportRatio=this.getGraphToViewportRatio();var h=this.getRenderParams();for(var l in this.nodePrograms){var f=this.nodePrograms[l];f.render(h)}if(!this.settings.hideEdgesOnMove||!s)for(var g in this.edgePrograms){var m=this.edgePrograms[g];m.render(h)}return this.settings.hideLabelsOnMove&&s||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),r()}},{key:"addNode",value:function(e){var r=Object.assign({},this.graph.getNodeAttributes(e));this.settings.nodeReducer&&(r=this.settings.nodeReducer(e,r));var o=Qa(this.settings,e,r);this.nodeDataCache[e]=o,this.nodesWithForcedLabels.delete(e),o.forceLabel&&!o.hidden&&this.nodesWithForcedLabels.add(e),this.highlightedNodes.delete(e),o.highlighted&&!o.hidden&&this.highlightedNodes.add(e),this.settings.zIndex&&(o.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=o.zIndex),o.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=o.zIndex))}},{key:"updateNode",value:function(e){this.addNode(e);var r=this.nodeDataCache[e];this.normalizationFunction.applyTo(r)}},{key:"removeNode",value:function(e){delete this.nodeDataCache[e],delete this.nodeProgramIndex[e],this.highlightedNodes.delete(e),this.hoveredNode===e&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(e)}},{key:"addEdge",value:function(e){var r=Object.assign({},this.graph.getEdgeAttributes(e));this.settings.edgeReducer&&(r=this.settings.edgeReducer(e,r));var o=ec(this.settings,e,r);this.edgeDataCache[e]=o,this.edgesWithForcedLabels.delete(e),o.forceLabel&&!o.hidden&&this.edgesWithForcedLabels.add(e),this.settings.zIndex&&(o.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=o.zIndex),o.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=o.zIndex))}},{key:"updateEdge",value:function(e){this.addEdge(e)}},{key:"removeEdge",value:function(e){delete this.edgeDataCache[e],delete this.edgeProgramIndex[e],this.hoveredEdge===e&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(e)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new qr,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(e,r,o){var s=this.nodeDataCache[e],a=this.nodePrograms[s.type];if(!a)throw new Error('Sigma: could not find a suitable program for node type "'.concat(s.type,'"!'));a.process(r,o,s),this.nodeProgramIndex[e]=o}},{key:"addEdgeToProgram",value:function(e,r,o){var s=this.edgeDataCache[e],a=this.edgePrograms[s.type];if(!a)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(s.type,'"!'));var c=this.graph.extremities(e),d=this.nodeDataCache[c[0]],u=this.nodeDataCache[c[1]];a.process(r,o,d,u,s),this.edgeProgramIndex[e]=o}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var e=this.settings,r=e.stagePadding,o=e.autoRescale;return o&&r||0}},{key:"createLayer",value:function(e,r){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[e])throw new Error('Sigma: a layer named "'.concat(e,'" already exists'));var s=Ga(r,{position:"absolute"},{class:"sigma-".concat(e)});return o.style&&Object.assign(s.style,o.style),this.elements[e]=s,"beforeLayer"in o&&o.beforeLayer?this.elements[o.beforeLayer].before(s):"afterLayer"in o&&o.afterLayer?this.elements[o.afterLayer].after(s):this.container.appendChild(s),s}},{key:"createCanvas",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(e,"canvas",r)}},{key:"createCanvasContext",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.createCanvas(e,r),s={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[e]=o.getContext("2d",s),this}},{key:"createWebGLContext",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=(r==null?void 0:r.canvas)||this.createCanvas(e,r);r.hidden&&o.remove();var s=K({preserveDrawingBuffer:!1,antialias:!1},r),a;a=o.getContext("webgl2",s),a||(a=o.getContext("webgl",s)),a||(a=o.getContext("experimental-webgl",s));var c=a;if(this.webGLContexts[e]=c,c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),r.picking){this.pickingLayers.add(e);var d=c.createFramebuffer();if(!d)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(e));this.frameBuffers[e]=d}return c}},{key:"killLayer",value:function(e){var r=this.elements[e];if(!r)throw new Error("Sigma: cannot kill layer ".concat(e,", which does not exist"));if(this.webGLContexts[e]){var o,s=this.webGLContexts[e];(o=s.getExtension("WEBGL_lose_context"))===null||o===void 0||o.loseContext(),delete this.webGLContexts[e]}else this.canvasContexts[e]&&delete this.canvasContexts[e];return r.remove(),delete this.elements[e],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(e){this.unbindCameraHandlers(),this.camera=e,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(e){e!==this.graph&&(this.hoveredNode&&!e.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!e.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=e,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var e=this.customBBox||this.nodeExtent;return{width:e.x[1]-e.x[0]||1,height:e.y[1]-e.y[0]||1}}},{key:"getNodeDisplayData",value:function(e){var r=this.nodeDataCache[e];return r?Object.assign({},r):void 0}},{key:"getEdgeDisplayData",value:function(e){var r=this.edgeDataCache[e];return r?Object.assign({},r):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return K({},this.settings)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"setSetting",value:function(e,r){var o=K({},this.settings);return this.settings[e]=r,kn(this.settings),this.handleSettingsUpdate(o),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(e,r){return this.setSetting(e,r(this.settings[e])),this}},{key:"setSettings",value:function(e){var r=K({},this.settings);return this.settings=K(K({},this.settings),e),kn(this.settings),this.handleSettingsUpdate(r),this.scheduleRefresh(),this}},{key:"resize",value:function(e){var r=this.width,o=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=Ur(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!e&&r===this.width&&o===this.height)return this;for(var s in this.elements){var a=this.elements[s];a.style.width=this.width+"px",a.style.height=this.height+"px"}for(var c in this.canvasContexts)this.elements[c].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[c].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[c].scale(this.pixelRatio,this.pixelRatio);for(var d in this.webGLContexts){this.elements[d].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[d].setAttribute("height",this.height*this.pixelRatio+"px");var u=this.webGLContexts[d];if(u.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(d)){var h=this.textures[d];h&&u.deleteTexture(h)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(e){var r=this,o=(e==null?void 0:e.skipIndexation)!==void 0?e==null?void 0:e.skipIndexation:!1,s=(e==null?void 0:e.schedule)!==void 0?e.schedule:!1,a=!e||!e.partialGraph;if(a)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(y){return r.addNode(y)}),this.graph.forEachEdge(function(y){return r.addEdge(y)});else{for(var c,d,u=((c=e.partialGraph)===null||c===void 0?void 0:c.nodes)||[],h=0,l=(u==null?void 0:u.length)||0;h<l;h++){var f=u[h];if(this.updateNode(f),o){var g=this.nodeProgramIndex[f];if(g===void 0)throw new Error('Sigma: node "'.concat(f,`" can't be repaint`));this.addNodeToProgram(f,this.nodeIndices[f],g)}}for(var m=(e==null||(d=e.partialGraph)===null||d===void 0?void 0:d.edges)||[],p=0,v=m.length;p<v;p++){var b=m[p];if(this.updateEdge(b),o){var E=this.edgeProgramIndex[b];if(E===void 0)throw new Error('Sigma: edge "'.concat(b,`" can't be repaint`));this.addEdgeToProgram(b,this.edgeIndices[b],E)}}}return(a||!o)&&(this.needToProcess=!0),s?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var e=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){e.render()})),this}},{key:"scheduleRefresh",value:function(e){return this.refresh(K(K({},e),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(e,r){var o=this.camera.getState(),s=o.ratio,a=o.angle,c=o.x,d=o.y,u=this.settings,h=u.minCameraRatio,l=u.maxCameraRatio;typeof l=="number"&&(r=Math.min(r,l)),typeof h=="number"&&(r=Math.max(r,h));var f=r/s,g={x:this.width/2,y:this.height/2},m=this.viewportToFramedGraph(e),p=this.viewportToFramedGraph(g);return{angle:a,x:(m.x-p.x)*(1-f)+c,y:(m.y-p.y)*(1-f)+d,ratio:r}}},{key:"viewRectangle",value:function(){var e=this.viewportToFramedGraph({x:0,y:0}),r=this.viewportToFramedGraph({x:this.width,y:0}),o=this.viewportToFramedGraph({x:0,y:this.height});return{x1:e.x,y1:e.y,x2:r.x,y2:r.y,height:r.y-o.y}}},{key:"framedGraphToViewport",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!!r.graphDimensions,s=r.matrix?r.matrix:o?Gt(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding()):this.matrix,a=On(s,e);return{x:(1+a.x)*this.width/2,y:(1-a.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=!!r.cameraState||!!r.viewportDimensions||!r.graphDimensions,s=r.matrix?r.matrix:o?Gt(r.cameraState||this.camera.getState(),r.viewportDimensions||this.getDimensions(),r.graphDimensions||this.getGraphDimensions(),r.padding||this.getStagePadding(),!0):this.invMatrix,a=On(s,{x:e.x/this.width*2-1,y:1-e.y/this.height*2});return isNaN(a.x)&&(a.x=0),isNaN(a.y)&&(a.y=0),a}},{key:"viewportToGraph",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(e,r))}},{key:"graphToViewport",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(e),r)}},{key:"getGraphToViewportRatio",value:function(){var e={x:0,y:0},r={x:1,y:1},o=Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2)),s=this.graphToViewport(e),a=this.graphToViewport(r),c=Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2));return c/o}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(e){return this.customBBox=e,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var e=this.container;e.firstChild;)e.removeChild(e.firstChild);for(var r in this.nodePrograms)this.nodePrograms[r].kill();for(var o in this.nodeHoverPrograms)this.nodeHoverPrograms[o].kill();for(var s in this.edgePrograms)this.edgePrograms[s].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var a in this.elements)this.killLayer(a);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return e/this.settings.zoomToSizeRatioFunction(r)*(this.getSetting("itemSizesReference")==="positions"?r*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var e={};for(var r in this.elements)this.elements[r]instanceof HTMLCanvasElement&&(e[r]=this.elements[r]);return e}}])})(Jn),nc=tc;function Re(i,t,n,e,r){const o=Number(i==null?void 0:i[t]);return Number.isFinite(o)?Math.min(r,Math.max(e,o)):n}const Ln=Math.PI*2,rc=Math.PI*(3-Math.sqrt(5));class ic{constructor(){at(this,"strategy","fa2line")}run(t){const n=this.asState(t.previousState),e=this.buildSortedAdjacency(t.nodeIds,t.adjacencyByNodeId),r=this.computeConnectedComponents(t.nodeIds,e),o=this.assignStableComponentIds(r,n),s=[],a=[],c=[],d={anchors:{},nodePositions:{},components:[]};for(const u of o){const h=u.componentId,l=this.resolveComponentAnchor(h,u.nodeIds.length,n);d.anchors[h]=l,d.components.push({componentId:h,members:new Set(u.nodeIds),anchorX:l.x,anchorY:l.y}),s.push({componentId:h,nodeIds:u.nodeIds,anchorX:l.x,anchorY:l.y});const f=`${h}:community:0`;a.push({communityId:f,componentId:h,nodeIds:u.nodeIds,anchorX:l.x,anchorY:l.y});const g=this.seedPositions(u.nodeIds,f,l,n),m=this.solveComponentPositions(u.nodeIds,e,l,g,t);for(const[v,b]of m.entries())d.nodePositions[v]=b;const p=new Set(u.nodeIds);for(const v of u.nodeIds){const b=m.get(v)??l,E=e.get(v)??[];let y=0,I=0,x=0;for(const w of E){if(!p.has(w))continue;const S=m.get(w);S&&(y+=S.x,I+=S.y,x+=1)}x===0?(y=b.x,I=b.y):(y/=x,I/=x),c.push({nodeId:v,componentId:h,communityId:f,targetX:b.x,targetY:b.y,neighborX:y,neighborY:I,anchorX:l.x,anchorY:l.y})}}return c.sort((u,h)=>u.nodeId.localeCompare(h.nodeId)),{layout:{components:s,communities:a,nodeTargets:c},metadata:{state:d}}}asState(t){if(!t||typeof t!="object")return{anchors:{},nodePositions:{},components:[]};const n=t;return{anchors:this.toPointRecord(n.anchors),nodePositions:this.toPointRecord(n.nodePositions),components:this.toComponentSnapshots(n.components)}}toComponentSnapshots(t){if(!Array.isArray(t))return[];const n=[];for(const e of t){if(!e||typeof e!="object")continue;const r=e;if(typeof r.componentId!="string")continue;const o=Number(r.anchorX),s=Number(r.anchorY);if(!Number.isFinite(o)||!Number.isFinite(s))continue;const a=new Set;if(Array.isArray(r.members)||r.members instanceof Set)for(const c of r.members)typeof c=="string"&&a.add(c);n.push({componentId:r.componentId,members:a,anchorX:o,anchorY:s})}return n}toPointRecord(t){if(!t||typeof t!="object")return{};const n={};for(const[e,r]of Object.entries(t)){if(!r||typeof r!="object")continue;const o=r,s=Number(o.x),a=Number(o.y);!Number.isFinite(s)||!Number.isFinite(a)||(n[e]={x:s,y:a})}return n}hashId(t){let n=2166136261;for(let e=0;e<t.length;e+=1)n^=t.charCodeAt(e),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return n>>>0}buildSortedAdjacency(t,n){const e=new Map;for(const r of t){const o=n.get(r);if(!o||o.size===0){e.set(r,[]);continue}e.set(r,[...o].sort((s,a)=>s.localeCompare(a)))}return e}computeConnectedComponents(t,n){const e=new Set,r=[],o=[...t].sort((s,a)=>s.localeCompare(a));for(const s of o){if(e.has(s))continue;const a=[s],c=[];for(e.add(s);a.length>0;){const d=a.shift();c.push(d);const u=n.get(d);if(!(!u||u.length===0))for(const h of u)e.has(h)||(e.add(h),a.push(h))}c.sort((d,u)=>d.localeCompare(u)),r.push({nodeIds:c})}return r.sort((s,a)=>a.nodeIds.length-s.nodeIds.length||s.nodeIds[0].localeCompare(a.nodeIds[0])),r}buildComponentId(t){const n=t.slice(0,8).join(",");return`component:${t.length}:${this.hashId(n).toString(36)}`}assignStableComponentIds(t,n){const e=n.components;if(e.length===0)return t.map(s=>({componentId:this.buildComponentId(s.nodeIds),nodeIds:s.nodeIds}));const r=new Set,o=t.map(s=>{const a=new Set(s.nodeIds);let c=null,d=0,u=-1;for(const h of e){if(r.has(h.componentId))continue;let l=0;for(const g of a)h.members.has(g)&&(l+=1);if(l===0)continue;const f=l/Math.max(1,Math.max(a.size,h.members.size));(l>d||l===d&&f>u||l===d&&f===u&&c&&h.componentId.localeCompare(c.componentId)<0)&&(c=h,d=l,u=f)}return c?(r.add(c.componentId),{componentId:c.componentId,nodeIds:s.nodeIds}):{componentId:this.buildComponentId(s.nodeIds),nodeIds:s.nodeIds}});return o.sort((s,a)=>a.nodeIds.length-s.nodeIds.length||s.componentId.localeCompare(a.componentId)),o}resolveComponentAnchor(t,n,e){const r=e.anchors[t];if(r)return r;const o=18+Math.sqrt(Math.max(n,1))*12,a=this.hashId(t)%1e3*rc;return{x:Math.cos(a)*o,y:Math.sin(a)*o}}seedPositions(t,n,e,r){const o=new Map,s=Math.max(5,Math.sqrt(t.length)*3);for(let a=0;a<t.length;a+=1){const c=t[a],d=r.nodePositions[c];if(d){o.set(c,d);continue}const u=this.hashId(`${n}:${c}`),h=u%360/360*Ln,l=(a/Math.max(t.length,1)*Ln+h)%Ln,f=s*(.2+(u>>>9)%1e3/1e3*.8);o.set(c,{x:e.x+Math.cos(l)*f,y:e.y+Math.sin(l)*f})}return o}solveComponentPositions(t,n,e,r,o){const s=t.length,a=new Float32Array(s),c=new Float32Array(s),d=new Float32Array(s),u=new Float32Array(s),h=new Map;for(let x=0;x<s;x++){const w=t[x],S=r.get(w)??e;a[x]=S.x,c[x]=S.y,h.set(w,x)}const l=[];for(let x=0;x<s;x++){const w=t[x],S=n.get(w);if(S)for(const A of S){const _=h.get(A);_!==void 0&&x<_&&l.push(x,_)}}const f=Math.floor(Re(o.strategyConfig,"iterations",150,20,500)),g=Re(o.strategyConfig,"repulsionStrength",100,10,2e3),m=Re(o.strategyConfig,"attractionStrength",.05,.001,.5),p=Re(o.strategyConfig,"gravityStrength",.05,.001,.5);let v=1;const E=1-Math.pow(.001,1/Math.max(f,1)),y=.6;for(let x=0;x<f;x++){for(let w=0;w<s;w++)for(let S=w+1;S<s;S++){let A=a[w]-a[S],_=c[w]-c[S],T=A*A+_*_;T===0&&(A=(w*17+S*31)%71*.01-.35,_=(w*23+S*47)%71*.01-.35,T=A*A+_*_),T<1&&(T=1);const C=g*v/T,G=A*C,R=_*C;d[w]+=G,u[w]+=R,d[S]-=G,u[S]-=R}for(let w=0;w<l.length;w+=2){const S=l[w],A=l[w+1],_=a[S]-a[A],T=c[S]-c[A],C=m*v,G=_*C,R=T*C;d[S]-=G,u[S]-=R,d[A]+=G,u[A]+=R}for(let w=0;w<s;w++){const S=e.x-a[w],A=e.y-c[w];d[w]+=S*p*v,u[w]+=A*p*v,d[w]*=y,u[w]*=y,a[w]+=d[w],c[w]+=u[w]}v*=1-E}const I=new Map;for(let x=0;x<s;x++)I.set(t[x],{x:a[x],y:c[x]});return I}}const Wi={strategy:"fa2line",label:"FA2 Line",fields:[{key:"iterations",label:"Iterations",min:20,max:500,step:10},{key:"attractionStrength",label:"Attraction",min:.001,max:.5,step:.001},{key:"repulsionStrength",label:"Repulsion",min:10,max:2e3,step:10},{key:"gravityStrength",label:"Gravity",min:.001,max:.5,step:.001}],createInitialConfig:()=>({iterations:150,attractionStrength:.05,repulsionStrength:100,gravityStrength:.05}),summarizeConfig:i=>`iter=${Number(i.iterations??150)}`,createAlgorithm:()=>new ic},Ie=Math.PI*2,an=Math.PI*(3-Math.sqrt(5)),xe=1e-9,Kr=1048576,oc=2097153,Te=(i,t)=>i<t?-1:i>t?1:0,Yt=(i,t,n)=>Math.max(t,Math.min(n,i));class un{run(t){const n=Re(t.strategyConfig,"quality",1,.5,1.5),e=Re(t.strategyConfig,"stability",.8,0,.95),r=Re(t.strategyConfig,"nodeSpacing",8,4,20),o=[...t.nodeIds].sort(Te),s=new Map;for(const b of o)s.set(b,this.hashId(b));const a=this.readSnapshot(t.previousState),c=this.indexSnapshot(a),d=this.computeConnectedComponents(o,t.adjacencyByNodeId),u=this.assignStableComponentIds(d,c),h=[];for(const b of u){const E=this.detectCommunitiesLabelPropagation({componentId:b.componentId,nodeIds:b.nodeIds,adjacencyByNodeId:t.adjacencyByNodeId,previousIndex:c}),I=this.assignStableCommunityIds(b.componentId,E,c).map(x=>({communityId:x.communityId,componentId:b.componentId,nodeIds:x.nodeIds,radius:this.computeCommunityRadius(x.nodeIds.length,r),anchorX:0,anchorY:0}));I.sort((x,w)=>w.nodeIds.length-x.nodeIds.length||Te(x.communityId,w.communityId)),h.push({componentId:b.componentId,nodeIds:b.nodeIds,communities:I,radius:this.computeComponentRadius(I,r),anchorX:0,anchorY:0})}h.sort((b,E)=>E.nodeIds.length-b.nodeIds.length||Te(b.componentId,E.componentId)),this.placeComponentAnchors(h,c,r);for(const b of h)this.placeCommunityAnchors(b,c,r);const l=Object.create(null),f=new Map;for(const b of h)for(const E of b.communities){const{nodeIds:y,x:I,y:x}=this.layoutNodesInCommunity({communityId:E.communityId,componentId:b.componentId,nodeIds:E.nodeIds,anchorX:E.anchorX,anchorY:E.anchorY,communityRadius:E.radius,nodeSpacing:r,stability:e,quality:n,strategyConfig:t.strategyConfig,adjacencyByNodeId:t.adjacencyByNodeId,nodeHashById:s,previousIndex:c});for(let w=0;w<y.length;w++)l[y[w]]={x:I[w],y:x[w]},f.set(y[w],{componentId:b.componentId,communityId:E.communityId,anchorX:E.anchorX,anchorY:E.anchorY})}const g=[],m=[],p={version:2,components:[],communities:[],nodePositions:l};for(const b of h){g.push({componentId:b.componentId,nodeIds:b.nodeIds,anchorX:b.anchorX,anchorY:b.anchorY}),p.components.push({componentId:b.componentId,nodeIds:b.nodeIds,anchorX:b.anchorX,anchorY:b.anchorY,radius:b.radius});for(const E of b.communities)m.push({communityId:E.communityId,componentId:b.componentId,nodeIds:E.nodeIds,anchorX:E.anchorX,anchorY:E.anchorY}),p.communities.push({communityId:E.communityId,componentId:b.componentId,nodeIds:E.nodeIds,anchorX:E.anchorX,anchorY:E.anchorY,radius:E.radius})}const v=[];for(const b of o){const E=l[b]??c.nodePositions[b]??{x:0,y:0},y=f.get(b),I=(y==null?void 0:y.componentId)??c.componentByNodeId.get(b)??"component:unknown",x=(y==null?void 0:y.communityId)??c.communityByNodeId.get(b)??`${I}:community:unknown`,w=(y==null?void 0:y.anchorX)??E.x,S=(y==null?void 0:y.anchorY)??E.y;let A=0,_=0,T=0;const C=t.adjacencyByNodeId.get(b);if(C)for(const G of C){const R=l[G];R&&(A+=R.x,_+=R.y,T++)}T===0?(A=E.x,_=E.y):(A/=T,_/=T),v.push({nodeId:b,componentId:I,communityId:x,targetX:E.x,targetY:E.y,neighborX:A,neighborY:_,anchorX:w,anchorY:S})}return{layout:{components:g,communities:m,nodeTargets:v},metadata:{state:p}}}readSnapshot(t){if(!t||typeof t!="object")return;const n=t;if(!Array.isArray(n.components)||!Array.isArray(n.communities)||!n.nodePositions||typeof n.nodePositions!="object")return;const e=[];for(const o of n.components){if(!o||typeof o!="object")continue;const s=o,a=typeof s.componentId=="string"?s.componentId:null,c=Number(s.anchorX),d=Number(s.anchorY);if(!a||!Number.isFinite(c)||!Number.isFinite(d))continue;const u=this.readStringArray(s.nodeIds)??this.readStringArray(s.members)??[],h=s.radius==null?void 0:Number(s.radius);e.push({componentId:a,nodeIds:u,anchorX:c,anchorY:d,radius:Number.isFinite(h??NaN)?h:void 0})}const r=[];for(const o of n.communities){if(!o||typeof o!="object")continue;const s=o,a=typeof s.communityId=="string"?s.communityId:null,c=typeof s.componentId=="string"?s.componentId:null,d=Number(s.anchorX),u=Number(s.anchorY);if(!a||!c||!Number.isFinite(d)||!Number.isFinite(u))continue;const h=this.readStringArray(s.nodeIds)??this.readStringArray(s.members)??[],l=s.radius==null?void 0:Number(s.radius);r.push({communityId:a,componentId:c,nodeIds:h,anchorX:d,anchorY:u,radius:Number.isFinite(l??NaN)?l:void 0})}return{version:2,components:e,communities:r,nodePositions:this.toPointRecord(n.nodePositions)}}readStringArray(t){if(!t)return null;const n=[];if(Array.isArray(t)){for(const e of t)typeof e=="string"&&n.push(e);return n}if(t instanceof Set){for(const e of t)typeof e=="string"&&n.push(e);return n}return null}toPointRecord(t){if(!t||typeof t!="object")return Object.create(null);const n=Object.create(null);for(const[e,r]of Object.entries(t)){if(!r||typeof r!="object")continue;const o=r,s=Number(o.x),a=Number(o.y);!Number.isFinite(s)||!Number.isFinite(a)||(n[e]={x:s,y:a})}return n}indexSnapshot(t){const n=new Map,e=new Map,r=new Map,o=new Map,s=new Map,a=new Map,c=new Map;if(!t)return{componentByNodeId:n,communityByNodeId:e,componentSizeById:r,communitySizeById:o,componentAnchorById:s,communityAnchorById:a,communityComponentById:c,nodePositions:Object.create(null)};for(const d of t.components){r.set(d.componentId,d.nodeIds.length),s.set(d.componentId,{x:d.anchorX,y:d.anchorY});for(const u of d.nodeIds)n.set(u,d.componentId)}for(const d of t.communities){o.set(d.communityId,d.nodeIds.length),a.set(d.communityId,{x:d.anchorX,y:d.anchorY}),c.set(d.communityId,d.componentId);for(const u of d.nodeIds)e.set(u,d.communityId)}return{componentByNodeId:n,communityByNodeId:e,componentSizeById:r,communitySizeById:o,componentAnchorById:s,communityAnchorById:a,communityComponentById:c,nodePositions:t.nodePositions??Object.create(null)}}hashId(t){let n=2166136261;for(let e=0;e<t.length;e++)n^=t.charCodeAt(e),n=Math.imul(n,16777619);return n>>>0}buildComponentId(t){return`component:${t.length}:${this.hashId(t.slice(0,10).join(",")).toString(36)}`}buildCommunityId(t,n){return`${t}:community:${n.length}:${this.hashId(n.slice(0,10).join(",")).toString(36)}`}computeConnectedComponents(t,n){const e=new Set,r=[];for(const o of t){if(e.has(o))continue;const s=[o];e.add(o);let a=0;const c=[];for(;a<s.length;){const d=s[a++];c.push(d);const u=n.get(d);if(u)for(const h of u)e.has(h)||(e.add(h),s.push(h))}c.sort(Te),r.push(c)}return r.sort((o,s)=>s.length-o.length||Te(o[0]??"",s[0]??"")),r}assignStableComponentIds(t,n){const e=new Set,r=[];for(const o of t){const s=new Map;for(const h of o){const l=n.componentByNodeId.get(h);l&&s.set(l,(s.get(l)??0)+1)}let a=null,c=0,d=-1;for(const[h,l]of s){if(e.has(h))continue;const f=l/Math.max(1,Math.max(n.componentSizeById.get(h)??0,o.length));(l>c||l===c&&f>d||l===c&&f===d&&a!==null&&Te(h,a)<0)&&(a=h,c=l,d=f)}const u=a??this.buildComponentId(o);a&&e.add(a),r.push({componentId:u,nodeIds:o})}return r.sort((o,s)=>s.nodeIds.length-o.nodeIds.length||Te(o.componentId,s.componentId)),r}detectCommunitiesLabelPropagation(t){const{componentId:n,nodeIds:e,adjacencyByNodeId:r,previousIndex:o}=t;if(e.length<=1)return e.length===1?[e]:[];const s=[...e].sort(Te),a=new Map;for(let f=0;f<s.length;f++)a.set(s[f],f);const c=new Map;for(const f of s){const g=o.communityByNodeId.get(f),m=g?o.communityComponentById.get(g):null;c.set(f,g&&m===n?g:f)}const d=Yt(Math.ceil(Math.log2(s.length+1))+6,6,18),u=new Map;for(let f=0;f<d;f++){let g=!1;for(const m of s){const p=r.get(m);if(!p||p.size===0)continue;u.clear();for(const y of p){if(!a.has(y))continue;const I=c.get(y)??y;u.set(I,(u.get(I)??0)+1)}const v=c.get(m)??m;u.set(v,(u.get(v)??0)+1.15);let b=v,E=-1/0;for(const[y,I]of u)(I>E||I===E&&Te(y,b)<0)&&(b=y,E=I);b!==v&&(c.set(m,b),g=!0)}if(!g)break}const h=new Map;for(const f of s){const g=c.get(f)??f,m=h.get(g);m?m.push(f):h.set(g,[f])}const l=[...h.values()];for(const f of l)f.sort(Te);return l.sort((f,g)=>g.length-f.length||Te(f[0]??"",g[0]??"")),l}assignStableCommunityIds(t,n,e){const r=new Set,o=[];for(const s of n){const a=new Map;for(const l of s){const f=e.communityByNodeId.get(l);!f||e.communityComponentById.get(f)!==t||a.set(f,(a.get(f)??0)+1)}let c=null,d=0,u=-1;for(const[l,f]of a){if(r.has(l))continue;const g=f/Math.max(1,Math.max(e.communitySizeById.get(l)??0,s.length));(f>d||f===d&&g>u||f===d&&g===u&&c!==null&&Te(l,c)<0)&&(c=l,d=f,u=g)}const h=c??this.buildCommunityId(t,s);c&&r.add(c),o.push({communityId:h,nodeIds:s})}return o.sort((s,a)=>a.nodeIds.length-s.nodeIds.length||Te(s.communityId,a.communityId)),o}computeCommunityRadius(t,n){return n*(2.5+1.3*Math.sqrt(Math.max(1,t)))}computeComponentRadius(t,n){if(t.length===0)return n*10;let e=0;for(const r of t)e+=r.radius*r.radius;return Math.sqrt(e*1.3)+n*5}placeComponentAnchors(t,n,e){const r=t.length;if(r===0)return;if(r===1){const h=n.componentAnchorById.get(t[0].componentId);t[0].anchorX=(h==null?void 0:h.x)??0,t[0].anchorY=(h==null?void 0:h.y)??0;return}const o=new Float64Array(r),s=new Float64Array(r);for(let h=0;h<r;h++){const l=n.componentAnchorById.get(t[h].componentId);if(l)o[h]=l.x,s[h]=l.y;else{const f=h*an,g=e*14*Math.sqrt(h+1);o[h]=Math.cos(f)*g,s[h]=Math.sin(f)*g}}const a=e*4;for(let h=0;h<80;h++){let l=!1;for(let f=0;f<r;f++)for(let g=f+1;g<r;g++){const m=o[g]-o[f],p=s[g]-s[f],v=m*m+p*p,b=t[f].radius+t[g].radius+a;if(v>=b*b)continue;l=!0;const E=Math.sqrt(v)||xe,y=(b-E)*.55,I=m/E,x=p/E,w=t[f].nodeIds.length,S=t[g].nodeIds.length,A=w+S;o[f]-=I*y*S/A,s[f]-=x*y*S/A,o[g]+=I*y*w/A,s[g]+=x*y*w/A}if(!l)break}let c=0,d=0,u=0;for(let h=0;h<r;h++){const l=n.componentAnchorById.get(t[h].componentId);l&&(c+=l.x-o[h],d+=l.y-s[h],u++)}if(u>0){const h=c/u,l=d/u;for(let f=0;f<r;f++)o[f]+=h,s[f]+=l}for(let h=0;h<r;h++)t[h].anchorX=o[h],t[h].anchorY=s[h]}placeCommunityAnchors(t,n,e){const r=t.communities;if(r.length===0)return;if(r.length===1){r[0].anchorX=t.anchorX,r[0].anchorY=t.anchorY;return}const o=r.length,s=new Float64Array(o),a=new Float64Array(o),c=n.componentAnchorById.get(t.componentId),d=c?t.anchorX-c.x:0,u=c?t.anchorY-c.y:0;for(let l=0;l<o;l++){const f=n.communityAnchorById.get(r[l].communityId);if(f)s[l]=f.x+d,a[l]=f.y+u;else{const g=l*an,m=Math.max(r[0].radius*.6,e*5)*Math.sqrt(l+1);s[l]=t.anchorX+Math.cos(g)*m,a[l]=t.anchorY+Math.sin(g)*m}}const h=e*2;for(let l=0;l<80;l++){let f=!1;for(let g=0;g<o;g++)for(let m=g+1;m<o;m++){const p=s[m]-s[g],v=a[m]-a[g],b=p*p+v*v,E=r[g].radius+r[m].radius+h;if(b>=E*E)continue;f=!0;const y=Math.sqrt(b)||xe,I=(E-y)*.55,x=p/y,w=v/y,S=r[g].nodeIds.length,A=r[m].nodeIds.length,_=S+A;s[g]-=x*I*A/_,a[g]-=w*I*A/_,s[m]+=x*I*S/_,a[m]+=w*I*S/_}if(!f)break}for(let l=0;l<o;l++)r[l].anchorX=s[l],r[l].anchorY=a[l]}gridPush(t,n,e){let r=t.buckets.get(n);r||(r=t.pool.pop()??[],t.buckets.set(n,r),t.usedKeys.push(n)),r.push(e)}gridClear(t){for(const n of t.usedKeys){const e=t.buckets.get(n);e&&(e.length=0,t.pool.push(e),t.buckets.delete(n))}t.usedKeys.length=0}gridKey(t,n,e){const r=Math.floor(t/e),o=Math.floor(n/e);return(r+Kr)*oc+(o+Kr)}clampToContainment(t,n,e,r,o,s){for(let a=0;a<s;a++){const c=t[a]-e,d=n[a]-r,u=Math.sqrt(c*c+d*d);if(u>o){const h=o/u;t[a]=e+c*h,n[a]=r+d*h}}}}const Zr=1,Jr=.8,sc=8,Un=.8,zn=2;function Ut(i,t,n,e){return{x1:i,y1:t,x2:n,y2:e,totalMass:0,comX:0,comY:0,nodeIdx:-2,nodeX:0,nodeY:0,nodeMass:0,nw:null,ne:null,sw:null,se:null}}function zt(i,t,n,e,r){if(i.nodeIdx===-2){i.nodeIdx=t,i.nodeX=n,i.nodeY=e,i.nodeMass=r,i.comX=n,i.comY=e,i.totalMass=r;return}const o=i.totalMass+r;if(i.comX=(i.comX*i.totalMass+n*r)/o,i.comY=(i.comY*i.totalMass+e*r)/o,i.totalMass=o,i.nodeIdx>=0){const s=i.nodeIdx,a=i.nodeX,c=i.nodeY,d=i.nodeMass;i.nodeIdx=-1,Qr(i,s,a,c,d)}Qr(i,t,n,e,r)}function Qr(i,t,n,e,r){const o=(i.x1+i.x2)*.5,s=(i.y1+i.y2)*.5,a=n<o,c=e<s;a&&c?(i.nw||(i.nw=Ut(i.x1,i.y1,o,s)),zt(i.nw,t,n,e,r)):!a&&c?(i.ne||(i.ne=Ut(o,i.y1,i.x2,s)),zt(i.ne,t,n,e,r)):a&&!c?(i.sw||(i.sw=Ut(i.x1,s,o,i.y2)),zt(i.sw,t,n,e,r)):(i.se||(i.se=Ut(o,s,i.x2,i.y2)),zt(i.se,t,n,e,r))}function Bt(i,t,n,e,r,o,s,a,c){if(i.nodeIdx===-2||i.totalMass===0||i.nodeIdx===t)return;const d=n-i.comX,u=e-i.comY,h=d*d+u*u,l=Math.sqrt(h)||xe,f=i.x2-i.x1;if(!(n>=i.x1&&n<i.x2&&e>=i.y1&&e<i.y2)&&(i.nodeIdx>=0||f/l<o)){const m=s*r*i.totalMass/l;a[t]+=d/l*m,c[t]+=u/l*m;return}i.nw&&Bt(i.nw,t,n,e,r,o,s,a,c),i.ne&&Bt(i.ne,t,n,e,r,o,s,a,c),i.sw&&Bt(i.sw,t,n,e,r,o,s,a,c),i.se&&Bt(i.se,t,n,e,r,o,s,a,c)}function ac(i,t,n,e){if(e===0)return null;let r=1/0,o=1/0,s=-1/0,a=-1/0;for(let u=0;u<e;u++)i[u]<r&&(r=i[u]),t[u]<o&&(o=t[u]),i[u]>s&&(s=i[u]),t[u]>a&&(a=t[u]);const c=1+(s-r+a-o)*.01,d=Ut(r-c,o-c,s+c,a+c);for(let u=0;u<e;u++)zt(d,u,i[u],t[u],n[u]);return d}class cc extends un{constructor(){super(...arguments);at(this,"strategy","bh-fa2")}layoutNodesInCommunity(n){const{communityId:e,nodeIds:r,anchorX:o,anchorY:s,communityRadius:a,nodeSpacing:c,stability:d,quality:u,strategyConfig:h,adjacencyByNodeId:l,nodeHashById:f,previousIndex:g}=n,m=r.length,p=new Float64Array(m),v=new Float64Array(m);if(m===0)return{nodeIds:r,x:p,y:v};const b=Re(h,"gravity",Un,.1,3),E=Re(h,"scalingRatio",zn,.5,5),y=1.2,I=new Map;for(let P=0;P<m;P++)I.set(r[P],P);const x=g.communityAnchorById.get(e),w=x?o-x.x:0,S=x?s-x.y:0,A=a*1.05,_=this.hashId(e)%1e4/1e4*Ie;for(let P=0;P<m;P++){const J=g.nodePositions[r[P]];if(J){p[P]=J.x+w,v[P]=J.y+S;const ce=p[P]-o,ie=v[P]-s,he=Math.sqrt(ce*ce+ie*ie);he>A&&(p[P]=o+ce*A/he,v[P]=s+ie*A/he)}else{const ce=(P+.5)/Math.max(1,m),ie=Math.sqrt(ce)*Math.max(c*3,a-c*2),he=f.get(r[P])??0,fe=P*an+_+(he%1024/1024-.5)*.05;p[P]=o+Math.cos(fe)*ie,v[P]=s+Math.sin(fe)*ie}}const T=new Float64Array(m);for(let P=0;P<m;P++){const J=l.get(r[P]);if(J)for(const ce of J)I.has(ce)&&T[P]++}const C=new Float64Array(m);for(let P=0;P<m;P++)C[P]=T[P]+1;if(!x||m>20){let P=0;for(let J=0;J<m;J++)g.nodePositions[r[J]]||P++;P>m*.4&&this.coarseInit(p,v,r,o,s,a,c,T,l,_)}const G=[],R=[];for(let P=0;P<m;P++){const J=l.get(r[P]);if(J)for(const ce of J){const ie=I.get(ce);ie!=null&&ie>P&&(G.push(P),R.push(ie))}}const k=Yt(Math.round(30*u*(m<=80?1.4:m<=300?1.1:m<=1200?.85:.55)),6,60),$=new Float64Array(m),H=new Float64Array(m),V=new Float64Array(m),Z=new Float64Array(m),X=new Float64Array(m),ee=new Float64Array(m).fill(c*.8),oe=a*.3;for(let P=0;P<k;P++){$.fill(0),H.fill(0);const ce=1-P/Math.max(1,k-1)*.7,ie=ac(p,v,C,m);if(ie)for(let L=0;L<m;L++)Bt(ie,L,p[L],v[L],C[L],y,E,$,H);for(let L=0;L<G.length;L++){const B=G[L],z=R[L];let ae=p[z]-p[B],me=v[z]-v[B],de=ae*ae+me*me;if(de<xe){const Ze=(B*997+z*991+P*37)%360*(Ie/360);ae=Math.cos(Ze),me=Math.sin(Ze),de=1}const Ee=Math.sqrt(de),Me=Math.log(1+Ee)/E,Pe=ae/Ee,dt=me/Ee,Ke=Me/(T[B]+1),be=Me/(T[z]+1);$[B]+=Pe*Ke*C[B],H[B]+=dt*Ke*C[B],$[z]-=Pe*be*C[z],H[z]-=dt*be*C[z]}for(let L=0;L<m;L++){const B=o-p[L],z=s-v[L],ae=Math.sqrt(B*B+z*z)||xe,me=b*C[L]*ae;$[L]+=B/ae*me,H[L]+=z/ae*me}let he=0,fe=0;for(let L=0;L<m;L++){const B=$[L]-V[L],z=H[L]-Z[L];X[L]=Math.sqrt(B*B+z*z);const ae=$[L]+V[L],me=H[L]+Z[L];he+=C[L]*X[L],fe+=C[L]*Math.sqrt(ae*ae+me*me)*.5}const F=he>xe?fe/he:1,N=Yt(.1*F*ce,.005,c*1.2);for(let L=0;L<m;L++){ee[L]=Math.min(Yt(ee[L]*(1+.2*(X[L]<.1?1:-1)),.005,oe),N/(1+N*X[L]*.15));const B=Math.sqrt($[L]*$[L]+H[L]*H[L])||xe,z=Math.min(ee[L],oe/B);p[L]+=$[L]/B*B*z,v[L]+=H[L]/B*B*z,V[L]=$[L],Z[L]=H[L]}this.clampToContainment(p,v,o,s,A,m)}if(d>0){for(let P=0;P<m;P++){const J=g.nodePositions[r[P]];if(!J)continue;const ce=J.x+w,ie=J.y+S;p[P]=ce+(p[P]-ce)*(1-d),v[P]=ie+(v[P]-ie)*(1-d)}this.clampToContainment(p,v,o,s,A,m)}return{nodeIds:r,x:p,y:v}}coarseInit(n,e,r,o,s,a,c,d,u,h){const l=r.length;if(l<=3)return;const f=Array.from({length:l},(E,y)=>y).sort((E,y)=>d[y]-d[E]),g=Math.max(1,Math.round(l*.12)),m=Math.max(g+1,Math.round(l*.45)),p=c*1.5,v=Math.max(c*3,a*.38),b=Math.max(c*5,a*.78);for(let E=0;E<l;E++){const y=f[E];let I;E<g?I=p:E<m?I=v:I=b,u.get(r[y]);const x=h+E/l*Ie+(E<g?0:y*an);n[y]=o+Math.cos(x)*I,e[y]=s+Math.sin(x)*I}}}const dc={strategy:"bh-fa2",label:"Barnes-Hut FA2",fields:[{key:"quality",label:"Quality",min:.5,max:1.5,step:.05},{key:"stability",label:"Stability",min:0,max:.95,step:.05},{key:"nodeSpacing",label:"Node Spacing",min:4,max:20,step:1},{key:"gravity",label:"Gravity",min:.1,max:3,step:.1},{key:"scalingRatio",label:"Scaling Ratio",min:.5,max:5,step:.1}],createInitialConfig:()=>({quality:Zr,stability:Jr,nodeSpacing:sc,gravity:Un,scalingRatio:zn}),summarizeConfig:i=>`q=${Number(i.quality??Zr).toFixed(2)} stab=${Number(i.stability??Jr).toFixed(2)} g=${Number(i.gravity??Un).toFixed(1)} k=${Number(i.scalingRatio??zn).toFixed(1)}`,createAlgorithm:()=>new cc},$t=Math.PI*2,Mn=Math.PI*(3-Math.sqrt(5)),uc=4;class hc{constructor(){at(this,"strategy","hybrid-backbone")}run(t){const n=Math.floor(Re(t.strategyConfig,"refinementIterations",uc,2,20)),e=Re(t.strategyConfig,"communityPlacementScale",1,.4,2.4),r=this.buildSortedAdjacency(t.nodeIds,t.adjacencyByNodeId),o=this.computeConnectedComponents(t.nodeIds,r),s=this.asLayoutSnapshot(t.previousState),a=this.assignStableComponentIds(o,s),c=this.resolveComponentAnchors(a,s,e),d=[],u=[],h=[],l={components:[],communities:[],nodePositions:{}};for(const f of a){const g=c.get(f.componentId)??{x:0,y:0};let m=0,p=0;if(s){for(const S of s.components)if(S.componentId===f.componentId){m=g.x-S.anchorX,p=g.y-S.anchorY;break}}d.push({componentId:f.componentId,nodeIds:f.nodeIds,anchorX:g.x,anchorY:g.y}),l.components.push({componentId:f.componentId,members:new Set(f.nodeIds),anchorX:g.x,anchorY:g.y});const v=this.computeCommunities(f.nodeIds,r,s),b=this.assignStableCommunityIds(f.componentId,v,s),E=new Map,y=[],I=[];for(const S of b){const A=S.nodeIds;I.push(7+Math.sqrt(A.length)*3.6)}const w=(12+(I.length>0?Math.max(...I):0)*1.4+Math.sqrt(b.length)*7)*e;for(let S=0;S<b.length;S+=1){const A=b[S],_=A.nodeIds,T=A.communityId,C=this.hashId(`${T}:angle`)%360,G=b.length<=1?0:(S*53+C)%360/360*$t,R=this.resolvePreviousCommunityAnchor(s,T),k=g.x+Math.cos(G)*w,$=g.y+Math.sin(G)*w;let H=k,V=$;if(R){const ee=R.x+m,oe=R.y+p;H=ee+(k-ee)*.15,V=oe+($-oe)*.15}const Z={x:H,y:V};E.set(T,Z);const X={communityId:T,componentId:f.componentId,nodeIds:_,anchorX:Z.x,anchorY:Z.y};y.push(X),u.push(X),l.communities.push({communityId:T,componentId:f.componentId,members:new Set(_),anchorX:Z.x,anchorY:Z.y})}for(const S of y){const A=E.get(S.communityId),_=new Map;for(const C of S.nodeIds){const G=s==null?void 0:s.nodePositions[C];if(G){let R=0,k=0,$=!1;if(s){for(const H of s.communities)if(H.members.has(C)){R=H.anchorX,k=H.anchorY,$=!0;break}}$?_.set(C,{x:A.x+(G.x-R),y:A.y+(G.y-k)}):_.set(C,G)}}const T=this.refineCommunityTargets({communityNodeIds:S.nodeIds,sortedAdjacencyByNodeId:r,initialPositions:_,anchorX:A.x,anchorY:A.y,componentId:f.componentId,communityId:S.communityId,refinementIterations:Math.max(2,n)});for(const C of T)h.push(C),l.nodePositions[C.nodeId]={x:C.targetX,y:C.targetY}}}return h.sort((f,g)=>f.nodeId.localeCompare(g.nodeId)),{layout:{components:d,communities:u,nodeTargets:h},metadata:{state:l}}}asLayoutSnapshot(t){if(!t||typeof t!="object")return;const n=t;if(!Array.isArray(n.components))return;const e=[];for(const r of n.components){if(!r||typeof r!="object")continue;const o=r,s=typeof o.componentId=="string"?o.componentId:null,a=Number(o.anchorX),c=Number(o.anchorY);if(!s||!Number.isFinite(a)||!Number.isFinite(c))continue;const d=new Set;if(o.members instanceof Set)for(const u of o.members)typeof u=="string"&&d.add(u);e.push({componentId:s,members:d,anchorX:a,anchorY:c})}return{components:e,communities:this.toCommunitySnapshots(t.communities),nodePositions:this.toPointRecord(t.nodePositions)}}toPointRecord(t){if(!t||typeof t!="object")return{};const n={};for(const[e,r]of Object.entries(t)){if(!r||typeof r!="object")continue;const o=r,s=Number(o.x),a=Number(o.y);!Number.isFinite(s)||!Number.isFinite(a)||(n[e]={x:s,y:a})}return n}toCommunitySnapshots(t){if(!Array.isArray(t))return[];const n=[];for(const e of t){if(!e||typeof e!="object")continue;const r=e;if(typeof r.communityId!="string"||typeof r.componentId!="string")continue;const o=Number(r.anchorX),s=Number(r.anchorY);if(!Number.isFinite(o)||!Number.isFinite(s))continue;const a=new Set;if(Array.isArray(r.members))for(const c of r.members)typeof c=="string"&&a.add(c);else if(r.members instanceof Set)for(const c of r.members)typeof c=="string"&&a.add(c);n.push({communityId:r.communityId,componentId:r.componentId,members:a,anchorX:o,anchorY:s})}return n}hashId(t){let n=2166136261;for(let e=0;e<t.length;e+=1)n^=t.charCodeAt(e),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return n>>>0}buildSortedAdjacency(t,n){const e=new Map;for(const r of t){const o=n.get(r);if(!o||o.size===0){e.set(r,[]);continue}e.set(r,[...o].sort((s,a)=>s.localeCompare(a)))}return e}computeConnectedComponents(t,n){const e=new Set,r=[],o=[...t].sort((s,a)=>s.localeCompare(a));for(const s of o){if(e.has(s))continue;const a=[s],c=[];for(e.add(s);a.length>0;){const d=a.shift();c.push(d);const u=n.get(d);if(!(!u||u.length===0))for(const h of u)e.has(h)||(e.add(h),a.push(h))}c.sort((d,u)=>d.localeCompare(u)),r.push({nodeIds:c})}return r.sort((s,a)=>a.nodeIds.length-s.nodeIds.length||s.nodeIds[0].localeCompare(a.nodeIds[0])),r}computeCommunities(t,n,e){const r=new Map,o=[...t].sort((d,u)=>d.localeCompare(u));if(e){const d=new Map;for(const u of e.communities)for(const h of u.members)d.set(h,u.communityId);for(const u of o)r.set(u,d.get(u)??u)}else for(const d of o)r.set(d,d);const s=Math.max(2,Math.min(10,Math.ceil(Math.log2(t.length+1))+2));for(let d=0;d<s;d+=1){let u=!1;for(const h of o){const l=n.get(h);if(!l||l.length===0)continue;const f=new Map;for(const p of l){const v=r.get(p)??p;f.set(v,(f.get(v)??0)+1)}let g=r.get(h)??h,m=-1;for(const[p,v]of f.entries())(v>m||v===m&&p.localeCompare(g)<0)&&(g=p,m=v);g!==r.get(h)&&(r.set(h,g),u=!0)}if(!u)break}const a=new Map;for(const d of o){const u=r.get(d)??d,h=a.get(u)??[];h.push(d),a.set(u,h)}const c=[...a.values()].map(d=>d.sort((u,h)=>u.localeCompare(h)));return c.sort((d,u)=>u.length-d.length||d[0].localeCompare(u[0])),c}buildComponentId(t){const n=t.slice(0,8).join(",");return`component:${t.length}:${this.hashId(n).toString(36)}`}assignStableComponentIds(t,n){const e=(n==null?void 0:n.components)??[],r=new Set,o=t.map(s=>{const a=new Set(s.nodeIds);let c=null,d=0,u=-1;for(const l of e){if(r.has(l.componentId))continue;let f=0;for(const m of a)l.members.has(m)&&(f+=1);if(f===0)continue;const g=f/Math.max(1,Math.max(a.size,l.members.size));(f>d||f===d&&g>u||f===d&&g===u&&c&&l.componentId.localeCompare(c.componentId)<0)&&(c=l,d=f,u=g)}const h=c?c.componentId:this.buildComponentId(s.nodeIds);return c&&r.add(c.componentId),{componentId:h,nodeIds:s.nodeIds,weight:s.nodeIds.length}});return o.sort((s,a)=>a.weight-s.weight||s.componentId.localeCompare(a.componentId)),o}assignStableCommunityIds(t,n,e){const r=((e==null?void 0:e.communities)??[]).filter(s=>s.componentId===t),o=new Set;return n.map((s,a)=>{const c=new Set(s);let d=null,u=0,h=-1;for(const f of r){if(o.has(f.communityId))continue;let g=0;for(const p of c)f.members.has(p)&&(g+=1);if(g===0)continue;const m=g/Math.max(1,Math.max(c.size,f.members.size));(g>u||g===u&&m>h||g===u&&m===h&&d&&f.communityId.localeCompare(d.communityId)<0)&&(d=f,u=g,h=m)}if(d)return o.add(d.communityId),{communityId:d.communityId,nodeIds:s};const l=s.slice(0,6).join(",");return{communityId:`${t}:community:${a}:${this.hashId(l).toString(36)}`,nodeIds:s}}).sort((s,a)=>a.nodeIds.length-s.nodeIds.length||s.communityId.localeCompare(a.communityId))}resolvePreviousCommunityAnchor(t,n){if(!t)return null;for(const e of t.communities)if(e.communityId===n)return{x:e.anchorX,y:e.anchorY};return null}componentRadius(t){return 30+Math.sqrt(Math.max(t,1))*10}isAnchorPlacementFree(t,n,e,r){for(const o of t){const s=n-o.x,a=e-o.y,c=o.radius+r+10;if(s*s+a*a<c*c)return!1}return!0}placeAnchorNearPreferred(t,n,e,r){if(this.isAnchorPlacementFree(e,t.x,t.y,n))return t;const o=18;for(let c=1;c<=28;c+=1){const d=c*(n*.9+8);for(let u=0;u<o;u+=1){const h=(u+r)/o*$t,l=t.x+Math.cos(h)*d,f=t.y+Math.sin(h)*d;if(this.isAnchorPlacementFree(e,l,f,n))return{x:l,y:f}}}const s=40+r*11,a=r*Mn;return{x:t.x+Math.cos(a)*s,y:t.y+Math.sin(a)*s}}resolveComponentAnchors(t,n,e){const r=new Map,o=new Set,s=[],a=[...t].sort((c,d)=>d.weight-c.weight||c.componentId.localeCompare(d.componentId));for(const c of a){const d=this.componentRadius(c.weight)*Math.max(1,e),u=this.hashId(c.componentId)%31;let h={x:0,y:0},l=!1;if(!n||n.components.length===0){const m=24+Math.sqrt(c.weight)*7,p=u*Mn;h={x:Math.cos(p)*m,y:Math.sin(p)*m},l=!0}else{const m=new Set(c.nodeIds);let p=null,v=-1,b=-1;for(const E of n.components){if(o.has(E.componentId))continue;let y=0;for(const x of m)E.members.has(x)&&(y+=1);const I=y/Math.max(1,Math.max(m.size,E.members.size));(y>v||y===v&&I>b||y===v&&I===b&&p!==null&&E.componentId.localeCompare(p.componentId)<0)&&(p=E,v=y,b=I)}p&&v>0&&(h={x:p.anchorX,y:p.anchorY},l=!0,o.add(p.componentId))}if(!l){const m=24+Math.sqrt(c.weight)*7,p=u*Mn;h={x:Math.cos(p)*m,y:Math.sin(p)*m}}const f=this.placeAnchorNearPreferred(h,d,s,u),g={x:f.x,y:f.y,radius:d};s.push(g),r.set(c.componentId,g)}return new Map([...r.entries()].map(([c,d])=>[c,{x:d.x,y:d.y}]))}refineCommunityTargets(t){const{communityNodeIds:n,sortedAdjacencyByNodeId:e,initialPositions:r,anchorX:o,anchorY:s,componentId:a,communityId:c,refinementIterations:d}=t,u=[...n].sort((x,w)=>x.localeCompare(w)),h=new Set(u),l=new Map,f=Math.max(8,Math.sqrt(u.length)*3.2);for(let x=0;x<u.length;x+=1){const w=u[x],S=r.get(w);if(S){l.set(w,{x:S.x,y:S.y});continue}const A=this.hashId(`${c}:${w}`),_=A%360/360*$t,T=(x/Math.max(u.length,1)*$t+_)%$t,C=f*(.55+(A>>>8)%1e3/1e3*.7);l.set(w,{x:o+Math.cos(T)*C,y:s+Math.sin(T)*C})}const g=.2,m=.04,p=1.15,v=Math.max(4.2,f*.15),b=Math.max(18,f*1.8),E=Math.max(12,b),y=2.6;for(let x=0;x<d;x+=1){const w=new Map,S=new Map;for(const A of u){const _=l.get(A),T=Math.floor(_.x/E),C=Math.floor(_.y/E),G=`${T}:${C}`,R=S.get(G)??[];R.push(A),S.set(G,R)}for(const A of u){const _=l.get(A),T=e.get(A);let C=0,G=0,R=0;if(T&&T.length>0)for(const X of T){if(!h.has(X))continue;const ee=l.get(X);ee&&(C+=ee.x,G+=ee.y,R+=1)}let k=0,$=0;if(R>0){const X=C/R,ee=G/R;k+=(X-_.x)*g,$+=(ee-_.y)*g}k+=(o-_.x)*m,$+=(s-_.y)*m;const H=Math.floor(_.x/E),V=Math.floor(_.y/E);for(let X=-1;X<=1;X+=1)for(let ee=-1;ee<=1;ee+=1){const oe=`${H+X}:${V+ee}`,P=S.get(oe);if(P)for(const J of P){if(J===A)continue;const ce=l.get(J),ie=_.x-ce.x,he=_.y-ce.y,fe=ie*ie+he*he;if(fe<=1e-4){const L=this.hashId(A+J)%100/50-1,B=this.hashId(J+A)%100/50-1;k+=L*.5,$+=B*.5;continue}if(fe>b*b)continue;const F=Math.sqrt(fe),N=(b-F)/b*p;if(k+=ie/F*N,$+=he/F*N,F<y){const L=(y-F)/y;k+=ie/F*L*.9,$+=he/F*L*.9}}}const Z=Math.sqrt(k*k+$*$);Z>v&&Z>0&&(k=k/Z*v,$=$/Z*v),w.set(A,{x:_.x+k,y:_.y+$})}l.clear();for(const[A,_]of w.entries())l.set(A,_)}const I=[];for(const x of u){const w=l.get(x),S=e.get(x);let A=0,_=0,T=0;if(S&&S.length>0)for(const C of S){if(!h.has(C))continue;const G=l.get(C);G&&(A+=G.x,_+=G.y,T+=1)}T===0?(A=w.x,_=w.y):(A/=T,_/=T),I.push({nodeId:x,componentId:a,communityId:c,targetX:w.x,targetY:w.y,neighborX:A,neighborY:_,anchorX:o,anchorY:s})}return I}}const lc={strategy:"hybrid-backbone",label:"Hybrid Backbone",fields:[{key:"refinementIterations",label:"Refine Iterations",min:2,max:20,step:1},{key:"communityPlacementScale",label:"Community Spread",min:.4,max:2.4,step:.05}],createInitialConfig:()=>({refinementIterations:4,communityPlacementScale:1}),summarizeConfig:i=>{const t=Number(i.refinementIterations??4),n=Number(i.communityPlacementScale??1);return`iter=${t} spread=${n.toFixed(2)}`},createAlgorithm:()=>new hc},ei=1,ti=.8,fc=8,Bn=4;class gc extends un{constructor(){super(...arguments);at(this,"strategy","radial-sugiyama")}layoutNodesInCommunity(n){var F;const{communityId:e,nodeIds:r,anchorX:o,anchorY:s,communityRadius:a,nodeSpacing:c,stability:d,quality:u,strategyConfig:h,adjacencyByNodeId:l,nodeHashById:f,previousIndex:g}=n,m=r.length,p=new Float64Array(m),v=new Float64Array(m);if(m===0)return{nodeIds:r,x:p,y:v};if(m===1)return p[0]=o,v[0]=s,{nodeIds:r,x:p,y:v};const b=Math.round(Re(h,"sweepPasses",Bn,1,8)*u),E=new Map;for(let N=0;N<m;N++)E.set(r[N],N);let y=0,I=-1;for(let N=0;N<m;N++){let L=0;const B=l.get(r[N]);if(B)for(const z of B)E.has(z)&&L++;(L>I||L===I&&Te(r[N],r[y])<0)&&(I=L,y=N)}const x=new Int32Array(m).fill(-1),w=new Int32Array(m).fill(-1),S=new Int32Array(m);x[y]=0,S[0]=y;let A=0,_=1,T=0;for(;A<_;){const N=S[A++],L=x[N],B=l.get(r[N]);if(B)for(const z of B){const ae=E.get(z);ae==null||x[ae]!==-1||(x[ae]=L+1,w[ae]=N,L+1>T&&(T=L+1),S[_++]=ae)}}for(let N=0;N<m;N++)x[N]===-1&&(x[N]=T+1);const C=T+1,G=[];for(let N=0;N<=T+1;N++)G.push([]);for(let N=0;N<m;N++)G[x[N]].push(N);const R=Math.max(c*2,a-c),k=new Float64Array(C);k[0]=0;let $=0;for(let N=1;N<C;N++){const L=((F=G[N])==null?void 0:F.length)??0,B=L>1?L*c*1.2/(2*Math.PI):c,z=$+c*1.6,ae=N/C*R;k[N]=Math.max(ae,B,z),$=k[N]}const H=new Array(C);for(let N=0;N<C;N++){H[N]=new Float64Array(G[N].length);for(let L=0;L<G[N].length;L++)H[N][L]=L}const V=new Float64Array(m);for(let N=0;N<C;N++)for(let L=0;L<G[N].length;L++)V[G[N][L]]=H[N][L];const Z=(f.get(r[y])??this.hashId(r[y]))%1e4/1e4*Ie,X=new Float64Array(m);(()=>{X[y]=0;for(let N=1;N<C;N++){const L=G[N],B=L.length;if(B!==0)for(let z=0;z<B;z++)X[L[z]]=Z+z/B*Ie}})();for(let N=0;N<b;N++){for(let L=1;L<C;L++){const B=G[L];if(!(B.length<=1)){this.barycentricSort(B,L,l,r,E,x,X,Z);for(let z=0;z<B.length;z++)X[B[z]]=Z+z/B.length*Ie}}for(let L=C-2;L>=1;L--){const B=G[L];if(!(B.length<=1)){this.barycentricSort(B,L,l,r,E,x,X,Z);for(let z=0;z<B.length;z++)X[B[z]]=Z+z/B.length*Ie}}if(N===b-1||m<=60)for(let L=1;L<C;L++){const B=G[L];if(!(B.length<=2)){this.adjacentSwapPass(B,L,l,r,E,x,X,Z);for(let z=0;z<B.length;z++)X[B[z]]=Z+z/B.length*Ie}}}const oe=new Float64Array(m),P=new Float64Array(m);oe[y]=o,P[y]=s;for(let N=1;N<C;N++){const L=G[N],B=L.length;for(let z=0;z<B;z++){const ae=L[z],me=Z+z/B*Ie;oe[ae]=o+Math.cos(me)*k[N],P[ae]=s+Math.sin(me)*k[N]}}const J=g.communityAnchorById.get(e);J&&this.alignRotation(oe,P,r,o,s,J,g,m);const ce=J?o-J.x:0,ie=J?s-J.y:0,he=1-d,fe=a*1.05;for(let N=0;N<m;N++){const L=g.nodePositions[r[N]];if(L&&d>0){const B=L.x+ce,z=L.y+ie;p[N]=B+(oe[N]-B)*he,v[N]=z+(P[N]-z)*he}else p[N]=oe[N],v[N]=P[N]}return this.clampToContainment(p,v,o,s,fe,m),{nodeIds:r,x:p,y:v}}barycentricSort(n,e,r,o,s,a,c,d){const u=n.length;if(u<=1)return;const h=new Float64Array(u);for(let g=0;g<u;g++){const m=n[g],p=r.get(o[m]);let v=0,b=0,E=0;if(p)for(const y of p){const I=s.get(y);if(I==null||a[I]===e)continue;const x=c[I];b+=Math.cos(x),v+=Math.sin(x),E++}E>0?(h[g]=Math.atan2(v/E,b/E),h[g]<d&&(h[g]+=Ie)):h[g]=d+g/u*Ie}const l=Array.from({length:u},(g,m)=>m);l.sort((g,m)=>{const p=h[g]-h[m];return Math.abs(p)>1e-12?p:Te(o[n[g]],o[n[m]])});const f=n.slice();for(let g=0;g<u;g++)n[g]=f[l[g]]}adjacentSwapPass(n,e,r,o,s,a,c,d){const u=n.length,h=Math.min(u,6);for(let l=0;l<h;l++){let f=!1;for(let g=0;g<u-1;g++){const m=n[g],p=n[g+1],v=d+g/u*Ie,b=d+(g+1)/u*Ie,E=this.localCrossings(m,p,v,e,r,o,s,a,c);this.localCrossings(p,m,v,e,r,o,s,a,c)<E&&(n[g]=p,n[g+1]=m,c[p]=v,c[m]=b,f=!0)}if(!f)break}}localCrossings(n,e,r,o,s,a,c,d,u){const h=[],l=[],f=s.get(a[n]),g=s.get(a[e]);if(f)for(const p of f){const v=c.get(p);v!=null&&d[v]!==o&&h.push(u[v])}if(g)for(const p of g){const v=c.get(p);v!=null&&d[v]!==o&&l.push(u[v])}let m=0;for(const p of h)for(const v of l){const b=(p-r+Ie*2)%Ie,E=(v-r+Ie*2)%Ie;b>E&&m++}return m}alignRotation(n,e,r,o,s,a,c,d){let u=0,h=0,l=0;for(let p=0;p<d;p++){const v=c.nodePositions[r[p]];if(!v)continue;const b=n[p]-o,E=e[p]-s,y=v.x-a.x,I=v.y-a.y;b*b+E*E<xe||y*y+I*I<xe||(u+=b*y+E*I,h+=b*I-E*y,l++)}if(l<3||u*u+h*h<xe)return;const f=Math.atan2(h,u);if(Math.abs(f)<.01)return;const g=Math.cos(f),m=Math.sin(f);for(let p=0;p<d;p++){const v=n[p]-o,b=e[p]-s;n[p]=o+v*g-b*m,e[p]=s+v*m+b*g}}}const mc={strategy:"radial-sugiyama",label:"Radial Sugiyama",fields:[{key:"quality",label:"Quality",min:.5,max:1.5,step:.05},{key:"stability",label:"Stability",min:0,max:.95,step:.05},{key:"nodeSpacing",label:"Node Spacing",min:4,max:20,step:1},{key:"sweepPasses",label:"Sweep Passes",min:1,max:8,step:1}],createInitialConfig:()=>({quality:ei,stability:ti,nodeSpacing:fc,sweepPasses:Bn}),summarizeConfig:i=>`q=${Number(i.quality??ei).toFixed(2)} stab=${Number(i.stability??ti).toFixed(2)} sweeps=${Number(i.sweepPasses??Bn)}`,createAlgorithm:()=>new gc},ni=1,ri=.8,pc=8,jn=1.2,Yn=5;class yc extends un{constructor(){super(...arguments);at(this,"strategy","stress-majorization")}layoutNodesInCommunity(n){const{communityId:e,nodeIds:r,anchorX:o,anchorY:s,communityRadius:a,nodeSpacing:c,stability:d,quality:u,strategyConfig:h,adjacencyByNodeId:l,nodeHashById:f,previousIndex:g}=n,m=r.length,p=new Float64Array(m),v=new Float64Array(m);if(m===0)return{nodeIds:r,x:p,y:v};const b=Re(h,"anchorWeight",jn,0,4),E=Math.round(Re(h,"maxHops",Yn,2,10)),y=Yt(Math.round(12*u*(m<=60?1.5:m<=250?1.1:m<=800?.8:.6)),3,25),I=new Map;for(let F=0;F<m;F++)I.set(r[F],F);const x=g.communityAnchorById.get(e),w=x?o-x.x:0,S=x?s-x.y:0,A=a*1.05,_=Math.max(c*3,a-c*2),T=new Float64Array(m),C=new Float64Array(m),G=new Uint8Array(m);for(let F=0;F<m;F++){const N=g.nodePositions[r[F]];if(N){p[F]=N.x+w,v[F]=N.y+S,T[F]=p[F],C[F]=v[F],G[F]=1;const L=p[F]-o,B=v[F]-s,z=Math.sqrt(L*L+B*B);z>A&&(p[F]=o+L*A/z,v[F]=s+B*A/z)}else{let L=0,B=0,z=0;const ae=l.get(r[F]);if(ae)for(const me of ae){const de=I.get(me);if(de!=null&&G[de]&&(L+=p[de],B+=v[de],z++,z>=4))break}if(z>0)p[F]=L/z,v[F]=B/z;else{const me=f.get(r[F])??F,de=F*Math.PI*(3-Math.sqrt(5))+me%1e4/1e4*2*Math.PI,Ee=Math.sqrt((F+.5)/Math.max(1,m))*_;p[F]=o+Math.cos(de)*Ee,v[F]=s+Math.sin(de)*Ee}T[F]=p[F],C[F]=v[F]}}const R=c*2.2,k=new Int32Array(m),$=new Int32Array(m+4),H=new Int32Array(m);for(let F=0;F<m;F++){H.fill(-1),H[F]=0,$[0]=F;let N=0,L=1;for(;N<L;){const B=$[N++],z=H[B];if(z>=E)continue;const ae=l.get(r[B]);if(ae)for(const me of ae){const de=I.get(me);de==null||H[de]!==-1||(H[de]=z+1,$[L++]=de,k[F]++)}}}const V=new Int32Array(m+1);for(let F=0;F<m;F++)V[F+1]=V[F]+k[F];const Z=V[m],X=new Int32Array(Z),ee=new Float64Array(Z),oe=new Float64Array(Z),P=new Float64Array(m),J=new Int32Array(m);for(let F=0;F<m;F++){H.fill(-1),H[F]=0,$[0]=F;let N=0,L=1;for(;N<L;){const B=$[N++],z=H[B];if(z>=E)continue;const ae=l.get(r[B]);if(ae)for(const me of ae){const de=I.get(me);if(de==null||H[de]!==-1)continue;H[de]=z+1,$[L++]=de;const Ee=(z+1)*R,Me=1/(Ee*Ee+xe),Pe=V[F]+J[F];X[Pe]=de,ee[Pe]=Ee,oe[Pe]=Me,J[F]++,P[F]+=Me}}}const ce=new Float64Array(m),ie=new Float64Array(m);for(let F=0;F<y;F++){for(let N=0;N<m;N++){const L=V[N],B=V[N+1];let z=0,ae=0;for(let Ee=L;Ee<B;Ee++){const Me=X[Ee],Pe=ee[Ee],dt=oe[Ee];let Ke=p[N]-p[Me],be=v[N]-v[Me],Ze=Math.sqrt(Ke*Ke+be*be);if(Ze<xe){const Tt=(N*997+Me*991+F*37)%360*(2*Math.PI/360);Ke=Math.cos(Tt)*.01,be=Math.sin(Tt)*.01,Ze=.01}z+=dt*(p[Me]+Pe*(Ke/Ze)),ae+=dt*(v[Me]+Pe*(be/Ze))}const me=b*(G[N]?1:.3),de=P[N]+me;de<xe?(ce[N]=p[N],ie[N]=v[N]):(ce[N]=(z+me*T[N])/de,ie[N]=(ae+me*C[N])/de)}for(let N=0;N<m;N++)p[N]=ce[N],v[N]=ie[N];this.clampToContainment(p,v,o,s,A,m)}const he=.06;for(let F=0;F<m;F++)p[F]+=(o-p[F])*he,v[F]+=(s-v[F])*he;const fe=d*.35;if(fe>.01&&x)for(let F=0;F<m;F++)G[F]&&(p[F]=T[F]+(p[F]-T[F])*(1-fe),v[F]=C[F]+(v[F]-C[F])*(1-fe));return this.clampToContainment(p,v,o,s,A,m),m>1&&m<=800&&this.resolveCollisions(p,v,o,s,c,A,m),{nodeIds:r,x:p,y:v}}resolveCollisions(n,e,r,o,s,a,c){const d=s*.88,u=c<=200?2:1;for(let h=0;h<u;h++){if(c<=350)for(let l=0;l<c;l++)for(let f=l+1;f<c;f++){let g=n[l]-n[f],m=e[l]-e[f];const p=g*g+m*m;if(p>=d*d)continue;const v=Math.sqrt(p)||xe,b=(d-v)*.5;g/=v,m/=v,n[l]+=g*b,e[l]+=m*b,n[f]-=g*b,e[f]-=m*b}else{const l=d*2,f=this.makeGridStore();for(let p=0;p<c;p++)this.gridPush(f,this.gridKey(n[p],e[p],l),p);const g=new Float64Array(c),m=new Float64Array(c);for(let p=0;p<c;p++){const v=Math.floor(n[p]/l),b=Math.floor(e[p]/l);for(let E=-1;E<=1;E++)for(let y=-1;y<=1;y++){const I=this.gridKey((v+E)*l,(b+y)*l,l),x=f.buckets.get(I);if(x)for(const w of x){if(w<=p)continue;let S=n[p]-n[w],A=e[p]-e[w];const _=S*S+A*A;if(_>=d*d)continue;const T=Math.sqrt(_)||xe,C=(d-T)*.5;S/=T,A/=T,g[p]+=S*C,m[p]+=A*C,g[w]-=S*C,m[w]-=A*C}}}this.gridClear(f);for(let p=0;p<c;p++)n[p]+=g[p],e[p]+=m[p]}this.clampToContainment(n,e,r,o,a,c)}}makeGridStore(){return{buckets:new Map,usedKeys:[],pool:[]}}}const vc={strategy:"stress-majorization",label:"Stress Majorization",fields:[{key:"quality",label:"Quality",min:.5,max:1.5,step:.05},{key:"stability",label:"Stability",min:0,max:.95,step:.05},{key:"nodeSpacing",label:"Node Spacing",min:4,max:20,step:1},{key:"anchorWeight",label:"Anchor Weight",min:0,max:4,step:.1},{key:"maxHops",label:"Max Hops",min:2,max:10,step:1}],createInitialConfig:()=>({quality:ni,stability:ri,nodeSpacing:pc,anchorWeight:jn,maxHops:Yn}),summarizeConfig:i=>`q=${Number(i.quality??ni).toFixed(2)} stab=${Number(i.stability??ri).toFixed(2)} anc=${Number(i.anchorWeight??jn).toFixed(1)} hops=${Number(i.maxHops??Yn)}`,createAlgorithm:()=>new yc},ii=8,oi=.8,si=1;class bc extends un{constructor(){super(...arguments);at(this,"strategy","strict-temporal")}layoutNodesInCommunity(n){const{communityId:e,nodeIds:r,anchorX:o,anchorY:s,communityRadius:a,nodeSpacing:c,stability:d,quality:u,adjacencyByNodeId:h,nodeHashById:l,previousIndex:f}=n,g=r.length,m=new Float64Array(g),p=new Float64Array(g);if(g===0)return{nodeIds:r,x:m,y:p};const v=new Map;for(let A=0;A<g;A++)v.set(r[A],A);const b=new Float64Array(g),E=new Float64Array(g);this.computeBFSRingLayout({nodeIds:r,localIndex:v,anchorX:o,anchorY:s,communityRadius:a,nodeSpacing:c,adjacencyByNodeId:h,nodeHashById:l,targetX:b,targetY:E});const y=f.communityAnchorById.get(e);y&&this.alignTargetRotation({nodeIds:r,targetX:b,targetY:E,anchorX:o,anchorY:s,prevAnchor:y,previousIndex:f});const I=y?o-y.x:0,x=y?s-y.y:0,w=1-d;for(let A=0;A<g;A++){const _=f.nodePositions[r[A]];if(_&&d>0){const T=_.x+I,C=_.y+x;m[A]=T+(b[A]-T)*w,p[A]=C+(E[A]-C)*w}else m[A]=b[A],p[A]=E[A]}const S=a*1.08;if(this.clampToContainment(m,p,o,s,S,g),g>1){const A=g<=300?Math.round(3*u):g<=1e3?Math.round(2*u):1;this.resolveNodeCollisions({x:m,y:p,anchorX:o,anchorY:s,nodeSpacing:c,containR:S,n:g,iterations:A})}return{nodeIds:r,x:m,y:p}}computeBFSRingLayout(n){var G;const{nodeIds:e,localIndex:r,anchorX:o,anchorY:s,communityRadius:a,nodeSpacing:c,adjacencyByNodeId:d,nodeHashById:u,targetX:h,targetY:l}=n,f=e.length;if(f===1){h[0]=o,l[0]=s;return}let g=0,m=-1;for(let R=0;R<f;R++){let k=0;const $=d.get(e[R]);if($)for(const H of $)r.has(H)&&k++;(k>m||k===m&&Te(e[R],e[g])<0)&&(m=k,g=R)}const p=new Int32Array(f).fill(-1),v=new Int32Array(f).fill(-1),b=[g];p[g]=0;let E=0,y=0;for(;E<b.length;){const R=b[E++],k=p[R],$=d.get(e[R]);if($)for(const H of $){const V=r.get(H);V==null||p[V]!==-1||(p[V]=k+1,v[V]=R,k+1>y&&(y=k+1),b.push(V))}}let I=!1;for(let R=0;R<f;R++)p[R]===-1&&(p[R]=y+1,I=!0);const x=y+(I?2:1),w=[];for(let R=0;R<f;R++){const k=p[R];for(;w.length<=k;)w.push([]);w[k].push(R)}const S=Math.max(c*2,a-c),A=x>1?S/(x-.5):S,_=new Float64Array(x);let T=0;for(let R=1;R<x;R++){const k=((G=w[R])==null?void 0:G.length)??0,$=k>1?k*c*1.15/(2*Math.PI):0,H=T+c*1.5,V=R*A;_[R]=Math.max(V,$,H),T=_[R]}h[g]=o,l[g]=s;const C=(u.get(e[g])??0)%1e4/1e4*Ie;for(let R=1;R<w.length;R++){const k=w[R];if(!k||k.length===0)continue;const $=_[R],H=k.length,V=k.map(X=>{const ee=v[X];let oe;if(ee>=0){const P=h[ee]-o,J=l[ee]-s;oe=Math.sqrt(P*P+J*J)>xe?Math.atan2(J,P):0}else oe=(u.get(e[X])??0)%1e4/1e4*Ie;return{i:X,parentAngle:oe}});V.sort((X,ee)=>{const oe=X.parentAngle-ee.parentAngle;return Math.abs(oe)>1e-12?oe:Te(e[X.i],e[ee.i])});const Z=V[0].parentAngle+C;for(let X=0;X<H;X++){const ee=Z+X/H*Ie,{i:oe}=V[X];h[oe]=o+Math.cos(ee)*$,l[oe]=s+Math.sin(ee)*$}}}alignTargetRotation(n){const{nodeIds:e,targetX:r,targetY:o,anchorX:s,anchorY:a,prevAnchor:c,previousIndex:d}=n,u=e.length;let h=0,l=0,f=0;for(let v=0;v<u;v++){const b=d.nodePositions[e[v]];if(!b)continue;const E=r[v]-s,y=o[v]-a,I=b.x-c.x,x=b.y-c.y;E*E+y*y<xe||I*I+x*x<xe||(h+=E*I+y*x,l+=E*x-y*I,f++)}if(f<2||h*h+l*l<xe)return;const g=Math.atan2(l,h);if(Math.abs(g)<.008)return;const m=Math.cos(g),p=Math.sin(g);for(let v=0;v<u;v++){const b=r[v]-s,E=o[v]-a;r[v]=s+b*m-E*p,o[v]=a+b*p+E*m}}resolveNodeCollisions(n){const{x:e,y:r,anchorX:o,anchorY:s,nodeSpacing:a,containR:c,n:d,iterations:u}=n,h=a*.85;if(d<=400)for(let l=0;l<u;l++){for(let f=0;f<d;f++)for(let g=f+1;g<d;g++){let m=e[f]-e[g],p=r[f]-r[g];const v=m*m+p*p;if(v>=h*h)continue;const b=Math.sqrt(v)||xe,E=(h-b)*.5;m/=b,p/=b,e[f]+=m*E,r[f]+=p*E,e[g]-=m*E,r[g]-=p*E}this.clampToContainment(e,r,o,s,c,d)}else{const l=h*2,f=this.makeGridStore(),g=new Float64Array(d),m=new Float64Array(d);for(let p=0;p<u;p++){g.fill(0),m.fill(0),this.gridClear(f);for(let v=0;v<d;v++)this.gridPush(f,this.gridKey(e[v],r[v],l),v);for(let v=0;v<d;v++){const b=Math.floor(e[v]/l),E=Math.floor(r[v]/l);for(let y=-1;y<=1;y++)for(let I=-1;I<=1;I++){const x=f.buckets.get(this.gridKey((b+y)*l,(E+I)*l,l));if(x)for(const w of x){if(w<=v)continue;let S=e[v]-e[w],A=r[v]-r[w];const _=S*S+A*A;if(_>=h*h)continue;const T=Math.sqrt(_)||xe,C=(h-T)*.5;S/=T,A/=T,g[v]+=S*C,m[v]+=A*C,g[w]-=S*C,m[w]-=A*C}}}for(let v=0;v<d;v++)e[v]+=g[v],r[v]+=m[v];this.clampToContainment(e,r,o,s,c,d)}}}makeGridStore(){return{buckets:new Map,usedKeys:[],pool:[]}}}const wc={strategy:"strict-temporal",label:"Strict Temporal",fields:[{key:"quality",label:"Quality",min:.5,max:1.5,step:.05},{key:"stability",label:"Stability",min:0,max:.95,step:.05},{key:"nodeSpacing",label:"Node Spacing",min:4,max:20,step:1}],createInitialConfig:()=>({quality:si,stability:oi,nodeSpacing:ii}),summarizeConfig:i=>{const t=Number(i.quality??si),n=Number(i.stability??oi),e=Number(i.nodeSpacing??ii);return`q=${t.toFixed(2)} stab=${n.toFixed(2)} space=${e}`},createAlgorithm:()=>new bc},qi=1,Xi=.85,Vi=10,nn=1e-4,ai=.05;class xc{constructor(){at(this,"strategy","balanced-temporal")}run(t){var _;const n=Re(t.strategyConfig,"quality",qi,.1,2),e=Re(t.strategyConfig,"stability",Xi,0,1),r=Re(t.strategyConfig,"nodeSpacing",Vi,5,50),o=Math.round(150*n),s=r*4,a=r*1.5,c=e*.15,d=this.parseSnapshot(t.previousState),u=t.nodeIds,h=t.adjacencyByNodeId,l=this.computeConnectedComponents(u,h),f=new Map;for(const T of l){const C=`comp:${T[0]}`;for(const G of T)f.set(G,C)}const g=[],m=new Map,p=[...u].sort();for(let T=0;T<p.length;T++){const C=p[T],G=d.get(C);let R=0,k=0,$=!0;if(G)R=G.x,k=G.y,$=!1;else{const H=h.get(C);let V=0,Z=0,X=0;if(H)for(const ee of H){const oe=d.get(ee);oe&&(V+=oe.x,Z+=oe.y,X++)}if(X>0)R=V/X,k=Z/X,R+=(Math.random()-.5)*r*.1,k+=(Math.random()-.5)*r*.1;else{const ee=T*.1,oe=r*5;R=Math.cos(ee)*oe,k=Math.sin(ee)*oe}}g.push({id:C,x:R,y:k,vx:0,vy:0,fx:0,fy:0,prevX:G==null?void 0:G.x,prevY:G==null?void 0:G.y,isNew:$,componentId:f.get(C)||"unknown",mass:1+(((_=h.get(C))==null?void 0:_.size)||0)*.5}),m.set(C,T)}const v=[];for(const T of p){const C=m.get(T);if(C===void 0)continue;const G=h.get(T);if(G)for(const R of G){const k=m.get(R);k!==void 0&&C<k&&v.push({source:C,target:k,weight:1})}}const b=.5,E=.85,y=Math.max(20,s);for(let T=0;T<o;T++){const C=(1-T/o)*(1-e*.5);for(let R=0;R<g.length;R++)g[R].fx=0,g[R].fy=0;for(const R of v){const k=g[R.source],$=g[R.target],H=$.x-k.x,V=$.y-k.y;let Z=Math.sqrt(H*H+V*V);Z<nn&&(Z=nn);const X=Z-a,oe=.05*C*X,P=H/Z*oe,J=V/Z*oe;k.fx+=P,k.fy+=J,$.fx-=P,$.fy-=J}const G=new Map;for(let R=0;R<g.length;R++){const k=Math.floor(g[R].x/y),$=Math.floor(g[R].y/y),H=`${k},${$}`,V=G.get(H);V?V.push(R):G.set(H,[R])}for(let R=0;R<g.length;R++){const k=g[R],$=Math.floor(k.x/y),H=Math.floor(k.y/y);for(let V=-1;V<=1;V++)for(let Z=-1;Z<=1;Z++){const X=`${$+V},${H+Z}`,ee=G.get(X);if(ee)for(const oe of ee){if(R===oe)continue;const P=g[oe],J=k.x-P.x,ce=k.y-P.y;let ie=J*J+ce*ce;if(ie>s*s)continue;ie<nn&&(ie=nn,k.fx+=Math.random(),k.fy+=Math.random());const he=Math.sqrt(ie),fe=r*15*C/he,F=J/he*fe,N=ce/he*fe;k.fx+=F,k.fy+=N}}}for(let R=0;R<g.length;R++){const k=g[R];k.fx-=k.x*ai*C,k.fy-=k.y*ai*C}if(c>0)for(let R=0;R<g.length;R++){const k=g[R];if(k.prevX!==void 0&&k.prevY!==void 0){const $=k.prevX-k.x,H=k.prevY-k.y;k.isNew||(k.fx+=$*c,k.fy+=H*c)}}for(let R=0;R<g.length;R++){const k=g[R],$=100;k.fx=Math.max(-$,Math.min($,k.fx)),k.fy=Math.max(-$,Math.min($,k.fy)),k.vx=(k.vx+k.fx*b)*E,k.vy=(k.vy+k.fy*b)*E,k.x+=k.vx*b,k.y+=k.vy*b}}const I=[],x={},w=[],S=[],A=new Map;for(const T of g){A.has(T.componentId)||A.set(T.componentId,{x:0,y:0,count:0});const C=A.get(T.componentId);C.x+=T.x,C.y+=T.y,C.count++}for(const[T,C]of A)C.x/=C.count,C.y/=C.count,w.push({componentId:T,nodeIds:[],anchorX:C.x,anchorY:C.y});for(const T of g){x[T.id]={x:T.x,y:T.y};const C=A.get(T.componentId)||{x:T.x,y:T.y};let G=0,R=0,k=0;const $=h.get(T.id);if($)for(const H of $){const V=m.get(H);V!==void 0&&(G+=g[V].x,R+=g[V].y,k++)}k===0?(G=T.x,R=T.y):(G/=k,R/=k),I.push({nodeId:T.id,targetX:T.x,targetY:T.y,componentId:T.componentId,communityId:"default",anchorX:C.x,anchorY:C.y,neighborX:G,neighborY:R})}return{layout:{components:w,communities:S,nodeTargets:I},metadata:{state:{version:3,nodePositions:x}}}}parseSnapshot(t){const n=new Map;if(!t||typeof t!="object")return n;const r=t.nodePositions;if(r&&typeof r=="object")for(const[o,s]of Object.entries(r)){const a=s;typeof a.x=="number"&&typeof a.y=="number"&&n.set(o,{x:a.x,y:a.y})}return n}computeConnectedComponents(t,n){const e=new Set,r=[];for(const o of t){if(e.has(o))continue;const s=[],a=[o];for(e.add(o);a.length>0;){const c=a.pop();s.push(c);const d=n.get(c);if(d)for(const u of d)e.has(u)||(e.add(u),a.push(u))}r.push(s)}return r.sort((o,s)=>s.length-o.length),r}}const Ec={strategy:"balanced-temporal",label:"Balanced Temporal",fields:[{key:"quality",label:"Simulation Steps",min:.1,max:2,step:.1},{key:"stability",label:"Stability",min:0,max:1,step:.05},{key:"nodeSpacing",label:"Node Spacing",min:5,max:50,step:1}],createInitialConfig:()=>({quality:qi,stability:Xi,nodeSpacing:Vi}),summarizeConfig:i=>`Q:${i.quality} S:${i.stability} Sp:${i.nodeSpacing}`,createAlgorithm:()=>new xc},Ki=[lc,Ec,wc,Wi,dc,vc,mc],Dn=Wi.strategy,Ic=new Map(Ki.map(i=>[i.strategy,i])),Ac=Ki.map(i=>({value:i.strategy,label:i.label}));function hn(i){const t=Ic.get(i);if(!t)throw new Error(`[network-layout] Missing strategy definition for: ${i}`);return t}function rn(i){return hn(i).createInitialConfig()}function Sc(i,t){const n=hn(i);return n.summarizeConfig(t??n.createInitialConfig())}function _c(i){return hn(i).fields}function Tc(i){return hn(i).label}const Cc=Math.PI*2;function ci(i){let t=2166136261;for(let n=0;n<i.length;n+=1)t^=i.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function di(i){const t=ci(i),n=ci(`${i}:orbit`),e=t/4294967295*Cc,r=16+Math.sqrt(n%4096+1)*2.4;return{x:Math.cos(e)*r,y:Math.sin(e)*r}}function Rc(i,t,n){const e=Math.max(0,Math.min(1,n));return{x:i.x+(t.x-i.x)*e,y:i.y+(t.y-i.y)*e}}function kc(i,t){const n=t.x-i.x,e=t.y-i.y;return Math.hypot(n,e)}function Nc(i,t,n){const e=Math.max(0,n);if(e<=0)return{...i};const r=t.x-i.x,o=t.y-i.y,s=Math.hypot(r,o);if(s<=e||s===0)return t;const a=e/s;return{x:i.x+r*a,y:i.y+o*a}}const Lc=1.8,Mc=300,Hn=220,Dc=24,Fc=28;function Gc(i,t,n,e,r){return!i||!t?"off":r==="critical"?"focused-hover-only":r==="none"&&n<=Lc&&e<=Mc?"full":"bounded-full"}function Pc(i){let t=2166136261;for(let n=0;n<i.length;n+=1)t^=i.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function Oc(i,t){if(!i)return 0;const n=i;if(typeof n.get=="function"){const o=n.get(t);return typeof o=="number"&&Number.isFinite(o)?o:0}const r=i[t];return typeof r=="number"&&Number.isFinite(r)?r:0}function $c(i,t){if(!i||!t)return null;const n=i.assets[t];return n?{key:t,asset:n}:null}function Uc(i,t,n,e,r=Hn,o){if(i==="off")return new Set;const s=new Set(t),a=[];if(n&&s.has(n)&&a.push(n),e&&e!==n&&s.has(e)&&a.push(e),i==="focused-hover-only")return new Set(a);const c=Math.max(0,r);if(c===0)return new Set(a);const d=(o==null?void 0:o.visibleNodeIds)??null,u=(o==null?void 0:o.importanceByNodeId)??null,h=new Set(a);if(h.size>=c&&a.length>0)return h;const l=t.filter(f=>!h.has(f)).map(f=>({nodeId:f,visibleRank:d!=null&&d.has(f)?0:1,importance:Oc(u,f),hash:Pc(f)}));l.sort((f,g)=>f.visibleRank!==g.visibleRank?f.visibleRank-g.visibleRank:f.importance!==g.importance?g.importance-f.importance:f.hash!==g.hash?f.hash-g.hash:f.nodeId.localeCompare(g.nodeId));for(const f of l){if(h.size>=c)break;h.add(f.nodeId)}return h}const sn=5,zc=po;function Zi(i,t){return Math.max(sn,Math.min(t,i))}function Bc(i,t){const n=Math.max(0,Math.min(1,t)),e=i.trim(),r=e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`:e,o=/^#([0-9a-fA-F]{6})$/.exec(r);if(!o)return i;const s=o[1],a=parseInt(s.slice(0,2),16),c=parseInt(s.slice(2,4),16),d=parseInt(s.slice(4,6),16);return`rgba(${a}, ${c}, ${d}, ${n})`}function jc(i,t){return Zi(3+Math.log2(i+1)*1.2,t)}function Yc(i,t){const n=Math.max(0,Math.min(1,i));return!Number.isFinite(t)||t<=0||Math.abs(t-1)<=Number.EPSILON?n:Math.pow(n,t)}function Hc(i,t,n,e,r=zc){if(i<=0||t<=0||n<=0)return sn;if(n-t<=Number.EPSILON)return r;const o=Math.max(t,Math.min(n,i)),s=n-t;if(!Number.isFinite(s)||s<=0)return r;const a=(o-t)/s,c=Yc(a,e);return Zi(sn+c*(r-sn),r)}function Wc(i,t,n,e){if(!e)return null;const r=n.indexOf(e);if(r<0)return null;for(let o=r;o>=0;o-=1){const s=n[o],a=t[s];if(!a)continue;const c=a[i];if(typeof c=="number"&&Number.isFinite(c)&&c>0)return c}return null}const Ji={EXTENSION:{label:"Extension",color:"#7c3aed"},MDOAP:{label:"MDOAP",color:"#0f766e"},MDP:{label:"MDP",color:"#0b7285"},NAP:{label:"NAP",color:"#2b8a3e"},NPT:{label:"NPT",color:"#1d4ed8"},ODOAP:{label:"ODOAP",color:"#9a3412"},ODP:{label:"ODP",color:"#5f3dc4"},OFFSHORE:{label:"Offshore",color:"#475569"},PIAT:{label:"PIAT",color:"#364fc7"},PROTECTORATE:{label:"Protectorate",color:"#d9480f"}},Wn="#4b5563",qc=[...Object.entries(Ji).map(([i,t])=>({key:i,color:t.color,label:t.label})),{key:"unknown",label:"Unknown / other",color:Wn}];function Xc({isFullscreen:i,graph:t,budgetPreset:n,anchoredCount:e,strategy:r,strategyLabel:o,strategyConfigSummary:s,strategyOptions:a,showStrategyConfig:c,strategyFields:d,strategyConfig:u,onBudgetChange:h,onStrategyChange:l,onToggleStrategyConfig:f,onStrategyFieldChange:g,onClearAnchors:m,onRecalculateHoldStart:p,onRecalculateHoldEnd:v,onRecalculateLayout:b,onEnterFullscreen:E,onExitFullscreen:y,scoreStatusRows:I,onRetryScoreLoad:x}){return Q.jsxs(Q.Fragment,{children:[i?Q.jsx("button",{type:"button",className:"absolute right-3 top-3 z-10 rounded border border-slate-300 bg-white/95 px-2 py-1 text-xs hover:bg-slate-100",onClick:y,children:"Exit Fullscreen"}):Q.jsxs("header",{className:"mb-2 flex items-center justify-between",children:[Q.jsx("h2",{className:"text-lg",children:"Network Explorer"}),Q.jsxs("div",{className:"flex items-center gap-2",children:[Q.jsxs("span",{className:"text-xs text-muted",children:[t.renderedEdges," edges / ",t.budgetLabel," LOD budget"]}),Q.jsx("button",{type:"button",className:"rounded border border-slate-300 px-2 py-0.5 text-xs hover:bg-slate-100",onClick:E,children:"Fullscreen"})]})]}),i?null:Q.jsxs("div",{className:"mb-3 space-y-2",children:[Q.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted",children:[Q.jsx("label",{htmlFor:"lod-budget",children:"LOD budget"}),Q.jsxs("select",{id:"lod-budget",className:"rounded border border-slate-300 px-1 py-0.5",value:n,onChange:w=>h(w.target.value),children:[Q.jsxs("option",{value:"auto",children:["Auto (",t.adaptiveBudget,")"]}),Q.jsx("option",{value:"500",children:"500"}),Q.jsx("option",{value:"1000",children:"1000"}),Q.jsx("option",{value:"2000",children:"2000"}),Q.jsx("option",{value:"unlimited",children:"Unlimited"})]}),Q.jsxs("span",{className:"ml-1",children:["Anchored: ",e]}),Q.jsx("label",{htmlFor:"layout-strategy",className:"ml-2",children:"Layout"}),Q.jsx("select",{id:"layout-strategy",className:"rounded border border-slate-300 px-1 py-0.5",value:r,onChange:w=>l(w.target.value),children:a.map(w=>Q.jsx("option",{value:w.value,children:w.label},w.value))}),Q.jsx("button",{type:"button",className:"rounded border border-slate-300 px-1 py-0.5 hover:bg-slate-100",onClick:f,children:c?"Hide config":"Show config"}),Q.jsxs("span",{className:"text-slate-600",children:[o,": ",s]}),Q.jsx("button",{type:"button",className:"rounded border border-slate-300 px-1 py-0.5 disabled:cursor-not-allowed disabled:opacity-60",onClick:m,disabled:e===0,children:"Clear anchors"}),Q.jsx("button",{type:"button",className:"rounded border border-slate-300 px-1 py-0.5 hover:bg-slate-100",onPointerDown:w=>{w.button===0&&(w.currentTarget.setPointerCapture(w.pointerId),p())},onPointerUp:()=>{v()},onPointerCancel:()=>{v()},onPointerLeave:()=>{v()},onBlur:()=>{v()},onKeyDown:w=>{w.key!=="Enter"&&w.key!==" "||(w.preventDefault(),b())},disabled:t.nodes.length===0,children:"Recalculate"})]}),c?Q.jsxs("div",{className:"rounded-md border border-slate-200 bg-slate-50 px-2 py-2 text-[11px] text-slate-700",children:[Q.jsx("div",{className:"uppercase tracking-wide text-slate-500",children:"Strategy config"}),Q.jsx("div",{className:"mt-1 grid grid-cols-1 gap-2 md:grid-cols-2",children:d.map(w=>{const S=u[w.key],A=Number(S);return Q.jsxs("label",{className:"flex items-center justify-between gap-2",children:[Q.jsx("span",{children:w.label}),Q.jsx("input",{type:"number",className:"w-28 rounded border border-slate-300 px-1 py-0.5",min:w.min,max:w.max,step:w.step,value:Number.isFinite(A)?A:w.min,onChange:_=>{const T=Number(_.target.value);Number.isFinite(T)&&g(w.key,T)}})]},w.key)})})]}):null,Q.jsxs("div",{className:"rounded-md border border-slate-200 bg-slate-50 px-2 py-1 text-[11px] text-slate-700",children:[Q.jsx("div",{className:"uppercase tracking-wide text-slate-500",children:"Edge legend"}),Q.jsx("div",{className:"mt-1 flex flex-wrap items-center gap-x-3 gap-y-1",children:qc.map(w=>Q.jsxs("div",{className:"flex items-center gap-1",children:[Q.jsx("span",{"aria-hidden":"true",className:"inline-block h-2.5 w-2.5 rounded-sm",style:{backgroundColor:w.color}}),Q.jsx("span",{children:w.label})]},w.key))})]})]}),i?null:Q.jsxs("div",{className:"mb-2 text-xs text-muted",children:[t.nodes.length," alliances shown | ",t.renderedEdges," treaties shown | Node size by ",t.scoreSizingActive?"score":"connections",t.scoreSizingActive?` | scored ${t.scoreSizedNodeCount}/${t.nodes.length} (${t.scoreDay??"n/a"})`:""]}),!i&&I?Q.jsxs("div",{className:"mb-2 rounded border border-rose-200 bg-rose-50 px-2 py-2 text-[11px] text-rose-900",children:[Q.jsx("div",{className:"font-medium",children:I.title}),Q.jsx("div",{className:"mt-0.5",children:I.message}),I.details?Q.jsx("div",{className:"mt-0.5 text-rose-700",children:I.details}):null,I.actionableRetry?Q.jsx("div",{className:"mt-2",children:Q.jsx("button",{type:"button",className:"rounded border border-rose-300 bg-white px-2 py-0.5 text-[11px] hover:bg-rose-100",onClick:x,children:"Retry score load"})}):null]}):null]})}function Vc(i){const{baseQuery:t,playhead:n,maxEdges:e,strategy:r,strategyConfig:o}=i,[s,a]=U.useState(null),[c,d]=U.useState(null),[u,h]=U.useState(null),l=U.useRef(0),f=U.useRef(!1),g=U.useRef(null),m=U.useRef(0),p=U.useRef(!0);p.current=!0;const v=U.useRef(()=>{});return v.current=b=>{(async()=>{f.current=!0;try{const y=await yo(b.baseQuery,b.playhead,b.maxEdges,b.strategy,b.strategyConfig);if(!p.current||b.requestId<m.current)return;m.current=b.requestId;const I=Math.max(0,y.startedAt-b.requestedAt),x=Math.max(0,y.finishedAt-y.startedAt);Ve("network.worker.queueAge",I),Ve("network.worker.turnaround",x),h({requestId:b.requestId,requestedAt:b.requestedAt,startedAt:y.startedAt,finishedAt:y.finishedAt}),a({edgeEventIndexes:y.edgeEventIndexes,layout:y.layout}),d(null)}catch(y){const I=y instanceof Error?y.message:"Unknown network worker error";if(!p.current||I==="Superseded network request")return;d(`[network] Worker pipeline failed: ${I}`)}finally{if(f.current=!1,!p.current)return;const y=g.current;if(!y)return;g.current=null,v.current(y)}})()},U.useEffect(()=>()=>{p.current=!1,g.current=null},[]),U.useEffect(()=>{if(!p.current)return;l.current+=1;const b={requestId:l.current,requestedAt:performance.now(),baseQuery:t,playhead:n,maxEdges:e,strategy:r,strategyConfig:o};f.current?g.current=b:v.current(b)},[t,e,n,r,o]),{workerEdgeEventIndexes:(s==null?void 0:s.edgeEventIndexes)??null,workerLayout:(s==null?void 0:s.layout)??null,workerRequestLifecycle:u,workerError:c}}const Kc="#1f2937",Zc=.62,Jc=.84,Qc=.95,ed=.22,td=1.25,nd=2.35,rd=1.45,id=10;function od(i,t){const n=Math.max(i*t,1),e=Math.round(n/2200);return Math.max(240,Math.min(2400,e))}function sd(i){return i.trim().replace(/\s+/g," ").toUpperCase()}function ad(i){return i<=td?"zoomed-in":i<=nd?"mid":"zoomed-out"}function cd(i){const t=i.trim();if(t.length<=16)return t;const n=t.split(/\s+/).filter(Boolean);if(n.length>=2){const e=n.map(r=>{var o;return((o=r[0])==null?void 0:o.toUpperCase())??""}).join("");if(e.length>=2&&e.length<=8)return e}return`${t.slice(0,13).trimEnd()}...`}function ui(i,t,n){return n?i:t==="zoomed-out"?null:t==="mid"?cd(i):i}function dd(i){const{sizeByScore:t,scoreManifestDeclared:n,scoreLoadSnapshot:e}=i;if(t&&!n)return{code:"manifest-missing",title:"Score sizing unavailable",message:"Manifest does not declare alliance_scores_v2.msgpack.",actionableRetry:!1,details:null};if(!e||!e.state.startsWith("error-"))return null;const r=[e.httpStatus===null?null:`HTTP ${e.httpStatus}`,e.decodeMs===null?null:`decode ${Math.round(e.decodeMs)}ms`,`elapsed ${Math.round(e.elapsedMs)}ms`].filter(Boolean).join(" | ");switch(e.state){case"error-timeout":return{code:"timeout",title:"Score load timed out",message:e.message??"Score request timed out.",actionableRetry:!0,details:r};case"error-http":return{code:"http",title:"Score artifact HTTP failure",message:e.message??"Score artifact request returned a non-OK HTTP status.",actionableRetry:!0,details:r};case"error-network":return{code:"network",title:"Score artifact network failure",message:e.message??"Network request for score artifact failed.",actionableRetry:!0,details:r};case"error-worker-unavailable":return{code:"worker-unavailable",title:"Score decode worker unavailable",message:e.message??"Web Worker is unavailable in this environment.",actionableRetry:!0,details:r};case"error-worker-failure":return{code:"worker-failure",title:"Score decode worker failed",message:e.message??"Worker failed while decoding score payload.",actionableRetry:!0,details:r};case"error-decode":return{code:"decode",title:"Score payload decode failure",message:e.message??"Score payload could not be decoded.",actionableRetry:!0,details:r};case"error-abort":return{code:"abort",title:"Score load aborted",message:e.message??"Score request was aborted.",actionableRetry:!1,details:r};case"error-manifest-missing":return{code:"manifest-missing",title:"Score sizing unavailable",message:e.message??"Manifest does not declare alliance_scores_v2.msgpack.",actionableRetry:!1,details:r};default:return{code:"unknown",title:"Score load failed",message:e.message??e.reasonCode??"Score loader failed.",actionableRetry:!0,details:r}}}function ld({allEvents:i,scopedIndexes:t,baseQuery:n,playhead:e,focusedAllianceId:r,focusedEdgeKey:o,sizeByScore:s,scoreSizeContrast:a,maxNodeRadius:c,showFlags:d,flagAssetsPayload:u,allianceScoresByDay:h,allianceScoreDays:l,scoreLoadSnapshot:f,scoreManifestDeclared:g,onRetryScoreLoad:m,resolveAllianceFlagAtPlayhead:p,onFocusAlliance:v,onFocusEdge:b,isFullscreen:E,onEnterFullscreen:y,onExitFullscreen:I,forceFullscreenLabels:x,isPlaying:w,onFullscreenHintChange:S}){const A=U.useRef(null),_=U.useRef(null),T=U.useRef(null),C=U.useRef(r),G=U.useRef(o),R=U.useRef(v),k=U.useRef(b),$=U.useRef(null),H=U.useRef(null),V=U.useRef(0),Z=U.useRef("none"),X=U.useRef(0),ee=U.useRef(d),oe=U.useRef(u),P=U.useRef(new Set);U.useRef("");const[J,ce]=U.useState({width:1e3,height:350}),[ie,he]=U.useState(null),[fe,F]=U.useState("auto"),[N,L]=U.useState(1),[B,z]=U.useState(!1),[ae,me]=U.useState("none"),[de,Ee]=U.useState(0),[Me,Pe]=U.useState(!1),[dt,Ke]=U.useState(!1),[be,Ze]=U.useState(Dn),[Tt,er]=U.useState(()=>({[Dn]:rn(Dn)})),[tr,nr]=U.useState(null),mt=U.useRef(null),rr=U.useRef(0),ir=U.useRef(new Map),ln=U.useRef(0),or=U.useRef(0),pt=xr(Y=>Y.query.filters.anchoredAllianceIds),fn=xr(Y=>Y.setAnchoredAllianceIds),sr=U.useRef(pt);U.useEffect(()=>{sr.current=pt},[pt]);const gn=U.useMemo(()=>new Set(pt.map(Y=>String(Y))),[pt]),rt=U.useMemo(()=>ad(N),[N]);U.useEffect(()=>{Z.current=ae},[ae]),U.useEffect(()=>{ee.current=d,oe.current=u},[u,d]),U.useEffect(()=>{if(!d||!u){H.current=null,z(!1);return}const Y=u.atlas.webp||u.atlas.png;if(!Y){H.current=null,z(!1);return}const D=new Image;return D.decoding="async",D.onload=()=>{H.current=D,z(!0)},D.onerror=()=>{H.current=null,z(!1)},D.src=Y,()=>{D.onload=null,D.onerror=null}},[u,d]),U.useEffect(()=>{C.current=r,G.current=o,R.current=v,k.current=b},[r,o,v,b]),U.useEffect(()=>{if(!A.current||typeof ResizeObserver>"u")return;const Y=new ResizeObserver(D=>{var te;const re=(te=D[0])==null?void 0:te.contentRect;re&&ce({width:re.width,height:re.height})});return Y.observe(A.current),()=>Y.disconnect()},[]);const Ct=U.useMemo(()=>od(J.width,J.height),[J.height,J.width]),Rt=U.useMemo(()=>fe==="auto"?Ct:fe==="unlimited"?Number.MAX_SAFE_INTEGER:Number(fe),[Ct,fe]),Xe=U.useCallback(()=>{mt.current===null&&(mt.current=window.requestAnimationFrame(()=>{var re;mt.current=null;const Y=performance.now();(re=_.current)==null||re.refresh();const D=performance.now()-Y;rr.current=D,Ve("network.renderer.refresh",D)}))},[]),Qi=U.useMemo(()=>{var re;if(!e||!w||i.length===0)return e;let Y=-1;for(let te=0;te<i.length&&i[te].timestamp<=e;te+=1)Y=te;if(Y<0)return e;const D=vo(Y,n.playback.speed);return((re=i[D])==null?void 0:re.timestamp)??e},[i,n.playback.speed,w,e]),Wt=U.useMemo(()=>Tt[be]??rn(be),[be,Tt]),eo=U.useMemo(()=>Sc(be,Wt),[Wt,be]),to=U.useMemo(()=>Tc(be),[be]),no=U.useMemo(()=>_c(be),[be]),{workerEdgeEventIndexes:mn,workerLayout:qt,workerRequestLifecycle:yt,workerError:ar}=Vc({baseQuery:n,playhead:Qi,maxEdges:Rt,strategy:be,strategyConfig:Wt}),ut=U.useMemo(()=>{const Y=new Map,D=new Map;for(const te of i){if(e&&te.timestamp>e)continue;const ve=te.from_alliance_name.trim();ve&&(D.set(String(te.from_alliance_id),ve),Y.set(String(te.from_alliance_id),ve));const we=te.to_alliance_name.trim();we&&(D.set(String(te.to_alliance_id),we),Y.set(String(te.to_alliance_id),we))}for(const te of i){const ve=String(te.from_alliance_id);if(!Y.has(ve)){const ue=te.from_alliance_name.trim();ue&&D.set(ve,ue)}const we=String(te.to_alliance_id);if(!Y.has(we)){const ue=te.to_alliance_name.trim();ue&&D.set(we,ue)}}for(const[te,ve]of D.entries())Y.has(te)||Y.set(te,ve);const re=new Map;for(const[te,ve]of Y.entries())re.set(te,ve);return re},[i,e]),pn=U.useMemo(()=>(mn?Array.from(mn):[]).map(re=>{const te=i[re];return{key:`${te.pair_min_id}:${te.pair_max_id}:${te.treaty_type}`,eventId:te.event_id,sourceId:String(te.from_alliance_id),targetId:String(te.to_alliance_id),sourceLabel:te.from_alliance_name||String(te.from_alliance_id),targetLabel:te.to_alliance_name||String(te.to_alliance_id),treatyType:te.treaty_type,sourceType:te.source||"unknown",confidence:te.confidence}}).map(re=>({...re,sourceLabel:ut.get(re.sourceId)??re.sourceLabel,targetLabel:ut.get(re.targetId)??re.targetLabel})),[i,ut,mn]),ro=U.useMemo(()=>bo(n,{sizeByScore:s,scoreSizeContrast:a,maxNodeRadius:c,maxEdges:Rt,allEventsLength:i.length,scopedIndexes:t}),[i.length,n.filters.actions,n.filters.alliances,n.filters.evidenceMode,n.filters.includeInferred,n.filters.includeNoise,n.filters.sources,n.filters.treatyTypes,n.sort.direction,n.sort.field,n.textQuery,n.time.end,n.time.start,c,Rt,e,a,t,s]);U.useEffect(()=>{he(null)},[ro]);const se=U.useMemo(()=>{var gr;const Y=performance.now(),D=new Map,re=new Map,te=new Map(((qt==null?void 0:qt.nodeTargets)??[]).map(q=>[q.nodeId,q]));for(const q of te.values())D.has(q.nodeId)||D.set(q.nodeId,{degree:0});const ve=(q,le,ke,lt)=>{const Je=re.get(q)??new Map,Oe=Je.get(le)??{counterpartyLabel:ke||le,treatyTypes:new Set};Oe.counterpartyLabel=ke||Oe.counterpartyLabel,Oe.treatyTypes.add(lt),Je.set(le,Oe),re.set(q,Je)};for(const q of pn){const le=D.get(q.sourceId)??{degree:0};le.degree+=1,D.set(q.sourceId,le);const ke=D.get(q.targetId)??{degree:0};ke.degree+=1,D.set(q.targetId,ke),ve(q.sourceId,q.targetId,ut.get(q.targetId)??q.targetLabel??q.targetId,q.treatyType),ve(q.targetId,q.sourceId,ut.get(q.sourceId)??q.sourceLabel??q.sourceId,q.treatyType)}const we=[...D.keys()].sort((q,le)=>q.localeCompare(le)),ue=r===null?null:String(r),ye=new Set(gn);ue!==null&&ye.add(ue);const j=Gc(d,u!==null,N,we.length,ae),pe=s&&h?So(h,l,e):{day:null,row:null,usedFallback:!1},Ae=pe.day,_e=pe.row,Fe=new Map;let Ge=Number.POSITIVE_INFINITY,je=0;if(h&&_e)for(const q of we){const le=Wc(q,h,l,Ae);typeof le!="number"||!Number.isFinite(le)||le<=0||(Fe.set(q,le),le<Ge&&(Ge=le),le>je&&(je=le))}const kt=!!(s&&_e&&Fe.size>0&&je>0),vt=Number.isFinite(Ge)?Ge:0,it=new Map;for(const q of we){const le=((gr=D.get(q))==null?void 0:gr.degree)??0,ke=Fe.get(q)??0;it.set(q,le*1e3+ke)}const ot=Uc(j,we,ue,(ie==null?void 0:ie.allianceId)??null,Hn,{visibleNodeIds:P.current,importanceByNodeId:it}),Nt=ir.current,Vt=new Map(Nt),ht=de>ln.current,yn=ht?Eo:Io;let Lt=0,ur=0,vn=0;const hr=we.map(q=>{const le=D.get(q),ke=te.get(q),lt=ke?{x:ke.targetX,y:ke.targetY}:di(q),Je=Number.isFinite(lt.x)&&Number.isFinite(lt.y)?lt:di(q),Oe=Nt.get(q),mr=gn.has(q);let ft;if(mr)ft=Oe??Je;else if(Oe){const st=Rc(Oe,Je,ed);ft=Nc(Oe,st,yn);const Ye=kc(Oe,ft);Lt+=1,ur+=Ye,Ye>vn&&(vn=Ye)}else ft=Je;Vt.set(q,ft);const pr=ue!==null&&ue===q,bn=Fe.get(q)??null,yr=kt&&bn!==null?Hc(bn,vt,je,a,c):jc(le.degree,c),vr=re.get(q),wn=vr?[...vr.entries()].map(([st,Ye])=>({counterpartyId:st,counterpartyLabel:Ye.counterpartyLabel,treatyTypes:[...Ye.treatyTypes].sort((ho,lo)=>ho.localeCompare(lo))})).sort((st,Ye)=>st.counterpartyLabel.localeCompare(Ye.counterpartyLabel)||st.counterpartyId.localeCompare(Ye.counterpartyId)):[],ao=wn.reduce((st,Ye)=>st+Ye.treatyTypes.length,0),br=Number(q),bt=j!=="off"&&ot.has(q)&&Number.isFinite(br)?p(br,e):null,wr=$c(u,(bt==null?void 0:bt.flagKey)??null),co=ut.get(q)??q,uo=ye.has(q);return{id:q,fullLabel:co,isPriorityNode:uo,degree:le.degree,counterparties:wn.length,treatyCount:ao,activeTreaties:wn,flagKey:(bt==null?void 0:bt.flagKey)||null,score:bn,scoreDay:Ae,radius:pr?yr+1.4:yr,highlighted:pr,anchored:mr,flagSprite:wr?{...wr.asset}:null,x:ft.x,y:ft.y}});ir.current=Vt;const lr=new Set,fr=pn.map(q=>{const le=sd(q.treatyType),ke=Ji[le],lt=(ke==null?void 0:ke.color)??Wn;!ke&&le&&lr.add(le);const Je=o!==null&&o===q.key,Oe=ue!==null&&(q.sourceId===ue||q.targetId===ue);return{id:q.eventId,source:q.sourceId,target:q.targetId,edgeKey:q.key,sourceLabel:q.sourceLabel,targetLabel:q.targetLabel,treatyType:le,sourceType:q.sourceType,confidence:q.confidence,color:lt,highlighted:Je,adjacentToFocusedAlliance:Oe}}),oo=performance.now()-Y,so=Lt>0?ur/Lt:0;return{adaptiveBudget:Ct,maxEdges:Rt,budgetLabel:fe==="auto"?`Auto (${Ct})`:fe==="unlimited"?"Unlimited":fe,renderedEdges:fr.length,nodes:hr,links:fr,flagRenderMode:j,flagResolvedNodeCount:ot.size,spriteNodeIds:hr.filter(q=>q.flagSprite!==null).map(q=>q.id),unmappedTreatyTypes:[...lr].sort((q,le)=>q.localeCompare(le)),scoreSizingActive:kt,scoreSizedNodeCount:Fe.size,scoreMin:vt,scoreMax:je,usedDayFallback:pe.usedFallback,scoreDay:Ae,graphBuildMs:oo,layoutStrategy:be,averageStepDisplacement:so,maxStepDisplacement:vn,relaxAppliedToken:ht?de:0}},[Ct,ut,h,l,gn,fe,N,pn,ae,u,r,o,de,c,Rt,e,p,a,d,s,be,qt]);U.useEffect(()=>{},[se.unmappedTreatyTypes]),U.useEffect(()=>{se.relaxAppliedToken<=0||(ln.current=Math.max(ln.current,se.relaxAppliedToken))},[se.relaxAppliedToken]),U.useEffect(()=>{!Me||se.nodes.length===0||de<=0||se.relaxAppliedToken<de||Ee(Y=>Y+1)},[se.nodes.length,se.relaxAppliedToken,Me,de]),U.useEffect(()=>{Ve("network.graph.build",se.graphBuildMs),Ve("network.layout.displacement.avg",se.averageStepDisplacement),Ve("network.layout.displacement.max",se.maxStepDisplacement),se.nodes.length,V.current,se.flagRenderMode,se.flagResolvedNodeCount,Number(se.graphBuildMs.toFixed(2))},[N,ae,se.averageStepDisplacement,se.flagRenderMode,se.flagResolvedNodeCount,se.graphBuildMs,se.maxStepDisplacement,se.nodes.length]),U.useEffect(()=>{if(!ie)return;se.nodes.some(D=>D.id===ie.allianceId)||he(null)},[se.nodes,ie]);const De=U.useMemo(()=>ie?se.nodes.find(Y=>Y.id===ie.allianceId)??null:null,[se.nodes,ie]),cr=U.useMemo(()=>{var D;if(!De||se.flagRenderMode==="off")return null;if(De.flagKey)return De.flagKey;const Y=Number(De.id);return Number.isFinite(Y)?((D=p(Y,e))==null?void 0:D.flagKey)??null:null},[se.flagRenderMode,De,e,p]);U.useEffect(()=>{if(!A.current||_.current)return;let Y,D;try{Y=new ge({type:"directed",multi:!0,allowSelfLoops:!0}),D=new nc(Y,A.current,{renderEdgeLabels:!1,labelRenderedSizeThreshold:0,labelColor:{attribute:"default",color:Kc},minCameraRatio:.1,maxCameraRatio:8,defaultNodeColor:"#0c8599",defaultEdgeColor:Wn,enableEdgeEvents:!0,minEdgeThickness:2.4}),nr(null)}catch(ue){const ye=ue instanceof Error?ue.message:"Unknown renderer initialization error";nr(`[network] Renderer failed to initialize: ${ye}`);return}const re=D.createCanvas("flag-sprites",{beforeLayer:"mouse",style:{pointerEvents:"none"}});$.current=re;const te=()=>{const ue=re.getContext("2d");if(!ue)return;const ye=D.getDimensions(),j=window.devicePixelRatio||1,pe=Math.max(1,Math.floor(ye.width*j)),Ae=Math.max(1,Math.floor(ye.height*j));(re.width!==pe||re.height!==Ae)&&(re.width=pe,re.height=Ae,re.style.width=`${ye.width}px`,re.style.height=`${ye.height}px`),ue.setTransform(j,0,0,j,0,0),ue.clearRect(0,0,ye.width,ye.height);const _e=H.current;if(!_e||T.current===null||!oe.current||!ee.current){X.current=0;return}const Fe=performance.now();let Ge=0;const je=new Set;for(const vt of Y.nodes()){const it=Y.getNodeAttribute(vt,"flagSprite"),ot=D.getNodeDisplayData(vt);if(!ot||ot.hidden||(je.add(vt),Ge>=Hn||!it))continue;const Nt=D.framedGraphToViewport({x:ot.x,y:ot.y}),Vt=D.scaleSize(ot.size),ht=Math.max(id,Vt*rd),yn=Nt.x-ht/2,Lt=Nt.y-ht/2;ue.drawImage(_e,it.x,it.y,it.w,it.h,yn,Lt,ht,ht),Ge+=1}P.current=je;const kt=performance.now()-Fe;X.current=Number(kt.toFixed(2)),Ve("network.flagSprites.draw",kt)};D.on("afterRender",te);const ve=D.getCamera(),we=()=>{L(ve.getState().ratio)};return ve.on("updated",we),we(),D.on("clickNode",({node:ue,event:ye})=>{const j=Number(ue);if(!Number.isFinite(j))return;if((ye==null?void 0:ye.original)!==void 0&&"shiftKey"in ye.original&&!!ye.original.shiftKey){const Ae=new Set(sr.current);Ae.has(j)?Ae.delete(j):Ae.add(j),fn([...Ae]);return}R.current(C.current===j?null:j)}),D.on("clickEdge",({edge:ue})=>{const ye=Y.getEdgeAttribute(ue,"edgeKey");k.current(G.current===ye?null:ye)}),D.on("clickStage",()=>{R.current(null),k.current(null)}),D.on("enterNode",({node:ue})=>{he({kind:"alliance",allianceId:ue})}),D.on("leaveNode",()=>{}),D.on("enterEdge",({edge:ue})=>{const ye=Y.source(ue);ye&&he({kind:"alliance",allianceId:String(ye)})}),D.on("leaveEdge",()=>{}),T.current=Y,_.current=D,()=>{mt.current!==null&&(window.cancelAnimationFrame(mt.current),mt.current=null),typeof ve.off=="function"&&ve.off("updated",we),D.off("afterRender",te),D.kill(),$.current=null,_.current=null,T.current=null}},[fn]),U.useEffect(()=>{const Y=_.current;if(!Y)return;const D=rt==="zoomed-out"?8:rt==="mid"?3:0,re=rt==="mid"?12:14;Y.setSetting("labelRenderedSizeThreshold",D),Y.setSetting("labelSize",re),Xe()},[Xe,rt]),U.useEffect(()=>{_.current&&Xe()},[B,Xe]),U.useEffect(()=>{const Y=_.current,D=T.current;if(!(!Y||!D)){for(const re of se.nodes){if(!D.hasNode(re.id))continue;const te=(ie==null?void 0:ie.allianceId)===re.id,ve=Er(E,x,re.isPriorityNode||te),we=ui(re.fullLabel,rt,ve);we?D.setNodeAttribute(re.id,"label",we):D.removeNodeAttribute(re.id,"label"),ve?D.setNodeAttribute(re.id,"forceLabel",!0):D.removeNodeAttribute(re.id,"forceLabel")}Xe()}},[x,se.nodes,ie==null?void 0:ie.allianceId,E,Xe,rt]),U.useEffect(()=>{const Y=_.current,D=T.current;if(!Y||!D)return;const re=performance.now(),te=new Map;for(const j of se.nodes){const pe=Er(E,x,j.isPriorityNode),Ae=ui(j.fullLabel,rt,pe),_e={x:j.x,y:j.y,fullLabel:j.fullLabel,isPriorityNode:j.isPriorityNode,treatyCount:j.treatyCount,counterparties:j.counterparties,size:j.radius,score:j.score,scoreDay:j.scoreDay,color:j.highlighted?"#2b8a3e":j.anchored?"#d9480f":"#0c8599"};Ae&&(_e.label=Ae),pe&&(_e.forceLabel=!0),se.flagRenderMode!=="off"&&j.flagSprite&&(_e.flagSprite=j.flagSprite),te.set(j.id,_e)}for(const j of[...D.nodes()])te.has(j)||D.dropNode(j);for(const[j,pe]of te.entries()){if(!D.hasNode(j)){D.addNode(j,pe);continue}const Ae=D.getNodeAttributes(j);for(const[_e,Fe]of Object.entries(pe))Ae[_e]!==Fe&&D.setNodeAttribute(j,_e,Fe);for(const _e of Object.keys(Ae))_e in pe||D.removeNodeAttribute(j,_e)}const ve=new Map;for(const j of se.links){if(!D.hasNode(j.source)||!D.hasNode(j.target))continue;const pe=j.highlighted?Qc:j.adjacentToFocusedAlliance?Jc:Zc;ve.set(j.id,{source:j.source,target:j.target,attrs:{size:j.highlighted?3.2:j.adjacentToFocusedAlliance?2:1.2,color:Bc(j.color,pe),zIndex:j.highlighted?3:j.adjacentToFocusedAlliance?2:1,edgeKey:j.edgeKey,sourceLabel:j.sourceLabel,targetLabel:j.targetLabel,treatyType:j.treatyType,sourceType:j.sourceType,confidence:j.confidence}})}for(const j of[...D.edges()])ve.has(j)||D.dropEdge(j);for(const[j,pe]of ve.entries()){if(!D.hasEdge(j)){D.addDirectedEdgeWithKey(j,pe.source,pe.target,pe.attrs);continue}const Ae=D.source(j),_e=D.target(j);if(Ae!==pe.source||_e!==pe.target){D.dropEdge(j),D.addDirectedEdgeWithKey(j,pe.source,pe.target,pe.attrs);continue}const Fe=D.getEdgeAttributes(j);for(const[Ge,je]of Object.entries(pe.attrs))Fe[Ge]!==je&&D.setEdgeAttribute(j,Ge,je);for(const Ge of Object.keys(Fe))Ge in pe.attrs||D.removeEdgeAttribute(j,Ge)}if(Ve("network.graph.apply.diff",performance.now()-re),yt&&yt.requestId>or.current){const j=performance.now();Ve("network.worker.applyLag",Math.max(0,j-yt.finishedAt)),Ve("network.worker.endToEnd",Math.max(0,j-yt.requestedAt)),or.current=yt.requestId}Xe();const we=Math.max(X.current,rr.current),ue=we>Dc||se.graphBuildMs>Fc;V.current+=ue?1:-1,V.current=Math.max(-12,Math.min(12,V.current));const ye=wo(V.current,Z.current);ye!==Z.current&&me(ye),se.nodes.length,V.current,se.flagRenderMode,se.flagResolvedNodeCount,Number(we.toFixed(2)),Number(se.graphBuildMs.toFixed(2))},[N,x,se.flagRenderMode,se.flagResolvedNodeCount,se.graphBuildMs,se.links,se.nodes,E,Xe,yt,rt]),U.useEffect(()=>{const Y=_.current;Y&&(Y.resize(),Xe())},[Xe,J.height,J.width]);const dr=U.useMemo(()=>{if(r===null)return null;const Y=se.nodes.find(D=>D.id===String(r));return Y?`Focused Alliance: ${Y.fullLabel} | Treaties: ${Y.treatyCount} | Counterparties: ${Y.counterparties}`:`Focused alliance ${r} is outside the current network scope.`},[r,se.nodes]),Xt=U.useMemo(()=>De?{id:De.id,fullLabel:De.fullLabel,score:De.score,scoreDay:De.scoreDay,treatyCount:De.treatyCount,counterparties:De.counterparties,flagKey:cr,activeTreaties:De.activeTreaties}:null,[De,cr]);U.useEffect(()=>{if(S){if(!E){S(null);return}S(Xt)}},[Xt,E,S]);const io=U.useMemo(()=>dd({sizeByScore:s,scoreManifestDeclared:g,scoreLoadSnapshot:f}),[f,g,s]);return Q.jsxs("section",{className:E?"panel relative h-full w-full rounded-xl p-2 md:p-3":"panel p-4",children:[Q.jsx(Xc,{isFullscreen:E,graph:se,budgetPreset:fe,anchoredCount:pt.length,strategy:be,strategyLabel:to,strategyConfigSummary:eo,strategyOptions:Ac,showStrategyConfig:dt,strategyFields:no,strategyConfig:Wt,onBudgetChange:F,onStrategyChange:Y=>{Ze(Y),er(D=>D[Y]?D:{...D,[Y]:rn(Y)})},onToggleStrategyConfig:()=>Ke(Y=>!Y),onStrategyFieldChange:(Y,D)=>{er(re=>({...re,[be]:{...re[be]??rn(be),[Y]:D}}))},onClearAnchors:()=>fn([]),onRecalculateHoldStart:()=>{Pe(!0),Ee(Y=>Y+1)},onRecalculateHoldEnd:()=>Pe(!1),onRecalculateLayout:()=>Ee(Y=>Y+1),onEnterFullscreen:y,onExitFullscreen:I,scoreStatusRows:io,onRetryScoreLoad:m}),!E&&ar?Q.jsx("div",{className:"mb-2 rounded border border-rose-200 bg-rose-50 px-2 py-2 text-[11px] text-rose-900",children:ar}):null,!E&&tr?Q.jsx("div",{className:"mb-2 rounded border border-rose-200 bg-rose-50 px-2 py-2 text-[11px] text-rose-900",children:tr}):null,Q.jsx("div",{ref:A,className:E?"h-full overflow-hidden rounded-xl border border-slate-200":"h-[350px] overflow-hidden rounded-xl border border-slate-200"}),!E&&Xt?Q.jsx(xo,{hint:Xt,flagAssetsPayload:u,className:"mt-2 rounded-md border border-slate-300 bg-slate-50 p-3 text-xs text-slate-700"}):null,!E&&dr?Q.jsx("div",{className:"mt-2 text-xs text-slate-700",children:dr}):null,E?null:Q.jsx("p",{className:"text-xs text-muted",children:"Shift+click a node to toggle an anchor while keeping regular click-to-focus behavior."})]})}export{zc as DEFAULT_MAX_NODE_RADIUS,ld as NetworkView,Yc as applyScoreContrast,dd as deriveScoreFailureDiagnostic,Hc as scoreRadiusWithContrast};
